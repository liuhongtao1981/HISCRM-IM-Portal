# ============================================
# HisCRM-IM Master 服务配置
# ============================================

# ============================================
# 服务基础配置
# ============================================
PORT=3000                                # 服务端口
HOST=0.0.0.0                             # 监听地址
NODE_ENV=development                     # 运行环境: development / production

# ============================================
# 数据库配置
# ============================================
DB_PATH=./data/master.db                 # SQLite 数据库路径

# ============================================
# Worker 管理配置
# ============================================

# Worker 心跳检测
WORKER_HEARTBEAT_TIMEOUT=30000           # Worker 心跳超时时间(ms) - 30秒无心跳则判定离线
WORKER_HEARTBEAT_INTERVAL=10000          # Worker 心跳发送间隔(ms) - 每10秒发送一次
WORKER_HEARTBEAT_CHECK_INTERVAL=15000    # Master 检查心跳间隔(ms) - 每15秒检查一次

# 账号状态上报
ACCOUNT_STATUS_REPORT_INTERVAL=60000     # 账号状态上报间隔(ms) - Worker 每1分钟上报一次账号状态
ACCOUNT_STATUS_BATCH_SIZE=50             # 批量上报最大账号数 - 单次最多上报50个账号

# 任务分配
MAX_ACCOUNTS_PER_WORKER=10               # 每个 Worker 最多承载账号数
REASSIGN_DELAY=5000                      # Worker 离线后重新分配延迟(ms) - 5秒后重新分配任务

# ============================================
# 爬虫配置
# ============================================

# 监控间隔（随机范围，防止被检测）
MONITOR_INTERVAL_MIN=15000               # 最小监控间隔(ms) - 15秒
MONITOR_INTERVAL_MAX=30000               # 最大监控间隔(ms) - 30秒（系统会在此范围内随机选择）
MONITOR_INTERVAL_DEFAULT=30000           # 默认监控间隔(ms) - 账号未设置时使用此值

# 重试策略
CRAWLER_MAX_RETRIES=3                    # 爬虫失败最大重试次数
CRAWLER_RETRY_DELAY=5000                 # 首次重试延迟(ms) - 后续延迟会指数增长
CRAWLER_BACKOFF_MULTIPLIER=2             # 重试延迟退避倍数 - 每次重试延迟翻倍

# 超时设置
CRAWLER_PAGE_TIMEOUT=30000               # 页面加载超时(ms)
CRAWLER_NAV_TIMEOUT=30000                # 页面导航超时(ms)
CRAWLER_ELEMENT_TIMEOUT=10000            # 元素查找超时(ms)

# 反爬虫设置
ANTI_BOT_DELAY_MIN=1000                  # 操作间随机延迟最小值(ms) - 模拟人类操作
ANTI_BOT_DELAY_MAX=3000                  # 操作间随机延迟最大值(ms)
ANTI_BOT_UA_ROTATION=false               # 是否轮换 User-Agent（暂未实现）
ANTI_BOT_PROXY_ROTATION=false            # 是否轮换代理（暂未实现）

# ============================================
# 浏览器配置
# ============================================
BROWSER_HEADLESS=true                    # 是否使用 headless 模式（无界面）
MAX_BROWSERS_PER_WORKER=10               # 每个 Worker 最多浏览器进程数
BROWSER_MEMORY_LIMIT_MB=200              # 单个浏览器内存限制(MB) - 超过则重启

# ============================================
# 登录配置
# ============================================

# 二维码登录
QR_REFRESH_INTERVAL=2000                 # 二维码状态刷新间隔(ms) - 每2秒检查一次登录状态
QR_EXPIRY_TIME=300000                    # 二维码过期时间(ms) - 5分钟
QR_MAX_POLLING=150                       # 最大轮询次数 - 150次 * 2秒 = 5分钟

# 登录会话
LOGIN_SESSION_CLEANUP_INTERVAL=60000     # 登录会话清理间隔(ms) - 每1分钟清理过期会话
MAX_CONCURRENT_LOGINS=5                  # 最大并发登录数 - 同时最多5个账号登录

# Cookie 管理
COOKIE_VALIDITY_DAYS=30                  # Cookie 有效期(天) - 30天后需要重新登录
COOKIE_CHECK_INTERVAL=86400000           # Cookie 检查间隔(ms) - 每天检查一次

# ============================================
# 通知配置
# ============================================
NOTIFICATION_PROCESS_INTERVAL=1000       # 通知队列处理间隔(ms) - 每秒处理一批
NOTIFICATION_BATCH_SIZE=10               # 批量处理通知数量 - 每批最多10条
NOTIFICATION_MAX_RETRIES=3               # 通知发送失败最大重试次数

# ============================================
# 任务调度配置
# ============================================
SCHEDULER_INTERVAL=60000                 # 任务调度间隔(ms) - 每1分钟调度一次
SCHEDULER_REBALANCE_INTERVAL=300000      # 负载均衡间隔(ms) - 每5分钟重新平衡负载
TASK_TIMEOUT=120000                      # 任务执行超时(ms) - 超过2分钟未完成则超时

# ============================================
# 日志配置
# ============================================
LOG_LEVEL=info                           # 日志级别: error, warn, info, debug
LOG_DIR=./logs                           # 日志目录
LOG_FILE=./logs/master.log               # 主日志文件路径
LOG_MAX_FILES=30                         # 最大日志文件数 - 保留最近30个文件
LOG_MAX_SIZE=20m                         # 单个日志文件最大大小

# ============================================
# 性能监控配置
# ============================================
MONITORING_ENABLED=false                 # 是否启用性能监控（暂未实现）
METRICS_INTERVAL=60000                   # 性能指标采集间隔(ms) - 每1分钟采集一次
ALERT_CPU_THRESHOLD=80                   # CPU 使用率告警阈值(%)
ALERT_MEMORY_THRESHOLD=80                # 内存使用率告警阈值(%)
ALERT_ERROR_RATE=0.1                     # 错误率告警阈值 - 10%

# ============================================
# Socket.IO 配置
# ============================================
SOCKET_PING_TIMEOUT=20000                # Socket.IO Ping 超时(ms)
SOCKET_PING_INTERVAL=10000               # Socket.IO Ping 间隔(ms)
SOCKET_MAX_BUFFER_SIZE=100000000         # 最大缓冲区大小(bytes) - 100MB
SOCKET_IO_CORS_ORIGIN=*                  # Socket.IO CORS 允许的源
SOCKET_IO_TRANSPORTS=websocket,polling   # Socket.IO 传输方式
CORS_ORIGIN=*                            # HTTP CORS 允许的源

# ============================================
# 安全配置
# ============================================
JWT_SECRET=your-jwt-secret-key-here      # JWT 签名密钥（请修改为随机字符串）
ENCRYPTION_KEY=12345678901234567890123456  # 数据加密密钥（32字符，请修改）

# ============================================
# 功能开关
# ============================================
ENABLE_AUTO_WORKER_START=true            # 是否自动启动配置的 Worker
ENABLE_AUTO_TASK_ASSIGNMENT=true         # 是否自动分配任务
ENABLE_FINGERPRINT_ROTATION=false        # 是否启用指纹轮换（暂未实现）

# ============================================
# 新数据推送系统配置
# ============================================
IS_NEW_NOTIFICATION_ENABLED=true         # 启用新数据客户端通知
