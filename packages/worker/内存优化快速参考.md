# 浏览器内存优化快速参考

## 🚀 快速配置（3步）

### 1. 编辑配置文件
```bash
vi packages/worker/.env
```

### 2. 选择预设
```bash
# 推荐：平衡模式（200-350MB/账户）✅
BROWSER_MEMORY_PRESET=BALANCED

# 或其他选项:
# BROWSER_MEMORY_PRESET=MAXIMUM_SAVINGS  # 150-250MB (不稳定)
# BROWSER_MEMORY_PRESET=MINIMAL          # 300-500MB (最稳定)
```

### 3. 重启 Worker
```bash
npm run start:worker
```

---

## 📊 预设对比

| 预设 | 内存/账户 | 稳定性 | 适用场景 |
|------|----------|--------|----------|
| **MAXIMUM_SAVINGS** | 150-250MB | ⚠️ 差 | 内存极度紧张 |
| **BALANCED** ✅ | 200-350MB | ✅ 好 | **推荐生产环境** |
| **MINIMAL** | 300-500MB | ✅✅ 最好 | 追求稳定性 |

---

## 💡 核心优化措施

### BALANCED 预设包含：
- ✅ 禁用 GPU 加速（节省 100-200MB）
- ✅ 禁用扩展和后台服务（节省 50-100MB）
- ✅ 限制渲染进程数量（节省 50-100MB）
- ✅ 限制缓存大小（节省 20-50MB）
- ✅ 保留图片加载（确保网站正常）
- ✅ 多进程模式（保证稳定性）

---

## 🧪 验证配置

运行测试脚本查看当前配置：
```bash
cd packages/worker
node test-memory-optimization.js
```

---

## 📈 预期效果

### 优化前：
- 单账户：600-1000MB
- 10账户：6-10GB

### 优化后（BALANCED）：
- 单账户：200-350MB ✅
- 10账户：2-3.5GB ✅
- **节省内存：60-65%** 🎉

---

## ⚠️ 注意事项

1. **首次启动稍慢**：优化参数会略微增加启动时间（+1-2秒）
2. **日志确认**：启动时应看到 `Browser memory optimization: BALANCED`
3. **监控内存**：使用 `pm2 monit` 或任务管理器监控实际占用
4. **稳定性优先**：如遇崩溃，切换到 `MINIMAL` 预设

---

## 🔧 故障排查

### Q: 优化后浏览器崩溃？
```bash
# 切换到稳定模式
BROWSER_MEMORY_PRESET=MINIMAL
```

### Q: 某些网站无法访问？
```bash
# 切换到最小优化
BROWSER_MEMORY_PRESET=MINIMAL
```

### Q: 如何查看当前配置？
```bash
cd packages/worker && node test-memory-optimization.js
```

---

## 📚 完整文档

详细说明请查看：[docs/浏览器内存优化指南.md](../../docs/浏览器内存优化指南.md)
