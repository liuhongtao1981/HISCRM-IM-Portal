<!--
SYNC IMPACT REPORT
==================
Version Change: 0.0.0 → 1.0.0
Modified Principles: N/A (initial ratification)
Added Sections: All core principles established
Removed Sections: None
Templates Status:
  ✅ plan-template.md - aligned with constitution principles
  ✅ spec-template.md - aligned with constitution principles
  ✅ tasks-template.md - aligned with constitution principles
Follow-up TODOs: None
-->

# HIS-CRM-IM 项目宪章

## 核心原则

### I. 进程隔离架构

每个 Worker 必须作为独立进程运行,与主控进程完全隔离。具体要求:

- Worker 进程必须独立启动、停止和重启,不影响主控和其他 Worker
- 每个 Worker 必须有独立的内存空间和资源管理
- Worker 崩溃时必须能够自动恢复,不影响系统整体可用性
- 主控进程必须能够监控所有 Worker 的健康状态

**理由**: 进程隔离确保系统的高可用性和容错能力,单个组件故障不会导致整体系统崩溃。

### II. 主控-Worker 通信协议

主控与 Worker 之间必须通过明确定义的通信协议进行交互。具体要求:

- 必须使用标准化的消息协议(如 JSON、Protocol Buffers)
- 所有通信接口必须有明确的契约定义和版本控制
- 必须支持异步通信模式,避免阻塞
- 必须包含心跳检测机制
- 通信层必须有错误处理和重试机制

**理由**: 标准化的通信协议确保系统的可维护性和可扩展性,使得组件可以独立演化和替换。

### III. 界面简洁美观原则

所有用户界面必须遵循简洁美观的设计原则。具体要求:

- UI 组件必须遵循一致的设计规范(颜色、字体、间距)
- 交互流程必须简单直观,减少用户学习成本
- 必须支持响应式设计,适配不同屏幕尺寸
- 关键操作必须有明确的视觉反馈
- 避免过度设计,优先考虑功能性和可用性

**理由**: 简洁美观的界面提升用户体验,降低使用门槛,提高系统的易用性和用户满意度。

### IV. Worker 可扩展性

系统必须支持灵活添加和删除 Worker 实例。具体要求:

- 新 Worker 类型必须能够通过配置注册到系统
- Worker 数量必须能够根据负载动态调整
- 每个 Worker 必须暴露标准化的服务发现接口
- Worker 的注册和注销必须对运行中的系统无侵入
- 必须支持 Worker 的热插拔和灰度发布

**理由**: 可扩展性确保系统能够应对业务增长和负载变化,支持系统的长期演化。

### V. 测试优先 (非协商)

所有新功能必须遵循测试优先(TDD)开发流程。具体要求:

- 实现前必须先编写测试用例
- 测试必须覆盖正常流程和异常情况
- 严格执行红-绿-重构循环
- 集成测试必须验证主控与 Worker 的交互
- 必须包含进程隔离和故障恢复的测试

**理由**: 测试优先确保代码质量,减少回归问题,提高系统的稳定性和可维护性。

### VI. 可观测性

系统必须具备完整的可观测性能力。具体要求:

- 所有组件必须输出结构化日志
- 必须记录关键操作的指标(延迟、成功率、错误率)
- 主控必须收集所有 Worker 的健康状态
- 必须支持分布式追踪,跟踪跨进程的请求链路
- 必须提供可视化的监控面板

**理由**: 可观测性是分布式系统运维的基础,帮助快速定位问题和优化性能。

### VII. 版本控制与兼容性

所有组件和接口必须有明确的版本管理。具体要求:

- 使用语义化版本号(MAJOR.MINOR.PATCH)
- 主控和 Worker 的协议必须支持向后兼容
- 破坏性变更必须有明确的升级路径和文档
- 必须在变更日志中记录所有接口变更
- 必须支持多版本 Worker 共存的过渡期

**理由**: 版本控制和兼容性确保系统可以平滑升级,降低运维风险。

## 架构约束

### 进程模型

- 主控进程: 单一实例,负责 Worker 管理、任务调度和状态监控
- Worker 进程: 多实例,每个 Worker 处理特定类型的任务
- 每个进程必须有独立的日志文件和配置文件
- 进程间通信必须通过 IPC 机制(消息队列、RPC 或共享内存)

### 技术栈要求

- 必须使用跨平台技术栈,支持 Windows 和 Linux
- 必须使用成熟稳定的第三方库,避免引入实验性依赖
- 必须有明确的性能基准(启动时间、内存占用、响应延迟)
- 必须支持容器化部署

### 安全要求

- 主控与 Worker 之间的通信必须支持加密
- 必须有身份验证和授权机制
- 敏感数据必须加密存储
- 必须有完整的安全审计日志

## 开发工作流

### 代码审查

- 所有代码变更必须经过 Code Review
- 必须验证是否符合架构原则
- 必须检查测试覆盖率
- 必须验证文档完整性

### 质量门禁

- 所有测试必须通过
- 代码覆盖率必须达到 80% 以上
- 不允许有高危或中危的安全漏洞
- 必须通过性能基准测试

### 发布流程

- 必须有完整的版本发布说明
- 必须有回滚计划
- 必须在测试环境验证后才能发布生产
- 必须有灰度发布能力

## 治理规则

### 宪章效力

本宪章是项目的最高指导文件,所有开发实践必须遵循宪章原则。

### 修订流程

1. 宪章修订必须由项目负责人发起
2. 修订提案必须包含变更理由和影响分析
3. 必须经过团队评审和批准
4. 修订后必须更新所有相关文档和模板
5. 必须有迁移计划和时间表

### 版本控制

- MAJOR 版本: 移除或重新定义核心原则,不向后兼容
- MINOR 版本: 新增原则或章节,功能性扩展
- PATCH 版本: 文字澄清、错误修正、非语义性改进

### 合规审查

- 每个功能的设计文档必须包含宪章合规性检查章节
- Code Review 必须验证代码是否符合宪章原则
- 定期(每季度)进行宪章执行情况审查
- 违反宪章的代码必须重构或提供充分的例外理由

### 复杂性管理

任何违反宪章原则的设计必须在实施计划的"复杂性跟踪"表格中记录:
- 具体违反了哪条原则
- 为什么需要这样做
- 为什么更简单的替代方案不可行

**版本**: 1.0.0 | **批准日期**: 2025-10-11 | **最后修订**: 2025-10-11
