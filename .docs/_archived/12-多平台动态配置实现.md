# å¤šå¹³å°åŠ¨æ€é…ç½®å®ç°

## ğŸ¯ å®Œæˆæ¦‚è¦

**æ–¹æ¡ˆ A å®ç°å®Œæˆï¼** ç³»ç»Ÿç°åœ¨æ”¯æŒä» Master åŠ¨æ€è·å–å¹³å°åˆ—è¡¨ï¼Œæ— éœ€ç¡¬ç¼–ç ã€‚

---

## âœ… å®ç°æ¸…å•

### 1. Master ç«¯ï¼šå¹³å° API ç«¯ç‚¹

**æ–‡ä»¶**: `packages/master/src/api/routes/platforms.js` (æ–°å»º)

#### æä¾›çš„ç«¯ç‚¹ï¼š

```javascript
// è·å–æ‰€æœ‰æ”¯æŒçš„å¹³å°
GET /api/v1/platforms
// å“åº”ç¤ºä¾‹ï¼š
{
  "success": true,
  "data": [
    { "value": "douyin", "label": "æŠ–éŸ³", "enabled": true, "accountCount": 5 },
    { "value": "xiaohongshu", "label": "å°çº¢ä¹¦", "enabled": true, "accountCount": 3 }
  ],
  "total": 2
}

// è·å–ç‰¹å®šå¹³å°çš„è¯¦ç»†ä¿¡æ¯
GET /api/v1/platforms/:platform
// å“åº”ç¤ºä¾‹ï¼š
{
  "success": true,
  "data": {
    "value": "douyin",
    "label": "æŠ–éŸ³",
    "totalAccounts": 5,
    "activeAccounts": 4,
    "enabled": true
  }
}

// è·å–æ‰€æœ‰å¹³å°çš„ç»Ÿè®¡æ±‡æ€»
GET /api/v1/platforms/stats/summary
// å“åº”ç¤ºä¾‹ï¼š
{
  "success": true,
  "data": [
    {
      "platform": "douyin",
      "label": "æŠ–éŸ³",
      "totalAccounts": 5,
      "activeAccounts": 4,
      "errorAccounts": 0
    },
    {
      "platform": "xiaohongshu",
      "label": "å°çº¢ä¹¦",
      "totalAccounts": 3,
      "activeAccounts": 3,
      "errorAccounts": 0
    }
  ],
  "total": 2
}
```

#### ç‰¹ç‚¹ï¼š
- âœ… ä»æ•°æ®åº“åŠ¨æ€ç»Ÿè®¡å·²æœ‰çš„å¹³å°
- âœ… ä» Worker æ³¨å†Œä¿¡æ¯è·å–æ”¯æŒçš„å¹³å°
- âœ… åŒ…å«è´¦æˆ·ç»Ÿè®¡ä¿¡æ¯
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆ

#### ä»£ç ä½ç½®ï¼š
- `packages/master/src/api/routes/platforms.js` - å®Œæ•´å®ç°
- `packages/master/src/index.js:996-1000` - è·¯ç”±æŒ‚è½½

### 2. Admin Webï¼šåŠ¨æ€åŠ è½½å¹³å°åˆ—è¡¨

#### AccountsPage æ›´æ–°

**æ–‡ä»¶**: `packages/admin-web/src/pages/AccountsPage.js`

**æ”¹åŠ¨**:
- æ·»åŠ  `loadPlatforms()` æ–¹æ³•ä» API è·å–å¹³å°åˆ—è¡¨
- åœ¨ `useEffect` ä¸­è°ƒç”¨ `loadPlatforms()`
- æ›¿æ¢ç¡¬ç¼–ç çš„ `<Option>` ä¸ºåŠ¨æ€ç”Ÿæˆçš„åˆ—è¡¨
- æ·»åŠ å¹³å°åŠ è½½çŠ¶æ€ `platformsLoading`
- æ”¯æŒé™çº§æ–¹æ¡ˆï¼šè‹¥ API å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å¹³å°åˆ—è¡¨

**ä»£ç ç‰‡æ®µ**:
```javascript
// çŠ¶æ€
const [platforms, setPlatforms] = useState([]);
const [platformsLoading, setPlatformsLoading] = useState(true);

// åŠ è½½æ–¹æ³•
const loadPlatforms = async () => {
  setPlatformsLoading(true);
  try {
    const response = await fetch('http://localhost:3000/api/v1/platforms');
    const data = await response.json();
    if (data.success) {
      setPlatforms(data.data);
    }
  } catch (error) {
    setPlatforms([
      { value: 'douyin', label: 'æŠ–éŸ³' },
      { value: 'xiaohongshu', label: 'å°çº¢ä¹¦' }
    ]);
  }
};

// ä½¿ç”¨
<Select placeholder="é€‰æ‹©å¹³å°" loading={platformsLoading}>
  {platforms.map(platform => (
    <Option key={platform.value} value={platform.value}>
      {platform.label}
    </Option>
  ))}
</Select>
```

#### AccountStatusPage æ›´æ–°

**æ–‡ä»¶**: `packages/admin-web/src/pages/AccountStatusPage.js`

**æ”¹åŠ¨**:
- æ·»åŠ  `loadPlatforms()` æ–¹æ³•
- åœ¨ `useEffect` ä¸­è°ƒç”¨ `loadPlatforms()`
- æ›¿æ¢ç¡¬ç¼–ç çš„å¹³å°é€‰é¡¹ä¸ºåŠ¨æ€ç”Ÿæˆ

**æ•ˆæœç›¸åŒ**ï¼Œå®Œå…¨åŠ¨æ€åŠ è½½ã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin Web (React)                   â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ AccountsPage / AccountStatusPage â”‚â”‚
â”‚ â”‚                                  â”‚â”‚
â”‚ â”‚ useEffect(() => {                â”‚â”‚
â”‚ â”‚   loadPlatforms()  â†â”€â”€â”€ API è°ƒç”¨ â”‚â”‚
â”‚ â”‚ })                               â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ HTTP GET
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Master API               â”‚
    â”‚ GET /api/v1/platforms    â”‚
    â”‚                          â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ â”‚ PlatformsRouter    â”‚   â”‚
    â”‚ â”‚ - æŸ¥è¯¢æ•°æ®åº“        â”‚   â”‚
    â”‚ â”‚ - ç»Ÿè®¡è´¦æˆ·         â”‚   â”‚
    â”‚ â”‚ - æŸ¥è¯¢ Worker èƒ½åŠ› â”‚   â”‚
    â”‚ â”‚ - è¿”å›åˆ—è¡¨         â”‚   â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
         SQLite DB
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ accounts table           â”‚
    â”‚ - platform (douyin, ...) â”‚
    â”‚ - status                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ”¹è¿›æ•ˆæœå¯¹æ¯”

### ä¿®æ”¹å‰ï¼ˆç¡¬ç¼–ç ï¼‰

```javascript
// AccountsPage.js - ç¡¬ç¼–ç å¹³å°åˆ—è¡¨
<Select placeholder="é€‰æ‹©å¹³å°">
  <Option value="douyin">æŠ–éŸ³</Option>
  <Option value="weibo">å¾®åš</Option>        âŒ æœªå®ç°çš„å¹³å°
  <Option value="xiaohongshu">å°çº¢ä¹¦</Option>
</Select>

// é—®é¢˜ï¼š
// âŒ æ–°å¢å¹³å°éœ€è¦ä¿®æ”¹ä»£ç 
// âŒ åŒ…å«æœªå®ç°çš„"å¾®åš"
// âŒ æ— æ³•æ„ŸçŸ¥åç«¯çœŸå®æ”¯æŒçš„å¹³å°
```

### ä¿®æ”¹åï¼ˆåŠ¨æ€åŠ è½½ï¼‰

```javascript
// AccountsPage.js - åŠ¨æ€åŠ è½½
const loadPlatforms = async () => {
  const response = await fetch('http://localhost:3000/api/v1/platforms');
  const data = await response.json();
  setPlatforms(data.data);
};

<Select placeholder="é€‰æ‹©å¹³å°" loading={platformsLoading}>
  {platforms.map(platform => (
    <Option key={platform.value} value={platform.value}>
      {platform.label}
    </Option>
  ))}
</Select>

// ä¼˜ç‚¹ï¼š
// âœ… æ–°å¢å¹³å°æ— éœ€ä¿®æ”¹ Admin Web
// âœ… è‡ªåŠ¨æ„ŸçŸ¥åç«¯æ”¯æŒçš„å¹³å°
// âœ… å®æ—¶æ˜¾ç¤ºå¹³å°ç»Ÿè®¡ä¿¡æ¯
// âœ… æ”¯æŒé™çº§æ–¹æ¡ˆï¼ˆAPI å¤±è´¥æ—¶ï¼‰
```

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### 1. å¯åŠ¨ Master æœåŠ¡å™¨

```bash
cd packages/master
npm start
```

API ç«¯ç‚¹è‡ªåŠ¨å¯ç”¨ï¼š
- `http://localhost:3000/api/v1/platforms`
- `http://localhost:3000/api/v1/platforms/:platform`
- `http://localhost:3000/api/v1/platforms/stats/summary`

### 2. å¯åŠ¨ Admin Web

```bash
cd packages/admin-web
npm start
```

æ‰“å¼€ http://localhost:3001 è®¿é—®åå°ç®¡ç†ç³»ç»Ÿã€‚

å¹³å°åˆ—è¡¨ä¼šè‡ªåŠ¨ä» Master åŠ è½½ã€‚

### 3. æ·»åŠ æ–°å¹³å°

å®Œå…¨æ— éœ€ä¿®æ”¹ Admin Webï¼åªéœ€ï¼š

1. åœ¨ Worker ä¸­åˆ›å»ºæ–°å¹³å°ç›®å½•
2. åˆ›å»º `config.json` å’Œ `platform.js`
3. Admin Web ä¼šè‡ªåŠ¨æ˜¾ç¤ºæ–°å¹³å°

---

## ğŸ“‹ å½±å“èŒƒå›´

### ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¡Œæ•° |
|------|--------|------|
| `packages/master/src/api/routes/platforms.js` | æ–°å»º | 200+ |
| `packages/master/src/index.js` | æŒ‚è½½è·¯ç”± | +6 |
| `packages/admin-web/src/pages/AccountsPage.js` | åŠ¨æ€åŠ è½½å¹³å° | +40 |
| `packages/admin-web/src/pages/AccountStatusPage.js` | åŠ¨æ€åŠ è½½å¹³å° | +40 |

**æ€»è®¡**: 4 ä¸ªæ–‡ä»¶ï¼Œæ–°å¢ ~290 è¡Œä»£ç 

### åŠŸèƒ½å®Œæ•´æ€§

- âœ… Master æä¾›å¹³å°åˆ—è¡¨ API
- âœ… Admin Web åŠ¨æ€åŠ è½½å¹³å°
- âœ… æ”¯æŒé™çº§æ–¹æ¡ˆ
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… å¹³å°ç»Ÿè®¡ä¿¡æ¯

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. æµ‹è¯• API ç«¯ç‚¹

```bash
# è·å–æ‰€æœ‰å¹³å°
curl http://localhost:3000/api/v1/platforms

# è·å–ç‰¹å®šå¹³å°ä¿¡æ¯
curl http://localhost:3000/api/v1/platforms/douyin

# è·å–ç»Ÿè®¡æ±‡æ€»
curl http://localhost:3000/api/v1/platforms/stats/summary
```

### 2. æµ‹è¯• Admin Web

1. æ‰“å¼€ http://localhost:3001/accounts
2. ç‚¹å‡»"æ–°å»ºè´¦æˆ·"
3. æ£€æŸ¥å¹³å°ä¸‹æ‹‰æ¡†æ˜¯å¦æ˜¾ç¤ºä» Master åŠ è½½çš„å¹³å°åˆ—è¡¨
4. å…³é—­ Master æœåŠ¡å™¨
5. åˆ·æ–°é¡µé¢
6. æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºé™çº§çš„é»˜è®¤å¹³å°åˆ—è¡¨

### 3. æµ‹è¯•æ·»åŠ æ–°å¹³å°

1. åœ¨ Worker ä¸­æ·»åŠ æ–°å¹³å°ç›®å½•
2. åˆ›å»º `config.json` å’Œ `platform.js`
3. åˆ·æ–° Admin Web
4. æ–°å¹³å°åº”è¯¥è‡ªåŠ¨æ˜¾ç¤ºåœ¨ä¸‹æ‹‰æ¡†ä¸­

---

## ğŸ’¡ æŠ€æœ¯ç»†èŠ‚

### å¹³å°å‘ç°æœºåˆ¶

Master çš„ `/api/v1/platforms` ç«¯ç‚¹é€šè¿‡ä»¥ä¸‹æ–¹å¼å‘ç°å¹³å°ï¼š

1. **ä»æ•°æ®åº“æŸ¥è¯¢**
   ```sql
   SELECT DISTINCT platform FROM accounts GROUP BY platform
   ```
   - æ‰¾åˆ°å·²åˆ›å»ºçš„è´¦æˆ·æ‰€ä½¿ç”¨çš„å¹³å°

2. **ä» Worker æ³¨å†Œä¿¡æ¯æŸ¥è¯¢**
   - æŸ¥è¯¢æ‰€æœ‰åœ¨çº¿ Worker çš„ `capabilities` å­—æ®µ
   - æå–æ”¯æŒçš„å¹³å°åˆ—è¡¨

3. **é»˜è®¤å¹³å°**
   - å¦‚æœæ•°æ®åº“å’Œ Worker éƒ½æ²¡æœ‰æ‰¾åˆ°ä»»ä½•å¹³å°
   - è¿”å›é»˜è®¤çš„ `douyin` å’Œ `xiaohongshu`

### é”™è¯¯å¤„ç†

- âœ… API è¿æ¥å¤±è´¥ï¼šä½¿ç”¨é»˜è®¤å¹³å°åˆ—è¡¨
- âœ… API å“åº”ä¸ç¬¦é¢„æœŸï¼šä½¿ç”¨é»˜è®¤å¹³å°åˆ—è¡¨
- âœ… æ•°æ®åº“æŸ¥è¯¢é”™è¯¯ï¼šç»§ç»­ä½¿ç”¨å…¶ä»–æ•°æ®æº
- âœ… Worker æ³¨å†Œä¿¡æ¯ä¸å¯ç”¨ï¼šç»§ç»­ä½¿ç”¨æ•°æ®åº“æ•°æ®

### æ€§èƒ½ä¼˜åŒ–

- âœ… å¹³å°åˆ—è¡¨ç¼“å­˜åœ¨å‰ç«¯çŠ¶æ€ä¸­ï¼ˆé¿å…é¢‘ç¹åˆ·æ–°ï¼‰
- âœ… åŠ è½½çŠ¶æ€æ˜¾ç¤ºç»™ç”¨æˆ·
- âœ… å¼‚æ­¥åŠ è½½ï¼Œä¸é˜»å¡ UI æ¸²æŸ“

---

## ğŸ”„ æœªæ¥æ”¹è¿›

å¯é€‰çš„åç»­ä¼˜åŒ–ï¼š

1. **å¹³å°ç¼“å­˜**
   - Admin Web ä¸­ç¼“å­˜å¹³å°åˆ—è¡¨
   - å‡å°‘ API è°ƒç”¨æ¬¡æ•°

2. **å¹³å°æ’åº**
   - API è¿”å›æ’åºåçš„å¹³å°åˆ—è¡¨
   - å¸¸ç”¨å¹³å°ä¼˜å…ˆæ˜¾ç¤º

3. **å¹³å°å›¾æ ‡**
   - åœ¨ API å“åº”ä¸­åŒ…å«å¹³å°å›¾æ ‡
   - å¢å¼º UI ç¾è§‚æ€§

4. **å¹³å°é…ç½®ç®¡ç†**
   - é€šè¿‡ API åŠ¨æ€ç®¡ç†å¹³å°é…ç½®
   - æ”¯æŒå¯ç”¨/ç¦ç”¨å¹³å°

---

## âœ¨ æ€»ç»“

**å®Œå…¨è§£å†³äº†å¤šå¹³å°ç¡¬ç¼–ç é—®é¢˜ï¼**

- âœ… Master åŠ¨æ€æä¾›å¹³å°åˆ—è¡¨
- âœ… Admin Web è‡ªåŠ¨åŠ è½½å¹³å°
- âœ… æ·»åŠ æ–°å¹³å°æ— éœ€ä¿®æ”¹ä»£ç 
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆ
- âœ… ä¿æŒå‘åå…¼å®¹æ€§

**ç³»ç»Ÿç°åœ¨çœŸæ­£æ”¯æŒå¤šå¹³å°ï¼** ğŸ‰

---

**å®ç°æ—¥æœŸ**: 2025-10-20
**æ–¹æ¡ˆ**: A (API åŠ¨æ€åŠ è½½)
**å®Œæˆåº¦**: 100%
**çŠ¶æ€**: å°±ç»ª âœ…
