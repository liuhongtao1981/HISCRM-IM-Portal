# è´¦æˆ·çº§æµè§ˆå™¨éš”ç¦»ç™»å½•æµç¨‹è®¾è®¡

## ğŸ“‹ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### 1. è´¦æˆ·çº§æµè§ˆå™¨éš”ç¦»

æ¯ä¸ªè´¦æˆ·æ‹¥æœ‰ç‹¬ç«‹çš„ï¼š
- âœ… **Browser è¿›ç¨‹** - å®Œå…¨ç‹¬ç«‹çš„æµè§ˆå™¨å®ä¾‹
- âœ… **æŒ‡çº¹é…ç½®** - Canvasã€WebGLã€Audio ç­‰æŒ‡çº¹
- âœ… **Cookie å­˜å‚¨** - æŒä¹…åŒ–ç™»å½•çŠ¶æ€
- âœ… **LocalStorage** - æœ¬åœ°å­˜å‚¨æ•°æ®
- âœ… **ä»£ç†é…ç½®** - ç‹¬ç«‹çš„ IP åœ°å€

### 2. ç›®å½•ç»“æ„

```
packages/worker/data/browser/
  â””â”€â”€ {worker_id}/
      â”œâ”€â”€ fingerprints/
      â”‚   â”œâ”€â”€ account-123_fingerprint.json  â† è´¦æˆ·1çš„æŒ‡çº¹é…ç½®
      â”‚   â””â”€â”€ account-456_fingerprint.json  â† è´¦æˆ·2çš„æŒ‡çº¹é…ç½®
      â””â”€â”€ storage/
          â”œâ”€â”€ account-123_storage.json      â† è´¦æˆ·1çš„ Cookie/Storage
          â””â”€â”€ account-456_storage.json      â† è´¦æˆ·2çš„ Cookie/Storage
```

## ğŸ”„ ç™»å½•æµç¨‹è®¾è®¡

### é˜¶æ®µ 1: åˆå§‹åŒ–è´¦æˆ·æµè§ˆå™¨

```javascript
// æ­¥éª¤1: Worker æ”¶åˆ°ç™»å½•è¯·æ±‚
handleLoginRequest({ account_id, session_id, platform, proxy })
  â†“
// æ­¥éª¤2: è·å–å¹³å°å®ä¾‹
const platformInstance = platformManager.getPlatform(platform)
  â†“
// æ­¥éª¤3: æ£€æŸ¥è´¦æˆ·æµè§ˆå™¨å®ä¾‹
const browser = browserManager.getBrowserForAccount(account_id)
  â†“
// å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„æµè§ˆå™¨å®ä¾‹
if (!browser) {
  browser = await browserManager.launchBrowserForAccount(account_id, { proxy })
  // ç”Ÿæˆå¹¶ä¿å­˜æŒ‡çº¹é…ç½®
  // åˆ›å»ºç‹¬ç«‹çš„ Browser Context
}
```

### é˜¶æ®µ 2: æ™ºèƒ½è¯†åˆ«ç™»å½•æ–¹å¼

```javascript
// å¹³å°è„šæœ¬æ£€æµ‹ç™»å½•ç•Œé¢ç±»å‹
const loginMethod = await platform.detectLoginMethod(page)

è¿”å›å€¼:
- 'qrcode'   â†’ äºŒç»´ç ç™»å½•
- 'sms'      â†’ æ‰‹æœºçŸ­ä¿¡éªŒè¯
- 'password' â†’ å¯†ç ç™»å½•
- 'logged_in' â†’ å·²ç™»å½•çŠ¶æ€
```

**å®ç°é€»è¾‘**:

```javascript
// DouyinPlatform.detectLoginMethod()
async detectLoginMethod(page) {
  await page.goto('https://www.douyin.com/', { waitUntil: 'networkidle' });
  
  // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
  const userInfo = await page.$('.user-info');
  if (userInfo) {
    return { type: 'logged_in', data: await this.getUserInfo(page) };
  }
  
  // æ£€æŸ¥äºŒç»´ç 
  const qrcode = await page.$('.qrcode-img');
  if (qrcode) {
    return { type: 'qrcode', element: qrcode };
  }
  
  // æ£€æŸ¥çŸ­ä¿¡éªŒè¯
  const smsInput = await page.$('input[placeholder*="æ‰‹æœºå·"]');
  if (smsInput) {
    return { type: 'sms', element: smsInput };
  }
  
  // æ£€æŸ¥å¯†ç ç™»å½•
  const passwordInput = await page.$('input[type="password"]');
  if (passwordInput) {
    return { type: 'password', elements: { username, password } };
  }
  
  return { type: 'unknown' };
}
```

### é˜¶æ®µ 3: å¤„ç†ä¸åŒç™»å½•æ–¹å¼

#### 3.1 äºŒç»´ç ç™»å½•

```javascript
async handleQRCodeLogin(page, accountId, sessionId) {
  logger.info(`[QRCode Login] Starting for account ${accountId}`);
  
  // 1. å®šä½äºŒç»´ç å…ƒç´ 
  const qrElement = await page.waitForSelector('.qrcode-img', { 
    timeout: 10000 
  });
  
  // 2. æˆªå–äºŒç»´ç å›¾ç‰‡
  const qrImage = await qrElement.screenshot();
  const qrBase64 = qrImage.toString('base64');
  
  // 3. è·å–è¿‡æœŸæ—¶é—´ï¼ˆå¦‚æœé¡µé¢æœ‰æ˜¾ç¤ºï¼‰
  let expiresAt = Date.now() + 300000; // é»˜è®¤5åˆ†é’Ÿ
  try {
    const expiryText = await page.$eval('.qr-expire-time', el => el.textContent);
    // è§£æè¿‡æœŸæ—¶é—´...
  } catch (e) {
    // ä½¿ç”¨é»˜è®¤å€¼
  }
  
  // 4. å‘é€äºŒç»´ç åˆ° Master â†’ Admin Web
  this.workerBridge.sendLoginStatus(accountId, sessionId, 'qrcode_ready', {
    qr_code_data: `data:image/png;base64,${qrBase64}`,
    expires_at: Math.floor(expiresAt / 1000),
    login_method: 'qrcode',
  });
  
  // 5. å¯åŠ¨å¿ƒè·³ç›‘æ§ï¼ˆç­‰å¾…ç”¨æˆ·æ‰«ç ï¼‰
  const loginSuccess = await this.waitForLogin(page, accountId, sessionId, {
    timeout: 300000, // 5åˆ†é’Ÿ
    checkInterval: 2000, // æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡
  });
  
  return loginSuccess;
}
```

#### 3.2 çŸ­ä¿¡éªŒè¯ç ç™»å½•

```javascript
async handleSMSLogin(page, accountId, sessionId) {
  logger.info(`[SMS Login] Starting for account ${accountId}`);
  
  // 1. æ£€æµ‹æ‰‹æœºå·è¾“å…¥æ¡†
  const phoneInput = await page.waitForSelector('input[placeholder*="æ‰‹æœºå·"]');
  
  // 2. é€šçŸ¥ Web ç«¯éœ€è¦è¾“å…¥æ‰‹æœºå·
  this.workerBridge.sendLoginStatus(accountId, sessionId, 'sms_input_required', {
    login_method: 'sms',
    step: 'phone_number',
    message: 'è¯·è¾“å…¥æ‰‹æœºå·',
  });
  
  // 3. ç­‰å¾… Web ç«¯ç”¨æˆ·è¾“å…¥æ‰‹æœºå·
  const phoneNumber = await this.waitForUserInput(sessionId, 'phone_number', {
    timeout: 120000, // 2åˆ†é’Ÿ
  });
  
  // 4. åœ¨é¡µé¢è¾“å…¥æ‰‹æœºå·
  await phoneInput.fill(phoneNumber);
  
  // 5. ç‚¹å‡»"è·å–éªŒè¯ç "æŒ‰é’®
  const getSMSButton = await page.$('button:has-text("è·å–éªŒè¯ç ")');
  await getSMSButton.click();
  
  // 6. ç­‰å¾…éªŒè¯ç è¾“å…¥æ¡†å‡ºç°
  await page.waitForSelector('input[placeholder*="éªŒè¯ç "]');
  
  // 7. é€šçŸ¥ Web ç«¯éœ€è¦è¾“å…¥éªŒè¯ç 
  this.workerBridge.sendLoginStatus(accountId, sessionId, 'sms_input_required', {
    login_method: 'sms',
    step: 'verification_code',
    message: `éªŒè¯ç å·²å‘é€è‡³ ${phoneNumber}`,
  });
  
  // 8. ç­‰å¾… Web ç«¯ç”¨æˆ·è¾“å…¥éªŒè¯ç 
  const verificationCode = await this.waitForUserInput(sessionId, 'verification_code', {
    timeout: 120000,
  });
  
  // 9. åœ¨é¡µé¢è¾“å…¥éªŒè¯ç 
  const codeInput = await page.$('input[placeholder*="éªŒè¯ç "]');
  await codeInput.fill(verificationCode);
  
  // 10. ç‚¹å‡»"ç™»å½•"æŒ‰é’®
  const loginButton = await page.$('button:has-text("ç™»å½•")');
  await loginButton.click();
  
  // 11. ç­‰å¾…ç™»å½•æˆåŠŸ
  const loginSuccess = await this.waitForLogin(page, accountId, sessionId, {
    timeout: 30000,
  });
  
  return loginSuccess;
}
```

### é˜¶æ®µ 4: å¿ƒè·³æ£€æµ‹ç™»å½•çŠ¶æ€ï¼ˆæ¡†æ¶æ–¹æ³•ï¼‰

```javascript
/**
 * å¿ƒè·³æ£€æµ‹ç™»å½•çŠ¶æ€
 * è¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¡†æ¶æ–¹æ³•ï¼Œæ‰€æœ‰å¹³å°éƒ½å¯ä»¥ä½¿ç”¨
 */
async waitForLogin(page, accountId, sessionId, options = {}) {
  const {
    timeout = 300000,        // é»˜è®¤5åˆ†é’Ÿè¶…æ—¶
    checkInterval = 2000,    // é»˜è®¤æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡
    checkMethod = 'auto',    // 'auto' | 'element' | 'cookie' | 'url'
  } = options;
  
  logger.info(`[Login Monitor] Starting for account ${accountId}, timeout: ${timeout}ms`);
  
  const startTime = Date.now();
  let lastStatus = null;
  
  return new Promise((resolve, reject) => {
    const checkTimer = setInterval(async () => {
      try {
        // æ£€æŸ¥æ˜¯å¦è¶…æ—¶
        if (Date.now() - startTime > timeout) {
          clearInterval(checkTimer);
          this.workerBridge.sendLoginStatus(accountId, sessionId, 'timeout', {
            message: 'ç™»å½•è¶…æ—¶ï¼Œè¯·é‡è¯•',
          });
          reject(new Error('Login timeout'));
          return;
        }
        
        // æ‰§è¡Œç™»å½•çŠ¶æ€æ£€æŸ¥
        const loginStatus = await this.checkLoginStatus(page, checkMethod);
        
        if (loginStatus.isLoggedIn) {
          // ç™»å½•æˆåŠŸï¼
          clearInterval(checkTimer);
          
          logger.info(`[Login Monitor] Login successful for account ${accountId}`);
          
          // ä¿å­˜ç™»å½•çŠ¶æ€ï¼ˆCookieã€Storageï¼‰
          await this.saveLoginState(page, accountId);
          
          // é€šçŸ¥ Master â†’ Admin Web
          this.workerBridge.sendLoginStatus(accountId, sessionId, 'success', {
            user_info: loginStatus.userInfo,
            timestamp: Date.now(),
          });
          
          resolve(true);
          
        } else if (loginStatus.status !== lastStatus) {
          // çŠ¶æ€å˜åŒ–ï¼Œé€šçŸ¥å‰ç«¯
          lastStatus = loginStatus.status;
          
          if (loginStatus.status === 'scanning') {
            this.workerBridge.sendLoginStatus(accountId, sessionId, 'scanning', {
              message: 'æ­£åœ¨æ‰«ç ä¸­...',
            });
          }
        }
        
      } catch (error) {
        logger.error(`[Login Monitor] Check failed for account ${accountId}:`, error);
        clearInterval(checkTimer);
        
        this.workerBridge.sendLoginStatus(accountId, sessionId, 'failed', {
          error_message: error.message,
        });
        
        reject(error);
      }
    }, checkInterval);
  });
}

/**
 * æ£€æŸ¥ç™»å½•çŠ¶æ€çš„å¤šç§æ–¹æ³•
 */
async checkLoginStatus(page, method = 'auto') {
  // æ–¹æ³•1: æ£€æŸ¥ç‰¹å®šå…ƒç´ ï¼ˆæœ€å¸¸ç”¨ï¼‰
  if (method === 'auto' || method === 'element') {
    const userInfo = await page.$('.user-info, .user-avatar, [data-e2e="user-info"]');
    if (userInfo) {
      const userData = await this.extractUserInfo(page);
      return { isLoggedIn: true, status: 'logged_in', userInfo: userData };
    }
  }
  
  // æ–¹æ³•2: æ£€æŸ¥ Cookie
  if (method === 'auto' || method === 'cookie') {
    const cookies = await page.context().cookies();
    const sessionCookie = cookies.find(c => 
      c.name.includes('session') || 
      c.name.includes('token') ||
      c.name.includes('sid')
    );
    
    if (sessionCookie && sessionCookie.value) {
      return { isLoggedIn: true, status: 'logged_in' };
    }
  }
  
  // æ–¹æ³•3: æ£€æŸ¥ URL å˜åŒ–
  if (method === 'auto' || method === 'url') {
    const currentUrl = page.url();
    if (!currentUrl.includes('/login') && !currentUrl.includes('/passport')) {
      // URL ä¸å†æ˜¯ç™»å½•é¡µï¼Œå¯èƒ½å·²ç™»å½•
      const userInfo = await page.$('.user-info, .user-avatar');
      if (userInfo) {
        return { isLoggedIn: true, status: 'logged_in' };
      }
    }
  }
  
  // æ–¹æ³•4: æ£€æŸ¥æ˜¯å¦åœ¨æ‰«ç ä¸­
  const scanningHint = await page.$('.qr-scanning, .scan-success');
  if (scanningHint) {
    return { isLoggedIn: false, status: 'scanning' };
  }
  
  // æ–¹æ³•5: æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
  const expiredHint = await page.$('.qr-expired, .expired-tip');
  if (expiredHint) {
    return { isLoggedIn: false, status: 'expired' };
  }
  
  return { isLoggedIn: false, status: 'pending' };
}
```

### é˜¶æ®µ 5: ä¿å­˜ç™»å½•çŠ¶æ€

```javascript
async saveLoginState(page, accountId) {
  logger.info(`[Storage] Saving login state for account ${accountId}`);
  
  // 1. ä¿å­˜ Storage Stateï¼ˆåŒ…å« Cookiesã€LocalStorageã€SessionStorageï¼‰
  const storageStatePath = this.browserManager.getStorageStatePath(accountId);
  await page.context().storageState({ path: storageStatePath });
  
  logger.info(`[Storage] Saved storage state to ${storageStatePath}`);
  
  // 2. æå–ç”¨æˆ·ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
  const userInfo = await this.extractUserInfo(page);
  if (userInfo) {
    const userInfoPath = path.join(
      this.browserManager.config.dataDir,
      'user-info',
      `${accountId}_user.json`
    );
    fs.writeFileSync(userInfoPath, JSON.stringify(userInfo, null, 2));
    logger.info(`[Storage] Saved user info for account ${accountId}`);
  }
  
  return true;
}

async extractUserInfo(page) {
  try {
    // æ ¹æ®ä¸åŒå¹³å°æå–ç”¨æˆ·ä¿¡æ¯
    const userInfo = await page.evaluate(() => {
      // å°è¯•ä»é¡µé¢ä¸­æå–ç”¨æˆ·ä¿¡æ¯
      const avatar = document.querySelector('.user-avatar img')?.src;
      const nickname = document.querySelector('.user-nickname')?.textContent;
      const uid = document.querySelector('[data-user-id]')?.dataset.userId;
      
      return { avatar, nickname, uid };
    });
    
    return userInfo;
  } catch (error) {
    logger.warn('Failed to extract user info:', error);
    return null;
  }
}
```

## ğŸ¯ Web ç«¯ç•Œé¢è®¾è®¡

### 1. ç»Ÿä¸€çš„ç™»å½•æ¨¡æ€æ¡†

```javascript
// LoginModal.jsx
const LoginModal = ({ visible, onCancel, loginData }) => {
  const { login_method, qr_code_data, step, message } = loginData || {};
  
  // äºŒç»´ç ç™»å½•
  if (login_method === 'qrcode') {
    return (
      <Modal visible={visible} onCancel={onCancel}>
        <QRCodeDisplay 
          qrData={qr_code_data}
          expiresAt={loginData.expires_at}
        />
      </Modal>
    );
  }
  
  // çŸ­ä¿¡éªŒè¯ç™»å½•
  if (login_method === 'sms') {
    if (step === 'phone_number') {
      return (
        <Modal visible={visible} onCancel={onCancel}>
          <PhoneNumberInput 
            onSubmit={(phone) => handlePhoneSubmit(phone)}
          />
        </Modal>
      );
    }
    
    if (step === 'verification_code') {
      return (
        <Modal visible={visible} onCancel={onCancel}>
          <VerificationCodeInput 
            phoneNumber={loginData.phone_number}
            onSubmit={(code) => handleCodeSubmit(code)}
          />
        </Modal>
      );
    }
  }
  
  return null;
};
```

### 2. Socket.IO äº‹ä»¶å¤„ç†

```javascript
// socketContext.js

// ç›‘å¬ç™»å½•çŠ¶æ€æ›´æ–°
socket.on('login:status:update', (data) => {
  const { account_id, session_id, status, ...extraData } = data;
  
  switch (status) {
    case 'qrcode_ready':
      // æ˜¾ç¤ºäºŒç»´ç 
      setLoginModalData({
        visible: true,
        login_method: 'qrcode',
        qr_code_data: extraData.qr_code_data,
        expires_at: extraData.expires_at,
      });
      break;
      
    case 'sms_input_required':
      // æ˜¾ç¤ºçŸ­ä¿¡è¾“å…¥æ¡†
      setLoginModalData({
        visible: true,
        login_method: 'sms',
        step: extraData.step,
        message: extraData.message,
      });
      break;
      
    case 'scanning':
      // æ›´æ–°æç¤ºæ–‡å­—
      message.info('æ­£åœ¨æ‰«ç ä¸­...');
      break;
      
    case 'success':
      // ç™»å½•æˆåŠŸ
      message.success('ç™»å½•æˆåŠŸï¼');
      setLoginModalData({ visible: false });
      refreshAccounts();
      break;
      
    case 'failed':
    case 'timeout':
      // ç™»å½•å¤±è´¥
      message.error(extraData.error_message || 'ç™»å½•å¤±è´¥');
      setLoginModalData({ visible: false });
      break;
  }
});

// å‘é€ç”¨æˆ·è¾“å…¥ï¼ˆæ‰‹æœºå·ã€éªŒè¯ç ï¼‰
const submitUserInput = (sessionId, inputType, value) => {
  socket.emit('master:login:user_input', {
    session_id: sessionId,
    input_type: inputType,  // 'phone_number' | 'verification_code'
    value: value,
  });
};
```

## ğŸ“Š æ•°æ®æµå›¾

```
ç”¨æˆ·ç‚¹å‡»"ç™»å½•"
    â†“
Web: socket.emit('master:login:start', { account_id, worker_id })
    â†“
Master: åˆ›å»º login_sessions è®°å½•
    â†“
Master: workerSocket.emit('master:login:start', { account_id, platform, proxy })
    â†“
Worker: æ£€æŸ¥/åˆ›å»ºè´¦æˆ·æµè§ˆå™¨å®ä¾‹
    â†“
Worker: platformInstance.startLogin()
    â†“
Platform: detectLoginMethod() â†’ 'qrcode' | 'sms'
    â†“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ åˆ†æ”¯1: äºŒç»´ç ç™»å½•                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Platform: handleQRCodeLogin()              â”‚
â”‚   â†“                                        â”‚
â”‚ Platform: æˆªå–äºŒç»´ç  â†’ sendLoginStatus()   â”‚
â”‚   â†“                                        â”‚
â”‚ Master: adminSocket.emit('login:status:update')â”‚
â”‚   â†“                                        â”‚
â”‚ Web: æ˜¾ç¤ºäºŒç»´ç æ¨¡æ€æ¡†                      â”‚
â”‚   â†“                                        â”‚
â”‚ Platform: waitForLogin() å¿ƒè·³æ£€æµ‹          â”‚
â”‚   â†“                                        â”‚
â”‚ User: æ‰«ç ç¡®è®¤                             â”‚
â”‚   â†“                                        â”‚
â”‚ Platform: checkLoginStatus() â†’ logged_in   â”‚
â”‚   â†“                                        â”‚
â”‚ Platform: saveLoginState() ä¿å­˜ Cookie     â”‚
â”‚   â†“                                        â”‚
â”‚ Platform: sendLoginStatus('success')       â”‚
â”‚   â†“                                        â”‚
â”‚ Web: æ˜¾ç¤º"ç™»å½•æˆåŠŸ"                        â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ åˆ†æ”¯2: çŸ­ä¿¡éªŒè¯ç™»å½•                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Platform: handleSMSLogin()                 â”‚
â”‚   â†“                                        â”‚
â”‚ Platform: sendLoginStatus('sms_input_required', step='phone_number')â”‚
â”‚   â†“                                        â”‚
â”‚ Web: æ˜¾ç¤ºæ‰‹æœºå·è¾“å…¥æ¡†                      â”‚
â”‚   â†“                                        â”‚
â”‚ User: è¾“å…¥æ‰‹æœºå·                           â”‚
â”‚   â†“                                        â”‚
â”‚ Web: socket.emit('master:login:user_input')â”‚
â”‚   â†“                                        â”‚
â”‚ Worker: æ”¶åˆ°è¾“å…¥ â†’ å¡«å……åˆ°é¡µé¢             â”‚
â”‚   â†“                                        â”‚
â”‚ Platform: ç‚¹å‡»"è·å–éªŒè¯ç "                 â”‚
â”‚   â†“                                        â”‚
â”‚ Platform: sendLoginStatus('sms_input_required', step='verification_code')â”‚
â”‚   â†“                                        â”‚
â”‚ Web: æ˜¾ç¤ºéªŒè¯ç è¾“å…¥æ¡†                      â”‚
â”‚   â†“                                        â”‚
â”‚ User: è¾“å…¥éªŒè¯ç                            â”‚
â”‚   â†“                                        â”‚
â”‚ Platform: å¡«å……éªŒè¯ç  â†’ ç‚¹å‡»ç™»å½•           â”‚
â”‚   â†“                                        â”‚
â”‚ Platform: waitForLogin() â†’ logged_in       â”‚
â”‚   â†“                                        â”‚
â”‚ Web: æ˜¾ç¤º"ç™»å½•æˆåŠŸ"                        â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

## ğŸ”§ æ ¸å¿ƒä¼˜åŠ¿

### 1. è´¦æˆ·å®Œå…¨éš”ç¦»
- âœ… æ¯ä¸ªè´¦æˆ·ç‹¬ç«‹çš„ Browser è¿›ç¨‹
- âœ… ç‹¬ç«‹çš„æŒ‡çº¹é…ç½®ï¼ˆä¸ä¼šç›¸äº’å½±å“ï¼‰
- âœ… ç‹¬ç«‹çš„ Cookie å­˜å‚¨
- âœ… æ”¯æŒä¸åŒçš„ä»£ç†é…ç½®

### 2. æ¡†æ¶çº§é€šç”¨æ–¹æ³•
- âœ… `detectLoginMethod()` - æ™ºèƒ½è¯†åˆ«ç™»å½•æ–¹å¼
- âœ… `waitForLogin()` - é€šç”¨çš„ç™»å½•å¿ƒè·³æ£€æµ‹
- âœ… `checkLoginStatus()` - å¤šç§æ–¹å¼æ£€æµ‹ç™»å½•çŠ¶æ€
- âœ… `saveLoginState()` - è‡ªåŠ¨ä¿å­˜ç™»å½•çŠ¶æ€

### 3. æ”¯æŒå¤šç§ç™»å½•æ–¹å¼
- âœ… äºŒç»´ç æ‰«ç ç™»å½•
- âœ… æ‰‹æœºçŸ­ä¿¡éªŒè¯ç™»å½•
- âœ… è´¦å·å¯†ç ç™»å½•ï¼ˆå¦‚æœå¹³å°æ”¯æŒï¼‰
- âœ… Cookie å¯¼å…¥ç™»å½•

### 4. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- âœ… å®æ—¶çŠ¶æ€æ›´æ–°
- âœ… ç»Ÿä¸€çš„ç™»å½•æ¨¡æ€æ¡†
- âœ… æ™ºèƒ½è¯†åˆ«ç™»å½•æ–¹å¼ï¼Œæ— éœ€ç”¨æˆ·é€‰æ‹©
- âœ… è¯¦ç»†çš„è¿›åº¦æç¤º

## ğŸ“ ä¸‹ä¸€æ­¥å®æ–½è®¡åˆ’

1. **ä¿®æ”¹ `PlatformBase`** - æ·»åŠ é€šç”¨ç™»å½•æ¡†æ¶æ–¹æ³•
2. **å®ç° `DouyinPlatform`** - å®ç°æŠ–éŸ³çš„ç™»å½•æ£€æµ‹é€»è¾‘
3. **åˆ›å»º `LoginStatusMonitor`** - ç‹¬ç«‹çš„å¿ƒè·³æ£€æµ‹ç±»
4. **æ›´æ–° Web ç«¯ç»„ä»¶** - æ”¯æŒå¤šç™»å½•æ–¹å¼çš„ç»Ÿä¸€æ¨¡æ€æ¡†
5. **æµ‹è¯•è´¦æˆ·éš”ç¦»** - éªŒè¯å¤šè´¦æˆ·åŒæ—¶ç™»å½•çš„éš”ç¦»æ€§

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-10-16  
**ç»´æŠ¤äººå‘˜**: Development Team
