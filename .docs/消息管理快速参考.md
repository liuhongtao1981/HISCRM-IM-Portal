# 消息管理页面 - 快速参考

## 菜单位置

左侧菜单 → 💬 消息管理 → `/messages`

## 主要功能

### 📊 统计卡片
- **总评论数**: 全部评论数量
- **今日评论**: 今天新增评论数
- **总私信数**: 全部私信数量
- **今日私信**: 今天新增私信数

### 🔍 筛选功能
- **消息类型**
  - 全部消息: 显示全部
  - 今日消息: 只显示今天的消息
- **搜索框**: 按内容搜索

### 📋 表格功能

#### 评论表格列
| 列名 | 说明 |
|-----|------|
| 时间 | 消息时间（**红色标记**表示今日消息） |
| 账号 | 账户ID（蓝色标签） |
| 评论内容 | 💬 评论正文 |
| 发布者 | 评论者用户名 |
| 视频ID | 关联视频ID |
| 来源 | 平台标识 |

#### 私信表格列
| 列名 | 说明 |
|-----|------|
| 时间 | 消息时间（**红色标记**表示今日消息） |
| 账号 | 账户ID（绿色标签） |
| 私信内容 | 📩 私信正文 |
| 发送者 | 发送者用户名 |
| 方向 | 入站/出站 |
| 来源 | 平台标识 |

### ⏱️ 自动刷新设置

```
刷新间隔选择:
- 每10秒刷新  (实时性最高)
- 每30秒刷新  (推荐，平衡性能)
- 每60秒刷新  (低频更新)
- 不自动刷新  (手动点击刷新)
```

立即刷新按钮 可手动立即刷新一次

## API 端点

### 获取评论
```
GET /api/v1/comments
参数:
  - account_id: 账户ID（可选）
  - sort: 排序字段 (created_at | detected_at)
  - order: 排序顺序 (asc | desc) - 默认desc
  - created_at_start: 开始时间戳
  - limit: 返回数量 (默认100)
```

### 获取私信
```
GET /api/v1/direct-messages
参数:
  - account_id: 账户ID（可选）
  - direction: 方向 (inbound | outbound)
  - sort: 排序字段 (created_at | detected_at)
  - order: 排序顺序 (asc | desc) - 默认desc
  - limit: 返回数量 (默认100)
```

## 今日消息识别

**判断逻辑**:
- 时间戳 >= 今天 00:00:00 的 Unix 时间戳

**视觉标记**:
- ✅ 【今日】标签前缀
- ✅ 红色背景 (#fff2f0)
- ✅ 红色文字 (#ff4d4f)
- ✅ 加粗显示

**示例**:
```
【今日】10-18 14:35:22  ← 红色背景和文字
10-17 09:15:30          ← 正常显示
```

## 标签页切换

### 评论 (💬 评论管理)
- 显示所有评论
- 可按账号筛选
- 最新消息优先显示

### 私信 (📩 私信管理)
- 显示所有私信
- 支持入站/出站筛选
- 最新消息优先显示

## 数据刷新

### 自动刷新流程
```
1. 用户选择刷新间隔（10/30/60秒）
2. 系统启动定时器
3. 每隔指定秒数调用 API 获取最新数据
4. 页面自动更新表格
5. 标签页切换时自动刷新相应数据
```

### 手动刷新
- 点击"立即刷新"按钮
- 实时获取最新数据
- 加载中显示转圈图标

## 分页

- 每页显示: 20 条记录
- 总记录数显示在分页信息中
- 可跳转到指定页码

## 排序

**默认排序**: 按 `created_at` 倒序（最新优先）

**排序效果**:
```
最新的消息 ▲
          |
          |  （按时间倒序）
          |
最老的消息 ▼
```

## 使用场景示例

### 场景1: 查看今天新增评论
1. 点击左菜单 → 消息管理
2. 选择消息类型 → "今日消息"
3. 点击"评论"标签页
4. 观察红色高亮的消息
5. 设置 10 秒自动刷新保持最新

### 场景2: 查看特定账号的入站私信
1. 点击左菜单 → 消息管理
2. 点击"私信"标签页
3. 搜索框输入账号或发送者
4. 表格中查看"方向"列过滤入站消息
5. 按需设置自动刷新

### 场景3: 导出今日消息
1. 点击左菜单 → 消息管理
2. 选择消息类型 → "今日消息"
3. 等待表格加载完成
4. （未来功能）点击导出按钮保存为 CSV

## 性能建议

- ✅ 建议使用 30 秒自动刷新（平衡实时性和性能）
- ✅ 大数据量时可使用搜索框缩小范围
- ✅ 避免同时打开多个标签页的自动刷新
- ✅ 移动设备上可改用手动刷新

## 故障排除

### 问题: 表格为空
- ✅ 检查网络连接
- ✅ 确认账号已有消息产生
- ✅ 点击立即刷新按钮

### 问题: 今日消息没有红色标记
- ✅ 检查消息的 created_at 时间戳
- ✅ 确认本地系统时间正确
- ✅ 刷新页面重试

### 问题: 自动刷新不工作
- ✅ 检查是否选择了"不自动刷新"选项
- ✅ 检查浏览器控制台是否有错误
- ✅ 检查网络连接状态

## 相关文件

- 📄 前端页面: `packages/admin-web/src/pages/MessageManagementPage.js`
- 🔌 API 服务: `packages/admin-web/src/services/api.js`
- 🖼️ 路由配置: `packages/admin-web/src/App.js`
- 🔗 后端端点: `packages/master/src/api/routes/messages.js`
- 🧪 测试脚本: `tests/test-message-management.js`
- 📚 完整文档: `.docs/消息管理页面设计.md`
