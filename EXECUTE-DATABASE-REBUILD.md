# ğŸ“Œ æ•°æ®åº“é‡å»ºæ‰§è¡ŒæŒ‡ä»¤

**åˆ›å»ºæ—¶é—´**: 2025-10-27
**æ‰§è¡ŒçŠ¶æ€**: â¸ï¸ ç­‰å¾…ç”¨æˆ·æ‰§è¡Œ

---

## âš ï¸ é‡è¦è¯´æ˜

å½“å‰æ•°æ®åº“æ–‡ä»¶è¢« Node è¿›ç¨‹å ç”¨ï¼Œæ— æ³•ç›´æ¥åˆ é™¤ã€‚éœ€è¦æ‚¨æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤å®Œæˆæ•°æ®åº“é‡å»ºã€‚

---

## ğŸ“‹ æ‰§è¡Œæ­¥éª¤

### Step 1: å…³é—­æ‰€æœ‰æ•°æ®åº“è¿æ¥

è¯·å…³é—­ä»¥ä¸‹æ‰€æœ‰è¿›ç¨‹ï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰ï¼š

```bash
# 1. Master æœåŠ¡å™¨
æŒ‰ Ctrl+C åœæ­¢ Master è¿›ç¨‹

# 2. Worker è¿›ç¨‹
æŒ‰ Ctrl+C åœæ­¢ Worker è¿›ç¨‹

# 3. æ‰€æœ‰æµ‹è¯•è„šæœ¬
æŒ‰ Ctrl+C åœæ­¢ä»»ä½•æ­£åœ¨è¿è¡Œçš„æµ‹è¯•

# 4. éªŒè¯æ²¡æœ‰ Node è¿›ç¨‹å ç”¨æ•°æ®åº“
tasklist | grep node
```

### Step 2: æ‰§è¡Œæ•°æ®åº“é‡å»ºè„šæœ¬

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

```bash
node scripts/rebuild-database.js
```

### Step 3: éªŒè¯é‡å»ºç»“æœ

è„šæœ¬ä¼šè‡ªåŠ¨éªŒè¯ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… æ•°æ®åº“é‡å»ºå®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Œ è¯´æ˜:
   - æ–°æ•°æ®åº“ä½¿ç”¨æœ€ç»ˆ schema (v1.0)
   - å·²è¿ç§»æ ¸å¿ƒé…ç½®æ•°æ® (accounts, workers, proxies)
   - ä¸šåŠ¡æ•°æ®è¡¨å·²æ¸…ç©º
   - ç°åœ¨å¯ä»¥å¯åŠ¨ Master å’Œ Worker å¼€å§‹çˆ¬å–æ•°æ®
```

---

## âœ… é‡å»ºå®Œæˆå

### 1. å¯åŠ¨ Master

```bash
cd packages/master
npm start
```

### 2. å¯åŠ¨ Worker

```bash
cd packages/worker
npm start
```

### 3. éªŒè¯æ•°æ®çˆ¬å–

Worker ä¼šè‡ªåŠ¨å¼€å§‹ç›‘æ§å’Œçˆ¬å–æ•°æ®åˆ°ä»¥ä¸‹è¡¨ï¼š
- `contents` - ä½œå“æ•°æ®
- `comments` - è¯„è®ºæ•°æ®
- `discussions` - è®¨è®ºæ•°æ®
- `direct_messages` - ç§ä¿¡æ•°æ®
- `conversations` - ä¼šè¯æ•°æ®

---

## ğŸ“Š å·²å®Œæˆçš„å·¥ä½œ

æœ¬æ¬¡ä¼šè¯å·²å®Œæˆï¼š

1. âœ… **works â†’ contents é‡å‘½å**
   - è¡¨å: `works` â†’ `contents`
   - å­—æ®µ: `platform_work_id` â†’ `platform_content_id`
   - ç»Ÿè®¡å­—æ®µæ·»åŠ  `stats_` å‰ç¼€
   - è´¦æˆ·è¡¨å­—æ®µ: `total_works` â†’ `total_contents`
   - æ‰¹é‡ä»£ç æ›´æ–°: 51 ä¸ªæ–‡ä»¶ï¼Œ626 å¤„æ›¿æ¢

2. âœ… **æ¸…ç†è¿ç§»å†å²**
   - åˆ é™¤æ‰€æœ‰ `migrate-*.js` è¿ç§»è„šæœ¬
   - `schema.sql` ç°ä¸ºåˆå§‹ç‰ˆæœ¬ (v1.0)
   - ç®€åŒ–æ•°æ®åº“åˆå§‹åŒ–æµç¨‹

3. âœ… **åˆ›å»ºé‡å»ºå·¥å…·**
   - `scripts/rebuild-database.js` - ä¸€é”®é‡å»ºè„šæœ¬
   - `scripts/migrate-config-from-backup.js` - é…ç½®è¿ç§»è„šæœ¬
   - `docs/æ•°æ®åº“é‡å»ºæŒ‡å—.md` - å®Œæ•´æ–‡æ¡£

4. âœ… **Git æäº¤**
   - æäº¤ 1: `436390a` - works â†’ contents é‡å‘½å
   - æäº¤ 2: `f5ac6ae` - ç§»é™¤è¿ç§»è„šæœ¬ï¼Œæ·»åŠ é‡å»ºå·¥å…·

---

## ğŸ“ å…³é”®æ–‡ä»¶

### è„šæœ¬æ–‡ä»¶
- [scripts/rebuild-database.js](scripts/rebuild-database.js) - **ä¸€é”®é‡å»ºï¼ˆæ¨èï¼‰**
- [scripts/migrate-config-from-backup.js](scripts/migrate-config-from-backup.js) - é…ç½®è¿ç§»
- [scripts/README-æ•°æ®åº“é‡å»º.md](scripts/README-æ•°æ®åº“é‡å»º.md) - å¿«é€ŸæŒ‡å—

### æ–‡æ¡£
- [docs/æ•°æ®åº“é‡å»ºæŒ‡å—.md](docs/æ•°æ®åº“é‡å»ºæŒ‡å—.md) - **è¯¦ç»†æŒ‡å—**
- [docs/worksé‡å‘½åä¸ºcontentså®ŒæˆæŠ¥å‘Š.md](docs/worksé‡å‘½åä¸ºcontentså®ŒæˆæŠ¥å‘Š.md) - é‡å‘½åæŠ¥å‘Š

### Schema
- [packages/master/src/database/schema.sql](packages/master/src/database/schema.sql) - æœ€ç»ˆ schema (v1.0)
- [packages/master/src/database/init.js](packages/master/src/database/init.js) - åˆå§‹åŒ–è„šæœ¬

### å¤‡ä»½
- `packages/master/data/master.db.config_backup_20251027` - é…ç½®å¤‡ä»½ï¼ˆ1 è´¦æˆ· + 1 Worker + 1 ä»£ç†ï¼‰

---

## âŒ æ•…éšœæ’é™¤

### é—®é¢˜: æ•°æ®åº“æ–‡ä»¶ä»è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹æ³• 1: å¼ºåˆ¶å…³é—­æ‰€æœ‰ Node è¿›ç¨‹
taskkill /F /IM node.exe

# æ–¹æ³• 2: é‡å¯ç»ˆç«¯åé‡è¯•

# æ–¹æ³• 3: é‡å¯è®¡ç®—æœºï¼ˆæœ€åæ‰‹æ®µï¼‰
```

### é—®é¢˜: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨

**æ£€æŸ¥**:
```bash
ls -lh packages/master/data/master.db*
```

å¦‚æœæ²¡æœ‰å¤‡ä»½ï¼Œå¯ä»¥ï¼š
1. è·³è¿‡é…ç½®è¿ç§»ï¼Œæ‰‹åŠ¨é…ç½®è´¦æˆ·
2. ä½¿ç”¨å…¶ä»–å¤‡ä»½æ–‡ä»¶ï¼ˆä¿®æ”¹è„šæœ¬ä¸­çš„è·¯å¾„ï¼‰

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. [docs/æ•°æ®åº“é‡å»ºæŒ‡å—.md](docs/æ•°æ®åº“é‡å»ºæŒ‡å—.md) - å®Œæ•´æ–‡æ¡£
2. [scripts/README-æ•°æ®åº“é‡å»º.md](scripts/README-æ•°æ®åº“é‡å»º.md) - å¿«é€ŸæŒ‡å—
3. æ£€æŸ¥ Git æäº¤å†å²äº†è§£å˜æ›´è¯¦æƒ…

---

**ä¸‹ä¸€æ­¥**: è¯·æŒ‰ç…§ä¸Šè¿°æ­¥éª¤æ‰§è¡Œæ•°æ®åº“é‡å»º ğŸš€
