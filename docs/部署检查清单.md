# HisCRM-IM ç”Ÿäº§éƒ¨ç½²æ£€æŸ¥æ¸…å•

æœ¬æ¸…å•ç”¨äºç¡®ä¿ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚åœ¨éƒ¨ç½²å‰ã€éƒ¨ç½²ä¸­å’Œéƒ¨ç½²åä½¿ç”¨æ­¤æ¸…å•è¿›è¡Œæ£€æŸ¥ã€‚

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥

### æœåŠ¡å™¨å‡†å¤‡

- [ ] æœåŠ¡å™¨é…ç½®æ»¡è¶³æœ€ä½è¦æ±‚ï¼ˆ2æ ¸4Gï¼Œæ¨è4æ ¸8Gï¼‰
- [ ] æ“ä½œç³»ç»Ÿä¸º Ubuntu 20.04/22.04 LTS æˆ–å…¼å®¹ç³»ç»Ÿ
- [ ] æœåŠ¡å™¨å¯ä»¥é€šè¿‡ SSH è®¿é—®
- [ ] æœåŠ¡å™¨æœ‰å›ºå®šçš„å…¬ç½‘ IP æˆ–åŸŸå
- [ ] å·²å‡†å¤‡å¥½åŸŸåï¼ˆå¦‚æœéœ€è¦ï¼‰
- [ ] DNS è®°å½•å·²æ­£ç¡®é…ç½®ï¼ˆå¦‚æœä½¿ç”¨åŸŸåï¼‰

### ç½‘ç»œå’Œå®‰å…¨

- [ ] ç¡®è®¤éœ€è¦å¼€æ”¾çš„ç«¯å£ï¼š22ï¼ˆSSHï¼‰ã€80ï¼ˆHTTPï¼‰ã€443ï¼ˆHTTPSï¼‰ã€3000ï¼ˆMasterï¼‰
- [ ] é˜²ç«å¢™è§„åˆ™å·²è§„åˆ’
- [ ] SSH å¯†é’¥å·²ç”Ÿæˆå¹¶é…ç½®
- [ ] å¤‡ä»½ç­–ç•¥å·²åˆ¶å®š
- [ ] SSL è¯ä¹¦å·²å‡†å¤‡ï¼ˆå¦‚æœä½¿ç”¨ HTTPSï¼‰

### ä»£ç å’Œé…ç½®

- [ ] ä»£ç å·²æ¨é€åˆ° Git ä»“åº“æˆ–å‡†å¤‡å¥½ä¸Šä¼ 
- [ ] å·²å‡†å¤‡å¥½ç”Ÿäº§ç¯å¢ƒé…ç½®å‚æ•°ï¼š
  - [ ] Master ç«¯å£
  - [ ] æ•°æ®åº“åŠ å¯†å¯†é’¥
  - [ ] CORS å…è®¸çš„æº
  - [ ] æ—¥å¿—çº§åˆ«
  - [ ] ç›‘æ§é…ç½®
- [ ] æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†é’¥ã€å¯†ç ï¼‰å·²å®‰å…¨å­˜å‚¨

## ğŸš€ éƒ¨ç½²ä¸­æ£€æŸ¥

### ç¯å¢ƒå®‰è£…

- [ ] å·²è¿è¡Œ `install-environment.sh` è„šæœ¬
- [ ] Node.js ç‰ˆæœ¬ >= 18.0.0
- [ ] npm å·²å®‰è£…
- [ ] PM2 å·²å®‰è£…
- [ ] Nginx å·²å®‰è£…
- [ ] SQLite3 å·²å®‰è£…
- [ ] Playwright ä¾èµ–å·²å®‰è£…

### ä»£ç éƒ¨ç½²

- [ ] ä»£ç å·²ä¸Šä¼ åˆ° `/var/www/hiscrm-im`
- [ ] ç›®å½•æƒé™æ­£ç¡®ï¼ˆæ‰€æœ‰è€…ä¸ºéƒ¨ç½²ç”¨æˆ·ï¼‰
- [ ] Git ä»“åº“å·²å…‹éš†ï¼ˆå¦‚æœä½¿ç”¨ Gitï¼‰

### é…ç½®æ–‡ä»¶

#### Master é…ç½® (`packages/master/.env`)

- [ ] æ–‡ä»¶å·²åˆ›å»º
- [ ] `PORT` å·²è®¾ç½®
- [ ] `NODE_ENV=production`
- [ ] `ENCRYPTION_KEY` å·²è®¾ç½®ï¼ˆ32å­—ç¬¦éšæœºå­—ç¬¦ä¸²ï¼‰
- [ ] `CORS_ORIGIN` å·²è®¾ç½®ä¸ºå…·ä½“åŸŸåï¼ˆä¸æ˜¯ `*`ï¼‰
- [ ] `LOG_LEVEL=info` æˆ– `warn`
- [ ] `BROWSER_HEADLESS=true`
- [ ] `MONITORING_ENABLED=true`
- [ ] æ•°æ®åº“è·¯å¾„æ­£ç¡®

#### Admin Web é…ç½® (`packages/admin-web/.env`)

- [ ] æ–‡ä»¶å·²åˆ›å»º
- [ ] `REACT_APP_MASTER_URL` æŒ‡å‘æ­£ç¡®çš„æœåŠ¡å™¨åœ°å€
- [ ] `REACT_APP_API_URL` é…ç½®æ­£ç¡®

#### CRM PC IM é…ç½® (`packages/crm-pc-im/config.json`)

- [ ] `websocket.url` æŒ‡å‘ç”Ÿäº§æœåŠ¡å™¨
- [ ] è¿æ¥å‚æ•°é…ç½®æ­£ç¡®

### ä¾èµ–å®‰è£…

- [ ] æ ¹ç›®å½• `npm install` å·²æ‰§è¡Œ
- [ ] `packages/shared` ä¾èµ–å·²å®‰è£…
- [ ] `packages/master` ä¾èµ–å·²å®‰è£…
- [ ] `packages/admin-web` ä¾èµ–å·²å®‰è£…
- [ ] æ— ä¾èµ–å®‰è£…é”™è¯¯

### Master éƒ¨ç½²

- [ ] å·²è¿è¡Œ `deploy-master.sh` è„šæœ¬
- [ ] PM2 è¿›ç¨‹å·²å¯åŠ¨
- [ ] æ•°æ®åº“æ–‡ä»¶å·²åˆ›å»º (`data/master.db`)
- [ ] æ—¥å¿—ç›®å½•å·²åˆ›å»º (`logs/`)
- [ ] PM2 å¼€æœºè‡ªå¯å·²é…ç½®

### Admin Web éƒ¨ç½²

- [ ] å·²è¿è¡Œ `deploy-admin-web.sh` è„šæœ¬
- [ ] React åº”ç”¨å·²æ„å»ºï¼ˆ`build/` ç›®å½•ï¼‰
- [ ] é™æ€æ–‡ä»¶å·²å¤åˆ¶åˆ° Nginx ç›®å½•
- [ ] Nginx é…ç½®æ–‡ä»¶å·²åˆ›å»º
- [ ] Nginx é…ç½®æµ‹è¯•é€šè¿‡ (`nginx -t`)
- [ ] Nginx å·²é‡å¯

## âœ… éƒ¨ç½²åæ£€æŸ¥

### æœåŠ¡çŠ¶æ€

#### PM2 æ£€æŸ¥

- [ ] Master è¿›ç¨‹çŠ¶æ€ä¸º `online`
  ```bash
  pm2 status hiscrm-master
  ```
- [ ] æ— é”™è¯¯æ—¥å¿—
  ```bash
  pm2 logs hiscrm-master --lines 50 --err
  ```
- [ ] CPU å’Œå†…å­˜ä½¿ç”¨æ­£å¸¸

#### Nginx æ£€æŸ¥

- [ ] Nginx æœåŠ¡è¿è¡Œä¸­
  ```bash
  sudo systemctl status nginx
  ```
- [ ] æ— é…ç½®é”™è¯¯
  ```bash
  sudo nginx -t
  ```
- [ ] æ— é”™è¯¯æ—¥å¿—
  ```bash
  sudo tail -f /var/log/nginx/error.log
  ```

### åŠŸèƒ½æµ‹è¯•

#### Master API æµ‹è¯•

- [ ] Health æ¥å£å¯è®¿é—®
  ```bash
  curl http://localhost:3000/api/v1/health
  ```
- [ ] è¿”å›æ­£å¸¸å“åº”ï¼ˆ200 OKï¼‰
- [ ] å“åº”å†…å®¹æ­£ç¡®

#### Admin Web æµ‹è¯•

- [ ] å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®
  - HTTP: `http://your-server-ip`
  - HTTPS: `https://your-domain.com`
- [ ] é¡µé¢æ­£å¸¸åŠ è½½ï¼ˆæ— ç™½å±ï¼‰
- [ ] é™æ€èµ„æºåŠ è½½æ­£å¸¸ï¼ˆCSSã€JSã€å›¾ç‰‡ï¼‰
- [ ] æ— æ§åˆ¶å°é”™è¯¯

#### WebSocket è¿æ¥æµ‹è¯•

- [ ] æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º WebSocket è¿æ¥æˆåŠŸ
- [ ] æ—  CORS é”™è¯¯
- [ ] å¯ä»¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯
- [ ] æ–­çº¿é‡è¿æ­£å¸¸

#### æ•°æ®åº“æµ‹è¯•

- [ ] æ•°æ®åº“æ–‡ä»¶å­˜åœ¨
  ```bash
  ls -lh /var/www/hiscrm-im/packages/master/data/master.db
  ```
- [ ] æ•°æ®åº“å¯ä»¥æ­£å¸¸è¯»å†™
- [ ] å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡
  ```bash
  sqlite3 master.db "PRAGMA integrity_check;"
  ```

### å®‰å…¨æ£€æŸ¥

#### é˜²ç«å¢™

- [ ] UFW æˆ– firewalld å·²å¯ç”¨
- [ ] ä»…å¿…è¦ç«¯å£å¼€æ”¾
- [ ] SSH ç«¯å£è®¿é—®å—é™ï¼ˆå¦‚æœä¿®æ”¹äº†é»˜è®¤ç«¯å£ï¼‰

#### SSH å®‰å…¨

- [ ] Root ç™»å½•å·²ç¦ç”¨
- [ ] å¯†ç ç™»å½•å·²ç¦ç”¨ï¼ˆä»…ä½¿ç”¨å¯†é’¥ï¼‰
- [ ] SSH ç«¯å£å·²ä¿®æ”¹ï¼ˆå¯é€‰ï¼‰

#### åº”ç”¨å®‰å…¨

- [ ] ENCRYPTION_KEY ä½¿ç”¨å¼ºéšæœºå€¼
- [ ] CORS_ORIGIN ä¸æ˜¯ `*`
- [ ] æ—¥å¿—ä¸­æ— æ•æ„Ÿä¿¡æ¯
- [ ] æ•°æ®åº“æ–‡ä»¶æƒé™æ­£ç¡® (600)

#### HTTPSï¼ˆå¦‚æœé…ç½®ï¼‰

- [ ] SSL è¯ä¹¦å·²å®‰è£…
- [ ] HTTPS å¯ä»¥è®¿é—®
- [ ] HTTP è‡ªåŠ¨é‡å®šå‘åˆ° HTTPS
- [ ] è¯ä¹¦æœ‰æ•ˆæœŸè¶³å¤Ÿé•¿
- [ ] è¯ä¹¦è‡ªåŠ¨ç»­æœŸå·²é…ç½®

### æ€§èƒ½æ£€æŸ¥

#### å“åº”æ—¶é—´

- [ ] API å“åº”æ—¶é—´ < 200ms
- [ ] é¡µé¢åŠ è½½æ—¶é—´ < 2s
- [ ] WebSocket è¿æ¥æ—¶é—´ < 1s

#### èµ„æºä½¿ç”¨

- [ ] CPU ä½¿ç”¨ç‡ < 50%
- [ ] å†…å­˜ä½¿ç”¨ç‡ < 70%
- [ ] ç£ç›˜ä½¿ç”¨ç‡ < 80%
- [ ] ç½‘ç»œå»¶è¿Ÿæ­£å¸¸

#### å¹¶å‘æµ‹è¯•

- [ ] å¯ä»¥å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥
- [ ] æ— å†…å­˜æ³„æ¼
- [ ] æ— æ€§èƒ½ä¸‹é™

### ç›‘æ§å’Œæ—¥å¿—

#### æ—¥å¿—è®°å½•

- [ ] Master æ—¥å¿—æ­£å¸¸å†™å…¥
- [ ] PM2 æ—¥å¿—æ­£å¸¸å†™å…¥
- [ ] Nginx æ—¥å¿—æ­£å¸¸å†™å…¥
- [ ] æ—¥å¿—çº§åˆ«æ­£ç¡®
- [ ] æ—¥å¿—è½®è½¬é…ç½®æ­£ç¡®

#### ç›‘æ§è®¾ç½®

- [ ] PM2 ç›‘æ§å¯ç”¨
  ```bash
  pm2 monit
  ```
- [ ] æ€§èƒ½ç›‘æ§å·²å¯ç”¨ï¼ˆå¦‚æœé…ç½®ï¼‰
- [ ] å‘Šè­¦é˜ˆå€¼é…ç½®æ­£ç¡®

### å¤‡ä»½

- [ ] æ•°æ®åº“å¤‡ä»½è„šæœ¬å·²é…ç½®
- [ ] å®šæ—¶å¤‡ä»½ä»»åŠ¡å·²æ·»åŠ åˆ° crontab
- [ ] å¤‡ä»½å­˜å‚¨ä½ç½®æ­£ç¡®
- [ ] å¤‡ä»½ä¿ç•™ç­–ç•¥å·²è®¾ç½®
- [ ] å·²æµ‹è¯•å¤‡ä»½æ¢å¤æµç¨‹

### æ–‡æ¡£

- [ ] éƒ¨ç½²é…ç½®å·²æ–‡æ¡£åŒ–
- [ ] è®¿é—®åœ°å€å·²è®°å½•
- [ ] ç®¡ç†å‘˜è´¦å·å·²è®°å½•ï¼ˆå®‰å…¨å­˜å‚¨ï¼‰
- [ ] è¿ç»´æ‰‹å†Œå·²å‡†å¤‡
- [ ] è”ç³»äººä¿¡æ¯å·²æ›´æ–°

## ğŸ–¥ï¸ CRM PC IM å®¢æˆ·ç«¯æ£€æŸ¥

### æ‰“åŒ…æ£€æŸ¥

- [ ] åœ¨ Windows å¼€å‘æœºä¸Šå®Œæˆæ‰“åŒ…
- [ ] å¯æ‰§è¡Œæ–‡ä»¶å·²ç”Ÿæˆ (`release/CRM-PC-IM.exe`)
- [ ] æ–‡ä»¶å¤§å°æ­£å¸¸ï¼ˆçº¦ 100-200MBï¼‰
- [ ] `config.json` é…ç½®æ­£ç¡®

### å®¢æˆ·ç«¯æµ‹è¯•

- [ ] å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥æ­£å¸¸å¯åŠ¨
- [ ] å¯ä»¥è¿æ¥åˆ°ç”Ÿäº§æœåŠ¡å™¨
- [ ] WebSocket è¿æ¥æˆåŠŸ
- [ ] å¯ä»¥æ¥æ”¶é€šçŸ¥
- [ ] UI æ˜¾ç¤ºæ­£å¸¸
- [ ] æ— å´©æºƒæˆ–é”™è¯¯

### åˆ†å‘å‡†å¤‡

- [ ] å¯æ‰§è¡Œæ–‡ä»¶å·²å‡†å¤‡å¥½åˆ†å‘
- [ ] ç”¨æˆ·ä½¿ç”¨è¯´æ˜å·²å‡†å¤‡
- [ ] ç³»ç»Ÿè¦æ±‚å·²è¯´æ˜ï¼ˆWindows 10/11ï¼‰
- [ ] æœåŠ¡å™¨åœ°å€å·²ç¡®è®¤

## ğŸ“ æœ€ç»ˆç¡®è®¤

### éƒ¨ç½²æ¸…å•

- [ ] æ‰€æœ‰ä¸Šè¿°æ£€æŸ¥é¡¹å·²å®Œæˆ
- [ ] æ— é—ç•™é—®é¢˜
- [ ] æ€§èƒ½æ»¡è¶³è¦æ±‚
- [ ] å®‰å…¨æªæ–½åˆ°ä½
- [ ] å¤‡ä»½ç­–ç•¥å®æ–½
- [ ] ç›‘æ§æ­£å¸¸è¿è¡Œ

### æ–‡æ¡£äº¤ä»˜

- [ ] æœåŠ¡å™¨è®¿é—®ä¿¡æ¯å·²äº¤ä»˜
- [ ] ç®¡ç†å‘˜è´¦å·å·²äº¤ä»˜
- [ ] è¿ç»´æ–‡æ¡£å·²äº¤ä»˜
- [ ] åº”æ€¥è”ç³»æ–¹å¼å·²å»ºç«‹

### ç”¨æˆ·éªŒæ”¶

- [ ] å®¢æˆ·ç«¯å·²åˆ†å‘
- [ ] ç”¨æˆ·å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] ç”¨æˆ·åŸ¹è®­å·²å®Œæˆ

## ğŸ”„ æŒç»­è¿ç»´

### æ—¥å¸¸æ£€æŸ¥ï¼ˆæ¯æ—¥ï¼‰

- [ ] æ£€æŸ¥æœåŠ¡çŠ¶æ€
  ```bash
  pm2 status
  sudo systemctl status nginx
  ```
- [ ] æŸ¥çœ‹é”™è¯¯æ—¥å¿—
  ```bash
  pm2 logs hiscrm-master --lines 50 --err
  sudo tail -100 /var/log/nginx/error.log
  ```
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´
  ```bash
  df -h
  ```

### å®šæœŸæ£€æŸ¥ï¼ˆæ¯å‘¨ï¼‰

- [ ] æ£€æŸ¥ç³»ç»Ÿæ›´æ–°
  ```bash
  sudo apt-get update
  sudo apt-get upgrade -y
  ```
- [ ] æ£€æŸ¥æ•°æ®åº“å¤§å°å’Œå®Œæ•´æ€§
- [ ] æ£€æŸ¥å¤‡ä»½æ˜¯å¦æ­£å¸¸
- [ ] æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡
- [ ] æ¸…ç†æ—§æ—¥å¿—

### å®šæœŸæ£€æŸ¥ï¼ˆæ¯æœˆï¼‰

- [ ] å®¡æŸ¥å®‰å…¨æ—¥å¿—
- [ ] æ›´æ–°ä¾èµ–åŒ…
- [ ] æµ‹è¯•å¤‡ä»½æ¢å¤
- [ ] æ€§èƒ½ä¼˜åŒ–è°ƒæ•´
- [ ] æ–‡æ¡£æ›´æ–°

## âš ï¸ å¸¸è§é—®é¢˜å¿«é€Ÿæ£€æŸ¥

### Master æ— æ³•å¯åŠ¨

1. [ ] æ£€æŸ¥ç«¯å£å ç”¨ï¼š`netstat -tulpn | grep 3000`
2. [ ] æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼š`cat packages/master/.env`
3. [ ] æŸ¥çœ‹ PM2 æ—¥å¿—ï¼š`pm2 logs hiscrm-master`
4. [ ] æ£€æŸ¥æ•°æ®åº“æƒé™ï¼š`ls -l packages/master/data/`

### Admin Web æ— æ³•è®¿é—®

1. [ ] æ£€æŸ¥ Nginx çŠ¶æ€ï¼š`systemctl status nginx`
2. [ ] æµ‹è¯• Nginx é…ç½®ï¼š`nginx -t`
3. [ ] æŸ¥çœ‹ Nginx æ—¥å¿—ï¼š`tail /var/log/nginx/error.log`
4. [ ] æ£€æŸ¥é˜²ç«å¢™ï¼š`ufw status`

### WebSocket è¿æ¥å¤±è´¥

1. [ ] æ£€æŸ¥ Master è¿è¡Œï¼š`pm2 status`
2. [ ] æ£€æŸ¥ CORS é…ç½®ï¼š`grep CORS packages/master/.env`
3. [ ] æµ‹è¯•ç«¯å£è¿æ¥ï¼š`curl http://localhost:3000/socket.io/`
4. [ ] æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

### å®¢æˆ·ç«¯æ— æ³•è¿æ¥

1. [ ] æ£€æŸ¥ `config.json` é…ç½®
2. [ ] æµ‹è¯•æœåŠ¡å™¨è¿é€šæ€§ï¼š`ping your-server`
3. [ ] æ£€æŸ¥é˜²ç«å¢™ç«¯å£ 3000
4. [ ] æŸ¥çœ‹ Master æ—¥å¿—

---

**æ£€æŸ¥æ¸…å•ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-01-20
**é€‚ç”¨åœºæ™¯**: ç”Ÿäº§ç¯å¢ƒé¦–æ¬¡éƒ¨ç½²å’Œæ—¥å¸¸è¿ç»´

## ä½¿ç”¨å»ºè®®

1. **æ‰“å°æ¸…å•**ï¼šå°†æ­¤æ¸…å•æ‰“å°å‡ºæ¥ï¼Œé€é¡¹å‹¾é€‰
2. **è®°å½•é—®é¢˜**ï¼šåœ¨æ¯ä¸ªæ£€æŸ¥é¡¹æ—è¾¹è®°å½•å‘ç°çš„é—®é¢˜
3. **ä¿å­˜è®°å½•**ï¼šå°†å®Œæˆçš„æ£€æŸ¥æ¸…å•å½’æ¡£ä¿å­˜
4. **å®šæœŸå®¡æŸ¥**ï¼šå®šæœŸå®¡æŸ¥æ¸…å•ï¼Œæ ¹æ®å®é™…æƒ…å†µæ›´æ–°
