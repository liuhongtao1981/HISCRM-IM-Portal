# Master/Worker DEBUG æ¨¡å¼ - æµè§ˆå™¨ç›´è¿è°ƒè¯•æŒ‡å—

## ğŸ¯ æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª**ä¸€é”®å¯åŠ¨**çš„è°ƒè¯•ç³»ç»Ÿï¼Œè®©ä½ å¯ä»¥å®æ—¶çœ‹åˆ°Workerä¸­çš„æµè§ˆå™¨åœ¨åšä»€ä¹ˆã€‚

Master DEBUGæ¨¡å¼ä¼šè‡ªåŠ¨å¯åŠ¨DEBUGæ¨¡å¼çš„Workerï¼ŒåŒ…æ‹¬æµè§ˆå™¨ç›´è¿MCPè°ƒè¯•é¢æ¿ã€‚

### ç‰¹ç‚¹

âœ¨ **é›¶é…ç½®** - ç›´æ¥è¿è¡Œè„šæœ¬å³å¯å¯ç”¨
âœ¨ **ä¸€é”®å¯åŠ¨** - Masterå’ŒWorkeråŒæ—¶å¯åŠ¨
âœ¨ **æµè§ˆå™¨ç›´è¿** - æµè§ˆå™¨é€šè¿‡WebSocketç›´æ¥è¿æ¥MCPè°ƒè¯•é¢æ¿
âœ¨ **å®æ—¶ç›‘æ§** - çœ‹åˆ°å›å¤ã€DOMæŸ¥æ‰¾ã€æ¶ˆæ¯å®šä½ç­‰æ‰€æœ‰äº‹ä»¶
âœ¨ **DEBUGä¸“ç”¨** - æ­£å¸¸ç”Ÿäº§æ¨¡å¼ä¸å—å½±å“

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆæ¨è - Master DEBUGæ¨¡å¼ï¼‰

### æ–¹å¼ä¸€ï¼šMaster DEBUG æ¨¡å¼ï¼ˆæ¨è â­ï¼‰

å¯åŠ¨Masterï¼Œå®ƒä¼šè‡ªåŠ¨å¯åŠ¨DEBUGæ¨¡å¼çš„Worker

#### Windows ç”¨æˆ·

åŒå‡»è¿è¡Œï¼š
```
packages/master/start-debug.bat
```

æˆ–åœ¨PowerShellä¸­ï¼š
```powershell
cd packages/master
.\start-debug.bat
```

#### Mac/Linux ç”¨æˆ·

```bash
cd packages/master
chmod +x start-debug.sh
./start-debug.sh
```

#### æˆ–æ‰‹åŠ¨å¯åŠ¨

```bash
cd packages/master
DEBUG=true npm run start:master
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆæ›¿ä»£æ–¹æ¡ˆ - ä»…Worker DEBUGï¼‰

å¦‚æœåªæƒ³å¯åŠ¨Workerè°ƒè¯•ï¼ˆMasterå·²åœ¨è¿è¡Œï¼‰

### Windows ç”¨æˆ·

```
packages/worker/start-debug.bat
```

### Mac/Linux ç”¨æˆ·

```bash
cd packages/worker
./start-debug.sh
```

### æˆ–æ‰‹åŠ¨å¯åŠ¨

```bash
cd packages/worker
DEBUG=true DEBUG_HEADLESS=false node src/index.js
```

---

## ğŸ“Š å¯åŠ¨åä½ ä¼šçœ‹åˆ°ä»€ä¹ˆ

### 1ï¸âƒ£ Worker å¯åŠ¨æ—¥å¿—

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         ğŸ” DEBUG MODE ENABLED             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ MCP æ¥å£: âœ… å¯ç”¨ (ç«¯å£ 9222)
â•‘ å•è´¦æˆ·æ¨¡å¼: âœ… å¯ç”¨ (æœ€å¤š 1 ä¸ª)
â•‘ Headless: âœ… ç¦ç”¨ (æ˜¾ç¤ºæµè§ˆå™¨çª—å£)
â•‘ æ—¥å¿—çº§åˆ«: debug
â•‘ ç›‘æ§é—´éš”: 60 ç§’
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Chrome DevTools MCP è°ƒè¯•æ¥å£å¯åŠ¨æˆåŠŸ
   workerId: worker1
   httpUrl: http://localhost:9222/
   wsUrl: ws://localhost:9222/
```

### 2ï¸âƒ£ æ‰“å¼€æµè§ˆå™¨çœ‹è°ƒè¯•é¢æ¿

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š

```
http://localhost:9222/
```

ä½ ä¼šçœ‹åˆ°ï¼š
- Worker å®æ—¶çŠ¶æ€
- ä»»åŠ¡ç›‘æ§é¢æ¿
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- å®æ—¶æ—¥å¿—æµ

### 3ï¸âƒ£ æµè§ˆå™¨çª—å£ä¼šè‡ªåŠ¨å‡ºç°

å½“Workerå¯åŠ¨æµè§ˆå™¨è¿›è¡Œå›å¤æ—¶ï¼š
- ä¼šçœ‹åˆ°ä¸€ä¸ªæ˜¾ç¤ºçš„æµè§ˆå™¨çª—å£ï¼ˆå› ä¸º `DEBUG_HEADLESS=false`ï¼‰
- æµè§ˆå™¨è‡ªåŠ¨è¿æ¥åˆ°MCPè°ƒè¯•é¢æ¿
- æµè§ˆå™¨çš„æ‰€æœ‰æ“ä½œéƒ½ä¼šå®æ—¶æ˜¾ç¤ºåœ¨æ—¥å¿—ä¸­

---

## ğŸ” è°ƒè¯•å›å¤åŠŸèƒ½ï¼ˆå®Œæ•´æµç¨‹ï¼‰

### æ­¥éª¤1ï¼šå¯åŠ¨ Master å’Œ Workerï¼ˆDEBUGæ¨¡å¼ï¼‰

åªéœ€ä¸€ä¸ªå‘½ä»¤ï¼ŒMasterä¼šè‡ªåŠ¨å¯åŠ¨DEBUGæ¨¡å¼çš„Workerï¼

#### Windows
```bash
packages/master/start-debug.bat
```

#### Mac/Linux
```bash
cd packages/master
./start-debug.sh
```

æˆ–æ‰‹åŠ¨å¯åŠ¨ï¼š
```bash
cd packages/master
DEBUG=true npm run start:master
```

ç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼š
```bash
cd packages/worker
npm run start:worker  # Worker ä¼šè‡ªåŠ¨ä»¥ DEBUG æ¨¡å¼å¯åŠ¨
```

**ä½ ä¼šçœ‹åˆ°ï¼š**
- Master å¯åŠ¨æ—¥å¿—
- Master DEBUG MODE ä¿¡æ¯
- Worker è‡ªåŠ¨å¯åŠ¨ä¿¡æ¯
- Worker DEBUG MODE ä¿¡æ¯
- MCP æœåŠ¡å¯åŠ¨æˆåŠŸä¿¡æ¯

### æ­¥éª¤2ï¼šæ‰“å¼€MCPç›‘æ§é¢æ¿

åœ¨æµè§ˆå™¨æ‰“å¼€ï¼š
```
http://localhost:9222/
```

ä½ ä¼šçœ‹åˆ°ï¼š
- Worker å®æ—¶çŠ¶æ€
- ä»»åŠ¡ç›‘æ§é¢æ¿
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- å®æ—¶æ—¥å¿—æµï¼ˆåŒ…æ‹¬æµè§ˆå™¨äº‹ä»¶ï¼‰

### æ­¥éª¤3ï¼šæäº¤å›å¤è¯·æ±‚

åœ¨ç¬¬ä¸‰ä¸ªç»ˆç«¯è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š
```bash
cd packages/master/src/tests
node test-dm-reply-api.js
```

### æ­¥éª¤4ï¼šè§‚å¯Ÿå®æ—¶æ—¥å¿—

åœ¨MCPç›‘æ§é¢æ¿ä¸­ï¼Œå®æ—¶æŸ¥çœ‹ï¼š

1. **Worker çŠ¶æ€å¡ç‰‡**
   ```
   Worker ID: worker1
   è¿è¡Œæ—¶é—´: 0h 2m 15s
   çŠ¶æ€: running
   å†…å­˜ä½¿ç”¨: 185.45 MB
   ```

2. **ä»»åŠ¡ç»Ÿè®¡å¡ç‰‡**
   ```
   æ´»è·ƒä»»åŠ¡: 1
   å·²å®Œæˆ: 2
   å¤±è´¥ä»»åŠ¡: 0
   ```

3. **æµè§ˆå™¨äº‹ä»¶æ—¥å¿—**
   ```
   [2025-10-20 23:15:30] ğŸ”— æµè§ˆå™¨å·²è¿æ¥åˆ°MCPè°ƒè¯•æ¥å£
   [2025-10-20 23:15:31] [æµè§ˆå™¨äº‹ä»¶] virtual_list_search
   [2025-10-20 23:15:32] [æµè§ˆå™¨äº‹ä»¶] message_located
   [2025-10-20 23:15:33] [æµè§ˆå™¨äº‹ä»¶] reply_submitted
   [2025-10-20 23:15:34] ğŸ”Œ æµè§ˆå™¨å·²æ–­å¼€è¿æ¥
   ```

---

## ğŸ“ å…³é”®æ—¥å¿—è¯´æ˜

å½“æ‰§è¡Œå›å¤ä»»åŠ¡æ—¶ï¼Œä½ ä¼šçœ‹åˆ°è¿™äº›å…³é”®æ—¥å¿—ï¼š

### æ ‡è®° âœ¨ æˆåŠŸçš„å›å¤æµç¨‹

```
âœ… [task-runner] Running reply task for account xxx

ğŸ”— æµè§ˆå™¨å·²è¿æ¥åˆ°MCPè°ƒè¯•æ¥å£
   browserId: browser_1729449330xxx

[Douyin] ä¸ºå›å¤ä»»åŠ¡å¼€å¯æ–°æµè§ˆå™¨æ ‡ç­¾é¡µ
[Douyin] æ ‡ç­¾é¡µå¯¼èˆªåˆ°: https://www.douyin.com/...
[Douyin] å›å¤æ–‡æœ¬æ¡†å·²å®šä½
   selector: [contenteditable="true"]
   xpath: /div[1]/div[2]/textarea

[æµè§ˆå™¨äº‹ä»¶] dom_inspection
   selector: [contenteditable="true"]
   found: true

[æµè§ˆå™¨äº‹ä»¶] virtual_list_search
   queryId: 7437896255660017187
   found: true
   matchType: tier2b (React Fiberæå–)

[Douyin] æ­£åœ¨è¾“å…¥å›å¤å†…å®¹
[æµè§ˆå™¨äº‹ä»¶] reply_submitted
   messageId: 7437896255660017187
   contentLength: 20

[Douyin] ç‚¹å‡»å‘é€æŒ‰é’®
[Douyin] å›å¤ä»»åŠ¡æ ‡ç­¾é¡µå·²å…³é—­

ğŸ”Œ æµè§ˆå™¨å·²æ–­å¼€è¿æ¥

âœ… [task-runner] Reply task completed successfully
```

### æ ‡è®° âŒ é—®é¢˜çš„æ—¥å¿—

å¦‚æœçœ‹åˆ°è¿™äº›ï¼Œè¯´æ˜æœ‰é—®é¢˜ï¼š

```
âŒ [Douyin] ä¸ºå›å¤ä»»åŠ¡å¼€å¯æ–°æµè§ˆå™¨æ ‡ç­¾é¡µ FAILED
   â†³ é—®é¢˜: Workeræ²¡æœ‰æ”¶åˆ°å›å¤ä»»åŠ¡

âŒ [Douyin] å›å¤æ–‡æœ¬æ¡†å·²å®šä½ FAILED
   â†³ é—®é¢˜: DOMé€‰æ‹©å™¨å¯èƒ½è¿‡æœŸ

âŒ [æµè§ˆå™¨äº‹ä»¶] virtual_list_search
   found: false
   â†³ é—®é¢˜: IDåŒ¹é…å¤±è´¥

âŒ ç‚¹å‡»å‘é€æŒ‰é’® FAILED
   â†³ é—®é¢˜: æŒ‰é’®é€‰æ‹©å™¨æ”¹å˜
```

---

## ğŸ› ï¸ è°ƒè¯•æŠ€å·§

### æŠ€å·§1ï¼šæ£€æŸ¥è™šæ‹Ÿåˆ—è¡¨IDåŒ¹é…

åœ¨æ—¥å¿—ä¸­æŸ¥æ‰¾ `matchType`ï¼š

```
matchType: tier1  â†’ ç²¾ç¡®å†…å®¹åŒ¹é… âœ…
matchType: tier2a â†’ ç›´æ¥HTMLåŒ¹é… âœ…
matchType: tier2b â†’ React Fiberæå– âœ…
matchType: tier2c â†’ å†…å®¹å“ˆå¸ŒåŒ¹é… âœ…
matchType: tier3  â†’ å‘é€è€…+æ—¶é—´æ¨¡ç³ŠåŒ¹é… âš ï¸
matchType: tier4  â†’ ç´¢å¼•ä½ç½®å›é€€ âš ï¸
matchType: null   â†’ æ‰€æœ‰åŒ¹é…éƒ½å¤±è´¥ âŒ
```

### æŠ€å·§2ï¼šè§‚å¯Ÿæµè§ˆå™¨çª—å£

å› ä¸ºå¯ç”¨äº†éheadlessæ¨¡å¼ï¼Œä½ å¯ä»¥ï¼š
- çœ‹åˆ°ç½‘é¡µåŠ è½½è¿‡ç¨‹
- çœ‹åˆ°æ–‡æœ¬è¾“å…¥
- çœ‹åˆ°æŒ‰é’®ç‚¹å‡»
- çœ‹åˆ°æ ‡ç­¾é¡µæ‰“å¼€å…³é—­

### æŠ€å·§3ï¼šæ¸…é™¤æ—¥å¿—é‡æ–°æµ‹è¯•

åœ¨MCPé¢æ¿ç‚¹å‡»"æ¸…é™¤æ—¥å¿—"æŒ‰é’®ï¼Œç„¶åå†æ¬¡æäº¤å›å¤è¯·æ±‚ã€‚è¿™æ ·å¯ä»¥é›†ä¸­çœ‹æ–°çš„æ—¥å¿—ã€‚

### æŠ€å·§4ï¼šæ£€æŸ¥å†…å­˜æ³„æ¼

å¦‚æœ"å†…å­˜ä½¿ç”¨"ä¸æ–­å¢é•¿ï¼ˆä»100MBå¢é•¿åˆ°500MB+ï¼‰ï¼Œè¯´æ˜å¯èƒ½æœ‰å†…å­˜æ³„æ¼ã€‚

---

## ğŸ” é‡è¦æé†’

### DEBUGæ¨¡å¼çš„é™åˆ¶

- âœ… åªç›‘æ§1ä¸ªè´¦æˆ·ï¼ˆ`singleAccount.maxAccounts: 1`ï¼‰
- âœ… åªå¯åŠ¨1ä¸ªæµè§ˆå™¨ï¼ˆ`maxBrowsersPerWorker: 1`ï¼‰
- âœ… ç¦ç”¨headlessï¼ˆæ˜¾ç¤ºæµè§ˆå™¨çª—å£ï¼‰
- âš ï¸ æ€§èƒ½ä¼šé™ä½ï¼ˆä¸ºäº†ä¾¿äºè§‚å¯Ÿï¼‰

### ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨

```bash
# âŒ é”™è¯¯
DEBUG=true npm run start:worker  # åœ¨ç”Ÿäº§ç¯å¢ƒ

# âœ… æ­£ç¡®
npm run start:worker  # æ­£å¸¸ç”Ÿäº§æ¨¡å¼
```

---

## ğŸ® äº¤äº’æ“ä½œ

åœ¨MCPé¢æ¿ä¸­ä½ å¯ä»¥ï¼š

- **åˆ·æ–°æ•°æ®æŒ‰é’®** - ç«‹å³åˆ·æ–°æ‰€æœ‰çŠ¶æ€
- **æ¸…é™¤æ—¥å¿—æŒ‰é’®** - æ¸…ç©ºæ—¥å¿—åˆ—è¡¨ï¼ˆä¾¿äºé‡æ–°æµ‹è¯•ï¼‰
- **å®æ—¶æ»šåŠ¨æ—¥å¿—** - è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ—¥å¿—

---

## ğŸ“Š MCP é¢æ¿è¯¦è§£

### Worker çŠ¶æ€å¡ç‰‡
æ˜¾ç¤ºWorkerçš„åŸºæœ¬ä¿¡æ¯ï¼š
- Worker ID
- è¿è¡Œæ—¶é—´ï¼ˆè‡ªå¯åŠ¨ä»¥æ¥ï¼‰
- å½“å‰çŠ¶æ€ï¼ˆinitializing/running/paused/errorï¼‰
- å½“å‰å†…å­˜ä½¿ç”¨é‡

### ä»»åŠ¡ç»Ÿè®¡å¡ç‰‡
æ˜¾ç¤ºä»»åŠ¡æ‰§è¡Œæƒ…å†µï¼š
- æ´»è·ƒä»»åŠ¡æ•°
- å·²å®Œæˆä»»åŠ¡æ•°
- å¤±è´¥ä»»åŠ¡æ•°

### è´¦æˆ·ä¿¡æ¯å¡ç‰‡
æ˜¾ç¤ºè´¦æˆ·ç›¸å…³ä¿¡æ¯ï¼š
- å·²ç™»å½•è´¦æˆ·æ•°
- æ­£åœ¨ç›‘æ§çš„è´¦æˆ·æ•°

### å®æ—¶æ—¥å¿—é¢æ¿
æ˜¾ç¤ºæœ€æ–°çš„1000æ¡æ—¥å¿—ï¼š
- æ—¶é—´æˆ³
- æ—¥å¿—çº§åˆ«ï¼ˆè“=infoï¼Œé»„=warnï¼Œçº¢=errorï¼‰
- æ¶ˆæ¯å†…å®¹

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: MCPé¢æ¿æ‰“å¼€ä¸äº†

**ç­”**: æ£€æŸ¥Workeræ˜¯å¦æˆåŠŸå¯åŠ¨ï¼Œçœ‹æ—¥å¿—ä¸­æ˜¯å¦æœ‰"MCP è°ƒè¯•æ¥å£å¯åŠ¨æˆåŠŸ"

### Q2: æµè§ˆå™¨çª—å£æ²¡æœ‰æ˜¾ç¤º

**ç­”**: æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†DEBUGæ¨¡å¼ï¼Œç¡®ä¿ `DEBUG_HEADLESS=false`

### Q3: çœ‹ä¸åˆ°æµè§ˆå™¨äº‹ä»¶æ—¥å¿—

**ç­”**: ç¡®ä¿æµè§ˆå™¨æˆåŠŸè¿æ¥åˆ°MCPï¼ˆçœ‹"æµè§ˆå™¨å·²è¿æ¥"æ¶ˆæ¯ï¼‰

### Q4: å›å¤åŠŸèƒ½åœ¨DEBUGæ¨¡å¼ä¸‹å·¥ä½œï¼Œä½†æ­£å¸¸æ¨¡å¼ä¸‹ä¸å·¥ä½œ

**ç­”**: å¯èƒ½æ˜¯ç¯å¢ƒå˜é‡å½±å“ï¼Œæ£€æŸ¥ `.env` æ–‡ä»¶è®¾ç½®

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `packages/worker/start-debug.bat` | Windowså¯åŠ¨è„šæœ¬ |
| `packages/worker/start-debug.sh` | Mac/Linuxå¯åŠ¨è„šæœ¬ |
| `packages/worker/src/config/debug-config.js` | DEBUGé…ç½® |
| `packages/worker/src/debug/chrome-devtools-mcp.js` | MCPè°ƒè¯•æœåŠ¡ |
| `packages/worker/src/debug/browser-debug-client.js` | æµè§ˆå™¨è°ƒè¯•å®¢æˆ·ç«¯ |

---

## ğŸ’¡ æ€»ç»“

```
å¿«é€Ÿå¯åŠ¨:    ./start-debug.bat (Windows) æˆ– ./start-debug.sh (Mac/Linux)
æ‰“å¼€é¢æ¿:    http://localhost:9222
æŸ¥çœ‹äº‹ä»¶:    ç›‘å¬æµè§ˆå™¨äº‹ä»¶æ—¥å¿—
è°ƒè¯•é—®é¢˜:    æ£€æŸ¥æ—¥å¿—ä¸­çš„matchTypeå­—æ®µ
```

ç¥è°ƒè¯•é¡ºåˆ©ï¼ğŸš€

