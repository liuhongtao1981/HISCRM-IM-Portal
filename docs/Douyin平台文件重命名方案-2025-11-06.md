# Douyin 平台文件重命名方案

**日期**: 2025-11-06
**目标**: 统一文件命名规范,提升代码专业性和可维护性

## 一、重命名映射表

### 1. 爬虫模块 (crawl-* → crawler-*)

| 原文件名 | 新文件名 | 功能说明 |
|---------|---------|---------|
| `crawl-direct-messages-v2.js` | `crawler-messages.js` | 私信爬虫 (去掉 -v2 后缀) |
| `crawl-contents.js` | `crawler-contents.js` | 作品爬虫 |
| `crawl-comments.js` | `crawler-comments.js` | 评论爬虫 |

### 2. 数据管理模块

| 原文件名 | 新文件名 | 功能说明 |
|---------|---------|---------|
| `douyin-data-manager.js` | `data-manager.js` | 数据映射管理器 (去掉平台前缀) |

### 3. 其他文件 (保持不变)

| 文件名 | 说明 |
|-------|------|
| `platform.js` | 平台主类,保持不变 |
| `send-reply-*.js` | 回复功能,保持不变 |

## 二、命名规范说明

### 统一前缀规则

**爬虫模块**: `crawler-{功能}.js`
- ✅ `crawler-messages.js` - 清晰表达"消息爬虫"
- ✅ `crawler-contents.js` - 清晰表达"作品爬虫"
- ✅ `crawler-comments.js` - 清晰表达"评论爬虫"
- ❌ `crawl-direct-messages-v2.js` - 过于冗长,版本号应在注释/文档中管理

**数据管理**: `data-manager.js`
- ✅ 文件已在 `douyin/` 目录内,无需重复平台前缀
- ✅ 简洁专业,符合模块化设计原则

### 为什么去掉版本号后缀?

1. **Git 管理版本**: 代码版本应由 Git 历史管理,而非文件名
2. **减少重命名**: v2 → v3 不应导致文件重命名
3. **清晰简洁**: 文件名应描述功能,而非版本

## 三、需要更新的引用文件

### 主要引用位置

1. **`platform.js`** - 导入所有爬虫模块
   ```javascript
   // 旧代码
   const { crawlContents } = require('./crawl-contents');
   const { crawlComments } = require('./crawl-comments');
   const { crawlDirectMessagesV2 } = require('./crawl-direct-messages-v2');
   const DouyinDataManager = require('./douyin-data-manager');

   // 新代码
   const { crawlContents } = require('./crawler-contents');
   const { crawlComments } = require('./crawler-comments');
   const { crawlDirectMessages } = require('./crawler-messages');
   const DouyinDataManager = require('./data-manager');
   ```

2. **API 拦截回调导出** (在 platform.js 中)
   ```javascript
   // 旧代码
   const { onMessageInitAPI, onConversationListAPI, onMessageHistoryAPI } = require('./crawl-direct-messages-v2');

   // 新代码
   const { onMessageInitAPI, onConversationListAPI, onMessageHistoryAPI } = require('./crawler-messages');
   ```

3. **其他可能的引用**
   - 测试文件 (`tests/`)
   - 文档引用 (`docs/`)

## 四、重命名执行步骤

1. ✅ 重命名文件
2. ✅ 更新 `platform.js` 中的 require 路径
3. ✅ 更新 API 拦截回调导出
4. ✅ 搜索其他引用位置并更新
5. ✅ 运行测试验证
6. ✅ 提交 Git commit

## 五、向后兼容性

### 函数名保持不变

**重要**: 文件名改变,但导出的函数名保持不变,减少破坏性修改:

```javascript
// crawler-messages.js (新文件名)
async function crawlDirectMessagesV2() { ... }  // ❌ 旧函数名
async function crawlDirectMessages() { ... }    // ✅ 新函数名 (去掉 V2)

module.exports = {
  crawlDirectMessages,  // 统一导出名
  // 向后兼容 (可选,保留一段时间)
  crawlDirectMessagesV2: crawlDirectMessages
};
```

## 六、文档更新清单

需要更新的文档:
- ✅ `02-MASTER-系统文档.md`
- ✅ `03-WORKER-系统文档.md`
- ✅ `05-DOUYIN-平台实现技术细节.md`
- ✅ `CLAUDE.md` (项目根目录)

## 七、Git Commit 消息模板

```bash
git add packages/worker/src/platforms/douyin/
git commit -m "refactor(douyin): 统一文件命名规范

- 重命名爬虫模块: crawl-* → crawler-*
  - crawl-direct-messages-v2.js → crawler-messages.js
  - crawl-contents.js → crawler-contents.js
  - crawl-comments.js → crawler-comments.js

- 重命名数据管理: douyin-data-manager.js → data-manager.js

- 更新所有 require 引用路径
- 去掉版本号后缀,使用 Git 管理版本
- 提升代码专业性和可维护性

详见: docs/Douyin平台文件重命名方案-2025-11-06.md"
```

## 八、验证清单

重命名完成后,验证以下项:

- [ ] 所有爬虫文件可正常加载
- [ ] platform.js 启动无报错
- [ ] MonitorTask 可正常调用爬虫
- [ ] API 拦截回调正常注册
- [ ] 测试脚本可正常运行
- [ ] 文档引用已更新
