# API å¯¹æ¯” - å¿«é€Ÿå‚è€ƒè¡¨

**ç”¨é€”**: å¿«é€ŸæŸ¥çœ‹åŸç‰ˆ IM å’Œ Master å„æ¥å£çš„å¯¹æ ‡æƒ…å†µ

---

## æ¥å£å¯¹æ ‡é€ŸæŸ¥è¡¨

### è´¦æˆ·ç®¡ç† (6/6 âœ… 100%)

| # | åŸç‰ˆ IM | Master | çŠ¶æ€ |
|---|---------|--------|------|
| 1 | è·å–è´¦æˆ·åˆ—è¡¨ | GET /api/v1/accounts | âœ… å®Œå…¨åŒ¹é… |
| 2 | è·å–å•ä¸ªè´¦æˆ· | GET /api/v1/accounts/:id | âœ… å®Œå…¨åŒ¹é… |
| 3 | åˆ›å»ºè´¦æˆ· | POST /api/v1/accounts | âœ… å®Œå…¨åŒ¹é… |
| 4 | æ›´æ–°è´¦æˆ· | PATCH /api/v1/accounts/:id | âœ… å®Œå…¨åŒ¹é… |
| 5 | åˆ é™¤è´¦æˆ· | DELETE /api/v1/accounts/:id | âœ… å®Œå…¨åŒ¹é… |
| 6 | è´¦æˆ·çŠ¶æ€ | GET /api/v1/accounts/status/all | âœ… å®Œå…¨åŒ¹é… |

---

### ä¼šè¯æŸ¥è¯¢ (1/4 âš ï¸ 25%)

| # | åŸç‰ˆ IM | Master | çŠ¶æ€ | å·¥ä½œ |
|---|---------|--------|------|------|
| 7 | ä¼šè¯åˆ—è¡¨ (åˆå§‹) | GET /api/v1/conversations | âš ï¸ éƒ¨åˆ† | æ”¹è¿›åˆ†é¡µ 6h |
| 8 | ä¼šè¯è¯¦æƒ… | âŒ æ—  | âŒ ç¼ºå¤± | æ–°å¢ 8h |
| 9 | æœç´¢ä¼šè¯ | âŒ æ—  | âŒ ç¼ºå¤± | æ–°å¢ 6h |
| 10 | ç½®é¡¶/é™éŸ³ | PATCH /api/v1/conversations/:id | âš ï¸ éƒ¨åˆ† | æ–°å¢ 4h |

---

### æ¶ˆæ¯æŸ¥è¯¢ (2/6 âš ï¸ 33%)

| # | åŸç‰ˆ IM | Master | çŠ¶æ€ | å·¥ä½œ |
|---|---------|--------|------|------|
| 11 | æ¶ˆæ¯å†å² | GET /api/v1/direct-messages | âš ï¸ éƒ¨åˆ† | æ”¹è¿› 6h |
| 12 | å•æ¡æ¶ˆæ¯ | GET /api/v1/messages/:id | âœ… å®Œå…¨åŒ¹é… | - |
| 13 | æŒ‰ç±»å‹æŸ¥è¯¢ | âŒ æ—  | âŒ ç¼ºå¤± | æ–°å¢ 4h |
| 14 | æœç´¢æ¶ˆæ¯ | âŒ æ—  | âŒ ç¼ºå¤± | æ–°å¢ 8h |
| 15 | æ¶ˆæ¯ç»Ÿè®¡ | âŒ æ—  | âŒ ç¼ºå¤± | æ–°å¢ 3h |

---

### æ¶ˆæ¯æ“ä½œ (1/5 âš ï¸ 20%)

| # | åŸç‰ˆ IM | Master | çŠ¶æ€ | å·¥ä½œ |
|---|---------|--------|------|------|
| 16 | æ ‡è®°å·²è¯» | POST /api/v1/messages/:id/read | âš ï¸ éƒ¨åˆ† | æ”¹è¿› 4h |
| 17 | å‘é€æ¶ˆæ¯ | Socket.IO (æ—  HTTP) | âš ï¸ éƒ¨åˆ† | æ–°å¢ 6h |
| 18 | ç¼–è¾‘æ¶ˆæ¯ | âŒ æ—  | âŒ ç¼ºå¤± | æ–°å¢ 6h |
| 19 | åˆ é™¤æ¶ˆæ¯ | âŒ æ—  | âŒ ç¼ºå¤± | æ–°å¢ 4h |
| 20 | ä¼šè¯é™éŸ³ | âŒ æ—  | âŒ ç¼ºå¤± | æ–°å¢ 2h |

---

### ç”¨æˆ·ç®¡ç† (0/3 âŒ 0%)

| # | åŸç‰ˆ IM | Master | çŠ¶æ€ | å·¥ä½œ |
|---|---------|--------|------|------|
| 21 | ç”¨æˆ·ä¿¡æ¯ | âŒ æ—  | âŒ ç¼ºå¤± | æ–°å¢ 6h |
| 22 | æœç´¢ç”¨æˆ· | âŒ æ—  | âŒ ç¼ºå¤± | æ–°å¢ 3h |
| 23 | é»‘åå•ç®¡ç† | âŒ æ—  | âŒ ç¼ºå¤± | æ–°å¢ 4h |

---

## å·¥ä½œé‡æ€»ç»“

### æŒ‰ä¼˜å…ˆçº§åˆ†ç»„

| ä¼˜å…ˆçº§ | ç±»åˆ« | æ¥å£æ•° | å·¥ä½œé‡ | ç›®æ ‡ |
|--------|------|--------|--------|------|
| ğŸ”´ P1 | å¿…é¡» | 14 | 50h | 100% å…¼å®¹åŸç‰ˆ |
| ğŸŸ¡ P2 | é‡è¦ | 5 | 21h | é«˜çº§åŠŸèƒ½ |
| ğŸŸ¢ P3 | å¯é€‰ | 2 | 7h | å¢å¼ºåŠŸèƒ½ |

### æŒ‰å·¥ä½œç±»å‹åˆ†ç»„

| ç±»å‹ | æ¥å£æ•° | å·¥ä½œé‡ | è¯´æ˜ |
|------|--------|--------|------|
| âœ… å®Œå…¨å®ç° | 6 | 0h | è´¦æˆ·ç®¡ç†å·²å®Œæˆ |
| âš ï¸ éœ€æ”¹è¿› | 4 | 20h | ä¿®æ”¹ç°æœ‰æ¥å£ |
| âŒ éœ€æ–°å¢ | 14 | 58h | åˆ›å»ºæ–°æ¥å£ |

---

## æŒ‰ä¼˜å…ˆçº§çš„å®ç°è·¯çº¿

### ğŸ”´ P1 å¿…é¡»å®ç° (50 å°æ—¶)

#### ç¬¬ä¸€é˜¶æ®µï¼šæ”¹è¿›ç°æœ‰æ¥å£ (20 å°æ—¶)

```
1. ä¼šè¯åˆ—è¡¨æ”¹è¿› (6h)
   ä½ç½®: GET /api/v1/conversations
   æ”¹è¿›: cursoråˆ†é¡µ + unread_count + has_more + sort_by

2. æ¶ˆæ¯å†å²æ”¹è¿› (6h)
   ä½ç½®: GET /api/v1/direct-messages
   æ”¹è¿›: direction + has_more + æ—¶é—´ç­›é€‰

3. æ ‡è®°å·²è¯»æ”¹è¿› (4h)
   ä½ç½®: POST /api/v1/messages/:id/read
   æ”¹è¿›: æ”¯æŒæ‰¹é‡ + å¯¹è¯çº§æ ‡è®°

4. å‘é€æ¶ˆæ¯HTTP API (4h)
   ä½ç½®: POST /api/v1/messages/send
   æ–°å¢: HTTP ç›´æ¥å‘é€æ¥å£
```

#### ç¬¬äºŒé˜¶æ®µï¼šæ–°å¢æ ¸å¿ƒæ¥å£ (30 å°æ—¶)

```
1. ä¼šè¯è¯¦æƒ… (8h)
   æ–°å¢: GET /api/v1/conversations/:id?include_messages=true
   åŠŸèƒ½: è¿”å›å¯¹è¯è¯¦æƒ… + æ¶ˆæ¯åˆ—è¡¨

2. æœç´¢æ¶ˆæ¯ (8h)
   æ–°å¢: GET /api/v1/messages/search
   åŠŸèƒ½: å…¨æ–‡æœç´¢ + æ—¥æœŸè¿‡æ»¤ + ç±»å‹è¿‡æ»¤

3. ç”¨æˆ·ä¿¡æ¯ (6h)
   æ–°å¢: GET /api/v1/users/:userId
   åŠŸèƒ½: ç”¨æˆ·è¯¦æƒ…æŸ¥è¯¢

4. ç”¨æˆ·æœç´¢ (3h)
   æ–°å¢: GET /api/v1/users/search
   åŠŸèƒ½: ç”¨æˆ·åæœç´¢

5. ç”¨æˆ·é»‘åå• (4h)
   æ–°å¢: POST /api/v1/users/:userId/block
   åŠŸèƒ½: æ‹‰é»‘/è§£é™¤é»‘åå•

6. ä¼šè¯æœç´¢ (6h) - å¯é€‰å¹¶å…¥æ¶ˆæ¯æœç´¢
   æ–°å¢: GET /api/v1/conversations/search
   åŠŸèƒ½: æœç´¢ä¼šè¯
```

---

### ğŸŸ¡ P2 é‡è¦åŠŸèƒ½ (21 å°æ—¶)

```
1. ä¼šè¯ç½®é¡¶/é™éŸ³ (4h)
   æ–°å¢: PATCH /api/v1/conversations/:id/pin
   æ–°å¢: PATCH /api/v1/conversations/:id/mute

2. ç¼–è¾‘æ¶ˆæ¯ (6h)
   æ–°å¢: PATCH /api/v1/messages/:id
   åŠŸèƒ½: ç¼–è¾‘ + å†å²è®°å½•

3. åˆ é™¤æ¶ˆæ¯ (4h)
   æ–°å¢: DELETE /api/v1/messages/:id
   åŠŸèƒ½: è½¯åˆ é™¤ + å®¡è®¡

4. æ¶ˆæ¯ç»Ÿè®¡ (3h)
   æ–°å¢: GET /api/v1/messages/stats
   åŠŸèƒ½: ç»Ÿè®¡æ•°æ®

5. æŒ‰ç±»å‹æŸ¥è¯¢ (4h)
   æ–°å¢: GET /api/v1/messages?type=image
   åŠŸèƒ½: æŒ‰æ¶ˆæ¯ç±»å‹è¿‡æ»¤
```

---

### ğŸŸ¢ P3 å¯é€‰åŠŸèƒ½ (7 å°æ—¶)

```
1. é«˜çº§æœç´¢ (3h)
2. æ¶ˆæ¯ç¼“å­˜ä¼˜åŒ– (4h)
```

---

## å…³é”®æ•°æ®è½¬æ¢

### æ—¶é—´å•ä½è½¬æ¢

```javascript
// ä» Master (ç§’) è½¬æ¢åˆ° IM (æ¯«ç§’)
const imTimestamp = masterTimestamp * 1000;

// ä» IM (æ¯«ç§’) è½¬æ¢åˆ° Master (ç§’)
const masterTimestamp = Math.floor(imTimestamp / 1000);

// ç¤ºä¾‹
masterTimestamp = 1697980000      // ç§’
imTimestamp = 1697980000000       // æ¯«ç§’
```

---

### åˆ†é¡µæ–¹å¼è½¬æ¢

```javascript
// IM çš„ cursor åˆ†é¡µ
const imRequest = {
  cursor: 0,
  count: 50
};

// Master çš„ offset/limit
const masterQuery = {
  offset: 0,
  limit: 50
};

// ç›¸äº’è½¬æ¢
const cursor = offset / limit;     // IM cursor = Master offset / limit
const offset = cursor * limit;     // Master offset = IM cursor Ã— limit
```

---

### ä¼šè¯ ID æ ¼å¼

| ç³»ç»Ÿ | æ ¼å¼ | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|------|
| åŸç‰ˆ IM | user_id æˆ–ç‰¹æ®Šæ ¼å¼ | å¯¹æ–¹çš„ user_id æˆ– MD5 | `user_456` æˆ– `123456_abcdef` |
| Master | è‡ªå¢ ID | è¯„è®º ID æˆ–å¯¹è¯ ID | `comment_123` æˆ– `conv_456` |

éœ€è¦å»ºç«‹æ˜ å°„è¡¨å°†ä¸¤è€…å…³è”ã€‚

---

## é‡ç‚¹æŸ¥è¯¢

### "æŸä¸ªåŠŸèƒ½ Master æœ‰å—ï¼Ÿ"

ç›´æ¥çœ‹è¡¨ä¸­çŠ¶æ€åˆ—ï¼š
- âœ… å®Œå…¨åŒ¹é… = å®Œå…¨å…¼å®¹
- âš ï¸ éƒ¨åˆ† = æœ‰ä½†éœ€æ”¹è¿›
- âŒ ç¼ºå¤± = å®Œå…¨æ²¡æœ‰

### "è¿™ä¸ªåŠŸèƒ½è¦èŠ±å¤šä¹…ï¼Ÿ"

çœ‹å¯¹åº”è¡Œçš„"å·¥ä½œ"åˆ—ï¼š
- 0h = å·²å®Œæˆ
- 2-4h = å°ä¿®æ”¹
- 6h = ä¸­ç­‰å·¥ä½œ
- 8h = å¤§å·¥ä½œ

### "æŒ‰ä¼˜å…ˆçº§å®ç°éœ€è¦å¤šä¹…ï¼Ÿ"

- P1 å¿…é¡»: 50 å°æ—¶ (çº¦ 6-7 ä¸ªå·¥ä½œæ—¥)
- P1+P2: 71 å°æ—¶ (çº¦ 9 ä¸ªå·¥ä½œæ—¥)
- å…¨éƒ¨: 78 å°æ—¶ (çº¦ 10 ä¸ªå·¥ä½œæ—¥)

---

## ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | ç”¨é€” | å†…å®¹ |
|------|------|------|
| [åŸç‰ˆIM-APIæ¸…å•.md](./åŸç‰ˆIM-APIæ¸…å•.md) | âœ“ è¯¦ç»†å‚è€ƒ | åŸç‰ˆ 24 ä¸ªæ¥å£çš„å®Œæ•´å®šä¹‰ |
| [Master-APIç°æœ‰æ¸…å•.md](./Master-APIç°æœ‰æ¸…å•.md) | âœ“ è¯¦ç»†å‚è€ƒ | Master 50+ ä¸ªæ¥å£çš„å®Œæ•´åˆ—è¡¨ |
| [13-Masterç¼ºå¤±æ¥å£ç²¾å‡†å¯¹æ¯”.md](./13-Masterç¼ºå¤±æ¥å£ç²¾å‡†å¯¹æ¯”.md) | âœ“ å®ç°æŒ‡å— | ç¼ºå¤±æ¥å£ + ä»£ç æ¡†æ¶ |
| [APIå¯¹æ¯”æ€»ç»“-åŸç‰ˆIM-vs-Master.md](./APIå¯¹æ¯”æ€»ç»“-åŸç‰ˆIM-vs-Master.md) | âœ“ æ·±åº¦åˆ†æ | è¯¦ç»†çš„å·®å¼‚åˆ†æå’Œå»ºè®® |

---

## å¿«é€Ÿå¯¼èˆª

### æˆ‘æƒ³...

- **äº†è§£åŸç‰ˆ IM æœ‰ä»€ä¹ˆåŠŸèƒ½**: çœ‹[åŸç‰ˆIM-APIæ¸…å•.md](./åŸç‰ˆIM-APIæ¸…å•.md)
- **äº†è§£ Master ç°åœ¨æœ‰ä»€ä¹ˆ**: çœ‹[Master-APIç°æœ‰æ¸…å•.md](./Master-APIç°æœ‰æ¸…å•.md)
- **å¿«é€Ÿå¯¹æ¯”ä¸¤è€…çš„å·®å¼‚**: **çœ‹è¿™ä¸ªæ–‡æ¡£** (æœ¬æ–‡) â† ä½ åœ¨è¿™é‡Œ
- **äº†è§£è¯¦ç»†å®ç°ç»†èŠ‚**: çœ‹[13-Masterç¼ºå¤±æ¥å£ç²¾å‡†å¯¹æ¯”.md](./13-Masterç¼ºå¤±æ¥å£ç²¾å‡†å¯¹æ¯”.md)
- **åšæ·±åº¦åˆ†æäº†è§£å½±å“**: çœ‹[APIå¯¹æ¯”æ€»ç»“-åŸç‰ˆIM-vs-Master.md](./APIå¯¹æ¯”æ€»ç»“-åŸç‰ˆIM-vs-Master.md)

---

## ç»Ÿè®¡é€Ÿè§ˆ

```
åŸç‰ˆ IM æ¥å£ç»Ÿè®¡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
è´¦æˆ·ç®¡ç†    6 ä¸ª âœ… 100%
ä¼šè¯æŸ¥è¯¢    4 ä¸ª âš ï¸  25%
æ¶ˆæ¯æŸ¥è¯¢    6 ä¸ª âš ï¸  33%
æ¶ˆæ¯æ“ä½œ    5 ä¸ª âš ï¸  20%
ç”¨æˆ·ç®¡ç†    3 ä¸ª âŒ  0%
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ€»è®¡       24 ä¸ª 42%

å·¥ä½œé‡ä¼°è®¡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ”¹è¿›ç°æœ‰    20 å°æ—¶
æ–°å¢æ ¸å¿ƒ    30 å°æ—¶
æ–°å¢é«˜çº§    21 å°æ—¶
æ–°å¢å¯é€‰     7 å°æ—¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ€»è®¡       78 å°æ—¶

ä¼˜å…ˆçº§åˆ†ç»„
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
P1 å¿…é¡»    50 å°æ—¶ â† å»ºè®®é¦–å…ˆå®Œæˆ
P2 é‡è¦    21 å°æ—¶
P3 å¯é€‰     7 å°æ—¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ€»è®¡       78 å°æ—¶
```

---

**æœ€åæ›´æ–°**: 2025-10-23

