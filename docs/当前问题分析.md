# å½“å‰é—®é¢˜åˆ†æï¼šèœ˜è››ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œ

## é—®é¢˜ç°è±¡

èœ˜è››ä»»åŠ¡ï¼ˆçˆ¬è™«ï¼‰æ²¡æœ‰è¢«æ‰§è¡Œï¼Œæ•°æ®åº“ä¸­æ²¡æœ‰æŠ“å–åˆ°ä»»ä½•æ•°æ®ã€‚

## è¯Šæ–­ç»“æœ

### è´¦æˆ·çŠ¶æ€ï¼ˆæ•°æ®åº“ï¼‰
```
è´¦æˆ·ID: acc-98296c87-2e42-447a-9d8b-8be008ddb6e4
å¹³å°: douyin
è´¦æˆ·å: douyin-test
ç™»å½•çŠ¶æ€: not_logged_in âŒ
WorkerçŠ¶æ€: offline âŒ
å¹³å°ç”¨æˆ·ID: 1864722759 âœ… (æœ‰å€¼)
é”™è¯¯ä¿¡æ¯: Account missing platform_user_id âŒ
```

### WorkerçŠ¶æ€
```
Worker ID: worker1
çŠ¶æ€: online âœ…
åˆ†é…è´¦æˆ·æ•°: 1
æœ€åå¿ƒè·³: 2025/10/24 19:01:51
```

## é—®é¢˜åŸå› 

### ä¸»è¦é—®é¢˜
è´¦æˆ·çš„ `login_status` æ˜¯ `not_logged_in`ï¼Œè™½ç„¶æ•°æ®åº“ä¸­æœ‰ `platform_user_id`ï¼Œä½†Workeråœ¨å¯åŠ¨æ—¶æ£€æµ‹åˆ°æœªç™»å½•çŠ¶æ€ï¼Œå› æ­¤ï¼š

1. **Workerè®¤ä¸ºè´¦æˆ·æœªç™»å½•**ï¼Œä¸ä¼šå¯åŠ¨çˆ¬è™«ä»»åŠ¡
2. **Workerç¼“å­˜ä¸­çš„è´¦æˆ·é…ç½®å¯èƒ½æ˜¯æ—§çš„**ï¼ˆä»ä¸Šæ¬¡é‡å¯å‰æ®‹ç•™ï¼‰
3. **éœ€è¦é‡æ–°ç™»å½•**æ¥è§¦å‘å®Œæ•´çš„ç™»å½•æµç¨‹å’Œé…ç½®çƒ­æ›´æ–°

### ä¸ºä»€ä¹ˆæœ‰platform_user_idä½†ä»æ˜¾ç¤ºæœªç™»å½•ï¼Ÿ

å¯èƒ½çš„åŸå› ï¼š
1. ä¹‹å‰ç™»å½•æˆåŠŸåï¼ŒWorkerå´©æºƒæˆ–é‡å¯
2. æ•°æ®åº“ä¸­`login_status`æ²¡æœ‰è¢«æ­£ç¡®æ›´æ–°ä¸º`logged_in`
3. Workeré‡å¯åï¼Œè´¦æˆ·çŠ¶æ€è¢«é‡æ–°æ£€æµ‹ä¸º`not_logged_in`

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šé‡æ–°ç™»å½•ï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç®€å•ç›´æ¥çš„æ–¹æ³•ï¼Œå¯ä»¥åŒæ—¶éªŒè¯é…ç½®çƒ­æ›´æ–°æœºåˆ¶ï¼š

1. **æ‰“å¼€Admin UI** (http://localhost:3001)
2. **ç‚¹å‡»è´¦æˆ·çš„"ç™»å½•"æŒ‰é’®**
3. **æ‰«æäºŒç»´ç ç¡®è®¤ç™»å½•**
4. **è§‚å¯Ÿæ—¥å¿—è¾“å‡º**ï¼š
   - Masteråº”æ˜¾ç¤ºï¼š"Sent config update notification to Worker worker1"
   - Workeråº”æ˜¾ç¤ºï¼š"Received account config update notification"
   - Workeråº”æ˜¾ç¤ºï¼š"Account config reloaded"

5. **ç­‰å¾…1-2åˆ†é’Ÿ**ï¼Œçˆ¬è™«ä»»åŠ¡åº”è‡ªåŠ¨å¼€å§‹æ‰§è¡Œ

### æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨æ›´æ–°login_statusï¼ˆä¸æ¨èï¼‰

ç›´æ¥ä¿®æ”¹æ•°æ®åº“ï¼š
```sql
UPDATE accounts
SET login_status = 'logged_in'
WHERE id = 'acc-98296c87-2e42-447a-9d8b-8be008ddb6e4';
```

ä½†è¿™æ ·åšï¼š
- âŒ ä¸ä¼šè§¦å‘é…ç½®çƒ­æ›´æ–°
- âŒ æ— æ³•éªŒè¯é…ç½®çƒ­æ›´æ–°æœºåˆ¶æ˜¯å¦å·¥ä½œ
- âŒ Workerå¯èƒ½ä»ç„¶ä½¿ç”¨æ—§é…ç½®

### æ–¹æ¡ˆ3ï¼šé‡å¯Workeråæ‰‹åŠ¨æ›´æ–°ï¼ˆä¸æ¨èï¼‰

1. æ‰‹åŠ¨æ›´æ–°æ•°æ®åº“login_status
2. é‡å¯Worker
3. Workeré‡æ–°åŠ è½½é…ç½®

ä½†è¿™æ ·ï¼š
- âŒ å¤±å»äº†é…ç½®çƒ­æ›´æ–°çš„æ„ä¹‰
- âŒ æ¯æ¬¡éƒ½éœ€è¦é‡å¯ï¼Œä¸ç¬¦åˆç”Ÿäº§ç¯å¢ƒéœ€æ±‚

## æ¨èæ“ä½œæ­¥éª¤

### âœ… æ‰§è¡Œé‡æ–°ç™»å½•æµ‹è¯•

1. **æ‰“å¼€Admin UI**
   ```
   http://localhost:3001
   ```

2. **ç‚¹å‡»"ç™»å½•"æŒ‰é’®**
   - æ‰¾åˆ°è´¦æˆ· `douyin-test`
   - ç‚¹å‡»ç™»å½•æŒ‰é’®

3. **æ‰«æäºŒç»´ç **
   - ç”¨æŠ–éŸ³APPæ‰«ç 
   - ç¡®è®¤ç™»å½•

4. **è§‚å¯ŸMasteræ—¥å¿—**ï¼ˆå…³é”®ï¼‰
   ```bash
   # åœ¨åå°bashè¾“å‡ºä¸­æŸ¥çœ‹ï¼Œæˆ–æŸ¥çœ‹æ§åˆ¶å°
   ```

   **é¢„æœŸè¾“å‡º**ï¼š
   ```
   [login-handler] Login success for session xxx
   [login-handler] Updated platform_user_id to: 1864722759
   [login-handler] Sent config update notification to Worker worker1  // â­ å…³é”®
   ```

5. **è§‚å¯ŸWorkeræ—¥å¿—**

   **é¢„æœŸè¾“å‡º**ï¼š
   ```
   [socket-client] ğŸ“¥ Received account config update notification from Master
   [worker] ğŸ”„ Reloading configuration for account acc-xxx...
   [worker] âœ… Account config reloaded
   [task-runner] âœ… Updated account config in MonitorTask
   ```

6. **ç­‰å¾…çˆ¬è™«æ‰§è¡Œ**ï¼ˆ1-2åˆ†é’Ÿåï¼‰

   **é¢„æœŸè¾“å‡º**ï¼š
   ```
   [monitor-task] Starting monitoring task for account acc-xxx
   [douyin-platform] Crawling comments...
   [douyin-platform] Found X comments
   ```

7. **éªŒè¯æ•°æ®æŠ“å–**
   ```bash
   node tests/æµ‹è¯•çˆ¬è™«ä»»åŠ¡æ‰§è¡Œ.js
   ```

   **é¢„æœŸç»“æœ**ï¼š
   - commentsè¡¨ä¸­æœ‰æ•°æ®
   - worksè¡¨ä¸­æœ‰æ•°æ®
   - WorkerçŠ¶æ€ä¸å†æ˜¯offline
   - æ²¡æœ‰"missing platform_user_id"é”™è¯¯

## éªŒè¯æ¸…å•

ç™»å½•æˆåŠŸåï¼Œæ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

### Masterç«¯
- [ ] æ—¥å¿—æ˜¾ç¤º"Login success"
- [ ] æ—¥å¿—æ˜¾ç¤º"Updated platform_user_id"
- [ ] **æ—¥å¿—æ˜¾ç¤º"Sent config update notification"** â­ å…³é”®
- [ ] æ•°æ®åº“accounts.login_status = 'logged_in'
- [ ] æ•°æ®åº“accounts.platform_user_idæœ‰å€¼

### Workerç«¯
- [ ] **æ—¥å¿—æ˜¾ç¤º"Received account config update notification"** â­ å…³é”®
- [ ] **æ—¥å¿—æ˜¾ç¤º"Account config reloaded"** â­ å…³é”®
- [ ] **æ—¥å¿—æ˜¾ç¤º"Updated account config in MonitorTask"** â­ å…³é”®
- [ ] WorkerçŠ¶æ€å˜ä¸ºonline
- [ ] ä¸å†æŠ¥"missing platform_user_id"é”™è¯¯
- [ ] çˆ¬è™«ä»»åŠ¡å¼€å§‹æ‰§è¡Œ

### æ•°æ®åº“
- [ ] commentsè¡¨æœ‰æ–°æ•°æ®
- [ ] worksè¡¨æœ‰æ–°æ•°æ®
- [ ] direct_messagesè¡¨æœ‰æ–°æ•°æ®ï¼ˆå¦‚æœ‰ç§ä¿¡ï¼‰
- [ ] conversationsè¡¨æœ‰æ–°æ•°æ®ï¼ˆå¦‚æœ‰ä¼šè¯ï¼‰

## å½“å‰æœåŠ¡ä¿¡æ¯

**Master**ï¼š
- å¯åŠ¨æ—¶é—´ï¼š2025-10-24 18:59:30
- çŠ¶æ€ï¼šè¿è¡Œä¸­ âœ…
- ç«¯å£ï¼š3000
- åŒ…å«é…ç½®çƒ­æ›´æ–°ä»£ç  âœ…

**Worker**ï¼š
- å¯åŠ¨æ—¶é—´ï¼š2025-10-24 18:59:31
- çŠ¶æ€ï¼šonline âœ…
- Worker IDï¼šworker1
- åŒ…å«é…ç½®çƒ­æ›´æ–°ä»£ç  âœ…

**è´¦æˆ·**ï¼š
- ç™»å½•çŠ¶æ€ï¼šnot_logged_in âŒ **éœ€è¦é‡æ–°ç™»å½•**
- WorkerçŠ¶æ€ï¼šoffline âŒ
- platform_user_idï¼š1864722759 âœ…

## æ€»ç»“

**æ ¸å¿ƒé—®é¢˜**ï¼šè´¦æˆ·çš„login_statusæ˜¯not_logged_inï¼ŒWorkerè®¤ä¸ºè´¦æˆ·æœªç™»å½•ï¼Œå› æ­¤ä¸å¯åŠ¨çˆ¬è™«ä»»åŠ¡ã€‚

**è§£å†³æ–¹æ³•**ï¼šé‡æ–°ç™»å½•ï¼ŒåŒæ—¶éªŒè¯é…ç½®çƒ­æ›´æ–°æœºåˆ¶æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

**ä¸‹ä¸€æ­¥**ï¼šåœ¨Admin UIä¸­ç‚¹å‡»"ç™»å½•"æŒ‰é’®ï¼Œæ‰«ç ç™»å½•ï¼Œç„¶åè§‚å¯Ÿæ—¥å¿—è¾“å‡ºã€‚

---

**åˆ†ææ—¶é—´**ï¼š2025-10-24 19:02
**ä¸‹ä¸€æ­¥**ï¼šæ‰§è¡Œé‡æ–°ç™»å½•æ“ä½œ
