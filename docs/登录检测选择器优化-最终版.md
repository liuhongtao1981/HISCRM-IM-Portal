# ç™»å½•æ£€æµ‹é€‰æ‹©å™¨ä¼˜åŒ– - æœ€ç»ˆç‰ˆ

## ä¼˜åŒ–æ—¶é—´
2025-10-24 14:30

## é—®é¢˜èƒŒæ™¯

ä¹‹å‰çš„ç™»å½•æ£€æµ‹é€»è¾‘ä½¿ç”¨äº†è¿‡äºå®½æ³›çš„é€‰æ‹©å™¨ï¼Œå¯¼è‡´è¯¯å°†é¡µé¢ä¸Šçš„å…¶ä»–å¤´åƒå…ƒç´ å½“æˆç”¨æˆ·ç™»å½•å¤´åƒï¼Œé€ æˆè¯¯æŠ¥ã€‚

### è¯¯æŠ¥åœºæ™¯
```javascript
// âŒ æ—§çš„é€‰æ‹©å™¨ï¼ˆå¤ªå®½æ³›ï¼‰
const avatarSelectors = [
  '#header-avatar > div',
  '#header-avatar',
  'header [class*="avatar"]',    // â† ä¼šåŒ¹é…é¡µé¢ä»»ä½•åŒ…å« avatar çš„å…ƒç´ 
  '.header [class*="avatar"]',
];
```

**é—®é¢˜**ï¼šé€‰æ‹©å™¨ `header [class*="avatar"]` ä¼šåŒ¹é…åˆ°é¡µé¢å†…å®¹ä¸­çš„è£…é¥°æ€§å¤´åƒï¼Œè€Œä¸ä»…ä»…æ˜¯ç”¨æˆ·ç™»å½•å¤´åƒã€‚

## è§£å†³æ–¹æ¡ˆ

ä½¿ç”¨ **Playwright MCP Chrome DevTools** ç²¾ç¡®å®šä½é¡µé¢å…ƒç´ ï¼Œè·å–å‡†ç¡®çš„ CSS é€‰æ‹©å™¨ã€‚

### ä½¿ç”¨ Chrome DevTools å®šä½å…ƒç´ 

1. **æ‰“å¼€æŠ–éŸ³åˆ›ä½œè€…ä¸­å¿ƒ**ï¼š
   ```javascript
   await page.goto('https://creator.douyin.com/creator-micro/home');
   ```

2. **ç”¨æˆ·æä¾›å‡†ç¡®çš„é€‰æ‹©å™¨**ï¼š
   ```
   #garfish_app_for_douyin_creator_pc_home_9y9g9kep > div > div:nth-child(2) > div > div.content-z4oZvZ > div.container-vEyGlK
   ```

3. **é€šè¿‡ page.evaluate æå–ç”¨æˆ·ä¿¡æ¯**ï¼š
   ```javascript
   const result = await page.evaluate(() => {
     const selector = 'div.container-vEyGlK';
     const container = document.querySelector(selector);

     const textContent = container.textContent;
     const douyinIdMatch = textContent.match(/æŠ–éŸ³å·ï¼š(\d+)/);
     const avatarImg = container.querySelector('img');

     return {
       hasDouyinId: !!douyinIdMatch,
       douyinId: douyinIdMatch ? douyinIdMatch[1] : null,
       hasAvatar: !!avatarImg,
       avatarSrc: avatarImg ? avatarImg.src : null
     };
   });
   ```

### æå–åˆ°çš„ç”¨æˆ·ä¿¡æ¯

```json
{
  "found": true,
  "textContent": "å®é™è‡´è¿œæŠ–éŸ³å·ï¼š95759617533â˜ï¸â‘ â‘§â‘¥ğŸ¤”â‘£â‘¤â“ªâ‘¢ğŸ˜Šâ‘¡â‘¤â“ªâ‘¤\nå°Šé‡ç”Ÿå‘½ï¼Œå¥½å¥½å‘Šåˆ«å…³æ³¨ 110ç²‰ä¸ 416è·èµ 2219",
  "hasDouyinId": true,
  "douyinId": "95759617533",
  "nickname": "å®é™è‡´è¿œ",
  "hasAvatar": true,
  "avatarSrc": "https://p11.douyinpic.com/aweme/100x100/aweme-avatar/tos-cn-i-0813c000-ce_oobd56AuIECv2UAEPfoARDlEyQgCeWAfwA1FG9.jpeg?from=2956013662"
}
```

### ç²¾ç¡®çš„ DOM ç»“æ„

```html
<div class="container-vEyGlK">
  <div class="avatar-XoPjK6">
    <img class="img-PeynF_" src="https://p11.douyinpic.com/...">
  </div>
  <div class="content-fFY6HC">
    <div class="header-_F2uzl">
      <div class="left-zEzdJX">
        <div class="name-_lSSDc">å®é™è‡´è¿œ</div>
        <div class="accountIdentityTags-QWXxCC"></div>
      </div>
      <div class="unique_id-EuH8eA">æŠ–éŸ³å·ï¼š95759617533</div>
      <div class="signature-HLGxt7">â˜ï¸â‘ â‘§â‘¥ğŸ¤”â‘£â‘¤â“ªâ‘¢ğŸ˜Šâ‘¡â‘¤â“ªâ‘¤ å°Šé‡ç”Ÿå‘½ï¼Œå¥½å¥½å‘Šåˆ«</div>
    </div>
    <!-- å…³æ³¨ã€ç²‰ä¸ã€è·èµæ•°æ® -->
  </div>
</div>
```

## ä¼˜åŒ–åçš„é€‰æ‹©å™¨

### 1. ç”¨æˆ·ä¿¡æ¯å®¹å™¨
```javascript
const userContainerSelectors = [
  'div.container-vEyGlK',        // âœ“ ç²¾ç¡® classï¼ˆChrome DevTools ç¡®è®¤ï¼‰
  'div[class*="container-"]',    // æ¨¡ç³ŠåŒ¹é…ï¼ˆé˜²æ­¢ class åå˜åŒ–ï¼‰
];
```

### 2. æŠ–éŸ³å·å…ƒç´ 
```javascript
const douyinIdSelectors = [
  'div.unique_id-EuH8eA',        // âœ“ ç²¾ç¡® classï¼ˆChrome DevTools ç¡®è®¤ï¼‰
  'div[class*="unique_id-"]',    // æ¨¡ç³ŠåŒ¹é…
];
```

### 3. ç”¨æˆ·å¤´åƒ
```javascript
const avatarSelectors = [
  'div.avatar-XoPjK6 img',       // âœ“ ç²¾ç¡®è·¯å¾„ï¼ˆChrome DevTools ç¡®è®¤ï¼‰
  'img.img-PeynF_',              // âœ“ ç²¾ç¡® classï¼ˆChrome DevTools ç¡®è®¤ï¼‰
  'div[class*="avatar-"] img[src*="douyinpic.com"]',  // CDN éªŒè¯
];
```

### 4. ç”¨æˆ·æ˜µç§°
```javascript
const nicknameSelectors = [
  'div.name-_lSSDc',             // âœ“ ç²¾ç¡® classï¼ˆChrome DevTools ç¡®è®¤ï¼‰
  '[class*="name-"]',            // æ¨¡ç³ŠåŒ¹é…
];
```

## æ–°çš„ checkLoginStatus æ–¹æ³•

### æ£€æµ‹ç­–ç•¥ï¼ˆä¸‰å±‚éªŒè¯ï¼‰

```javascript
async checkLoginStatus(page) {
  // ç­‰å¾…é¡µé¢åŠ è½½
  await page.waitForTimeout(2000);

  // æ–¹æ³•1: æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯å®¹å™¨ï¼ˆæœ€å¯é ï¼‰
  const container = await page.$('div.container-vEyGlK');
  if (container && await container.isVisible()) {
    const text = await container.textContent();
    if (text && text.includes('æŠ–éŸ³å·ï¼š')) {
      return true; // âœ“ å·²ç™»å½•
    }
  }

  // æ–¹æ³•2: æ£€æŸ¥æŠ–éŸ³å·å…ƒç´ 
  const douyinIdElement = await page.$('div.unique_id-EuH8eA');
  if (douyinIdElement && await douyinIdElement.isVisible()) {
    const text = await douyinIdElement.textContent();
    if (text && text.includes('æŠ–éŸ³å·ï¼š')) {
      return true; // âœ“ å·²ç™»å½•
    }
  }

  // æ–¹æ³•3: æ£€æŸ¥ç”¨æˆ·å¤´åƒï¼ˆç‰¹å®šä½ç½®ï¼‰
  const avatar = await page.$('div.avatar-XoPjK6 img');
  if (avatar && await avatar.isVisible()) {
    const src = await avatar.getAttribute('src');
    if (src && src.includes('douyinpic.com')) {
      return true; // âœ“ å·²ç™»å½•
    }
  }

  return false; // âœ— æœªç™»å½•
}
```

### ä¼˜åŠ¿

1. **âœ“ ç²¾ç¡®å®šä½**ï¼šä½¿ç”¨ Chrome DevTools ç¡®è®¤çš„å‡†ç¡®é€‰æ‹©å™¨
2. **âœ“ ä¸‰å±‚éªŒè¯**ï¼šå®¹å™¨ + æŠ–éŸ³å· + å¤´åƒï¼Œé€å±‚éªŒè¯
3. **âœ“ é˜²æ­¢è¯¯æŠ¥**ï¼šåªæ£€æŸ¥ç‰¹å®šä½ç½®çš„ç”¨æˆ·ä¿¡æ¯å®¹å™¨
4. **âœ“ é˜²æ­¢ class å˜åŒ–**ï¼šåŒæ—¶æä¾›ç²¾ç¡®å’Œæ¨¡ç³ŠåŒ¹é…é€‰æ‹©å™¨

## ä¸æµ‹è¯•ç»“æœå¯¹æ¯”

### æµ‹è¯•æ•°æ®ï¼ˆ2025-10-24 14:29ï¼‰
```json
{
  "status": "success",
  "user_info": {
    "avatar": "https://p3.douyinpic.com/aweme/720x720/aweme-avatar/tos-cn-avt-0015_21b4383e542b8991bcd33d33eeda7d8d.jpeg?from=2956013662",
    "nickname": "æŠ–éŸ³åˆ›ä½œè€…ä¸­å¿ƒÂ·åˆ›ä½œè€…",
    "douyin_id": null
  }
}
```

**é—®é¢˜**ï¼š
- âŒ æ˜µç§°é”™è¯¯ï¼š"æŠ–éŸ³åˆ›ä½œè€…ä¸­å¿ƒÂ·åˆ›ä½œè€…"ï¼ˆé¡µé¢æ ‡é¢˜ï¼‰è€Œä¸æ˜¯ "å®é™è‡´è¿œ"
- âŒ æŠ–éŸ³å·ç¼ºå¤±ï¼šåº”è¯¥æ˜¯ "95759617533"
- âŒ å¤´åƒä¸åŒ¹é…ï¼šä¸åŒçš„ CDN åœ°å€

### Chrome DevTools å®é™…æ•°æ®
```json
{
  "nickname": "å®é™è‡´è¿œ",           // âœ“ æ­£ç¡®
  "douyinId": "95759617533",       // âœ“ æ­£ç¡®
  "avatarSrc": "https://p11.douyinpic.com/aweme/100x100/..." // âœ“ æ­£ç¡®
}
```

## ç»“è®º

**åŸå› åˆ†æ**ï¼š
1. æ—§çš„é€‰æ‹©å™¨å¤ªå®½æ³›ï¼ŒåŒ¹é…åˆ°é¡µé¢å…¶ä»–å…ƒç´ 
2. æ²¡æœ‰ç²¾ç¡®å®šä½ç”¨æˆ·ä¿¡æ¯å®¹å™¨çš„ä½ç½®
3. ä¾èµ– URL å’Œé¡µé¢æ–‡æœ¬åˆ¤æ–­ï¼Œå®¹æ˜“è¯¯åˆ¤

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. âœ… ä½¿ç”¨ Chrome DevTools ç²¾ç¡®å®šä½å…ƒç´ 
2. âœ… ä½¿ç”¨ç‰¹å®š class åç§°ï¼ˆcontainer-vEyGlK, unique_id-EuH8eA, avatar-XoPjK6ï¼‰
3. âœ… ä¸‰å±‚éªŒè¯æœºåˆ¶ï¼ˆå®¹å™¨ + æŠ–éŸ³å· + å¤´åƒï¼‰
4. âœ… éªŒè¯æ–‡æœ¬å†…å®¹ï¼ˆ"æŠ–éŸ³å·ï¼š"ï¼‰å’Œ CDN åŸŸåï¼ˆ"douyinpic.com"ï¼‰

## ä¸‹ä¸€æ­¥

1. é‡å¯ Worker è¿›ç¨‹åŠ è½½æ–°ä»£ç 
2. è¿è¡Œç™»å½•æµ‹è¯•éªŒè¯
3. ç¡®è®¤ä¸å†å‡ºç°è¯¯æŠ¥
4. æµ‹è¯•æœªç™»å½•çŠ¶æ€çš„ç™»å½•æµç¨‹

## ç›¸å…³æ–‡ä»¶

- `packages/worker/src/platforms/douyin/platform.js:174-263` - checkLoginStatus æ–¹æ³•
- `packages/worker/src/platforms/douyin/platform.js:573-668` - extractUserInfo æ–¹æ³•
- `docs/ç™»å½•åŠŸèƒ½ç®€åŒ–ç‰ˆæµ‹è¯•æŠ¥å‘Š.md` - ä¹‹å‰çš„æµ‹è¯•æŠ¥å‘Š
- `docs/ç™»å½•æ£€æµ‹é€»è¾‘-æœ€ç»ˆç®€åŒ–ç‰ˆ.md` - ç®€åŒ–æ–¹æ¡ˆè®¾è®¡æ–‡æ¡£

## å‚è€ƒ

- Chrome DevTools æ£€æŸ¥å…ƒç´ ï¼š`Ctrl+Shift+C`ï¼ˆWindowsï¼‰æˆ– `Cmd+Shift+C`ï¼ˆMacï¼‰
- Playwright MCP å·¥å…·ï¼š`mcp__playwright__browser_navigate`ã€`mcp__playwright__browser_evaluate`
- CSS é€‰æ‹©å™¨å‚è€ƒï¼šhttps://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors
