# Phase 11 - ç»Ÿä¸€é¡µé¢ç®¡ç†ç³»ç»Ÿæ¶æ„å›¾

**å¯è§†åŒ–æ¶æ„æ¦‚è§ˆ**

---

## ğŸ“ ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ğŸ¯ ä¸šåŠ¡å±‚ (Platforms)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  DouyinPlatform     â”‚  â”‚  XiaohongshuPlatform (æœªæ¥)       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ startLogin()  â”‚  â”‚  â”‚  â”‚ startLogin()              â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ crawlComments â”‚  â”‚  â”‚  â”‚ crawlComments()           â”‚    â”‚  â”‚
â”‚  â”‚  â”‚   crawlDMs    â”‚  â”‚  â”‚  â”‚ crawlDirectMessages()     â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                              â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                              â”‚
              â”‚ è°ƒç”¨                         â”‚ è°ƒç”¨
              â”‚                              â”‚
              â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               âš™ï¸ å¹³å°å±‚ (PlatformBase)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        async getAccountPage(accountId, options)          â”‚   â”‚
â”‚  â”‚  â€¢ ç»Ÿä¸€çš„é¡µé¢è·å–æ¥å£                                    â”‚   â”‚
â”‚  â”‚  â€¢ æ‰€æœ‰å¹³å°éƒ½å¿…é¡»ä½¿ç”¨è¿™ä¸ªæ–¹æ³•                            â”‚   â”‚
â”‚  â”‚  â€¢ è‡ªåŠ¨å¤„ç†é¡µé¢æ± æŸ¥è¯¢å’Œåˆ›å»º                              â”‚   â”‚
â”‚  â”‚  â€¢ æ·»åŠ å¹³å°ç‰¹å®šçš„æ—¥å¿—                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â”‚                                             â”‚
â”‚                     â”‚ å§”æ‰˜ç»™ BrowserManager                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ–¥ï¸ æµè§ˆå™¨ç®¡ç†å±‚ (BrowserManagerV2)                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           ğŸ“¦ é¡µé¢æ±  (accountPages Map)                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ account-123 â†’ Page {closed: false, ...}         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ account-456 â†’ Page {closed: false, ...}         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ account-789 â†’ Page {closed: true, ...}  ğŸ”´      â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚         ğŸ“Š ä½¿ç”¨ç»Ÿè®¡ (pageUsageStats Map)              â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚
â”‚  â”‚  â”‚ account-123:                                  â”‚   â”‚     â”‚
â”‚  â”‚  â”‚  â€¢ usageCount: 5                             â”‚   â”‚     â”‚
â”‚  â”‚  â”‚  â€¢ createdAt: 1634567890000                 â”‚   â”‚     â”‚
â”‚  â”‚  â”‚  â€¢ lastUsedAt: 1634567900000                â”‚   â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  ğŸ”§ æ ¸å¿ƒæ–¹æ³•:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ âœ… getAccountPage()        - è·å–æˆ–åˆ›å»ºé¡µé¢           â”‚     â”‚
â”‚  â”‚ âœ… savePageForAccount()    - ä¿å­˜é¡µé¢åˆ°æ±             â”‚     â”‚
â”‚  â”‚ âœ… isPageAlive()           - æ£€æŸ¥é¡µé¢æœ‰æ•ˆæ€§          â”‚     â”‚
â”‚  â”‚ âœ… recordPageUsage()       - è®°å½•ä½¿ç”¨ç»Ÿè®¡            â”‚     â”‚
â”‚  â”‚ âœ… recoverPage()           - è‡ªåŠ¨æ¢å¤å¤±è´¥é¡µé¢        â”‚     â”‚
â”‚  â”‚ âœ… startPageHealthCheck()  - å®šæœŸå¥åº·æ£€æŸ¥ (30s)      â”‚     â”‚
â”‚  â”‚ âœ… getPageStats()          - è·å–ç»Ÿè®¡ä¿¡æ¯            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ é¡µé¢ç”Ÿå‘½å‘¨æœŸæµ

```
â”Œâ”€ åˆå§‹åŒ– (é¦–æ¬¡å¯åŠ¨)
â”‚
â”œâ”€> BrowserManager æ„é€ å‡½æ•°
â”‚   â””â”€> this.accountPages = new Map()
â”‚   â””â”€> this.pageUsageStats = new Map()
â”‚   â””â”€> startPageHealthCheck() å¯åŠ¨å®šæœŸæ£€æŸ¥
â”‚
â”œâ”€ ç™»å½•æµç¨‹
â”‚
â”œâ”€> DouyinPlatform.startLogin()
â”‚   â””â”€> this.getAccountPage(accountId)
â”‚       â””â”€> PlatformBase.getAccountPage()
â”‚           â””â”€> BrowserManager.getAccountPage()
â”‚               â”œâ”€> æ£€æŸ¥ accountPages[accountId]
â”‚               â”‚   â”œâ”€ âœ… å­˜åœ¨ä¸”æœ‰æ•ˆ â†’ è¿”å›
â”‚               â”‚   â””â”€ âŒ ä¸å­˜åœ¨ â†’ åˆ›å»ºæ–°é¡µé¢
â”‚               â”œâ”€> åˆ›å»º: context.newPage()
â”‚               â”œâ”€> ä¿å­˜: this.accountPages.set(accountId, page)
â”‚               â”œâ”€> è®°å½•: recordPageUsage(accountId)
â”‚               â””â”€> è¿”å›: page
â”‚
â”‚   å¯¼èˆªåˆ°ç™»å½•é¡µ
â”‚   æ‰«ç /è¾“å…¥éªŒè¯ç 
â”‚   ç™»å½•æˆåŠŸ
â”‚   âœ… é¡µé¢ä»åœ¨æ± ä¸­
â”‚
â”œâ”€ çˆ¬è™«æµç¨‹
â”‚
â”œâ”€> MonitorTask.run()
â”‚   â””â”€> DouyinPlatform.crawlComments()
â”‚       â””â”€> this.getOrCreatePage(accountId)
â”‚           â””â”€> super.getAccountPage(accountId)
â”‚               â””â”€> PlatformBase.getAccountPage()
â”‚                   â””â”€> BrowserManager.getAccountPage()
â”‚                       â”œâ”€> æ£€æŸ¥ accountPages[accountId]
â”‚                       â”œâ”€ âœ… å‘ç°å·²æœ‰é¡µé¢
â”‚                       â”œâ”€> recordPageUsage(accountId)
â”‚                       â””â”€> è¿”å›ç›¸åŒçš„é¡µé¢ (å¤ç”¨!)
â”‚
â”‚   é¡µé¢å·²åŒ…å«ç™»å½•æ—¶çš„:
â”‚   â€¢ Cookies âœ…
â”‚   â€¢ æƒé™ âœ…
â”‚   â€¢ ç”¨æˆ·çŠ¶æ€ âœ…
â”‚   çˆ¬è™«æˆåŠŸæ‰§è¡Œ âœ…
â”‚
â”œâ”€ å®šæœŸå¥åº·æ£€æŸ¥ (æ¯30ç§’)
â”‚
â”œâ”€> startPageHealthCheck()
â”‚   â””â”€> å®šæ—¶å™¨å›è°ƒ
â”‚       â”œâ”€> éå† accountPages ä¸­çš„æ‰€æœ‰é¡µé¢
â”‚       â”œâ”€> å¯¹æ¯ä¸ªé¡µé¢è°ƒç”¨ isPageAlive(page)
â”‚       â”œâ”€ âœ… æœ‰æ•ˆ â†’ ä¿ç•™
â”‚       â”œâ”€ âŒ å·²å…³é—­ â†’ ä»æ± ä¸­åˆ é™¤
â”‚       â””â”€> è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
â”‚
â”œâ”€ é¡µé¢å´©æºƒæ¢å¤
â”‚
â”œâ”€> çˆ¬è™«ä»»åŠ¡æ‰§è¡Œä¸­
â”‚   â””â”€> page.goto() æŠ›å‡ºé”™è¯¯
â”‚       â””â”€> catch (error)
â”‚           â”œâ”€> æ£€æµ‹: "Target page, context or browser has been closed"
â”‚           â”œâ”€> recoverPage(accountId, 'closed')
â”‚           â”‚   â”œâ”€> accountPages.delete(accountId)
â”‚           â”‚   â”œâ”€> context.pages().forEach(p => p.close())
â”‚           â”‚   â”œâ”€> createPage()
â”‚           â”‚   â””â”€> savePageForAccount(accountId, newPage)
â”‚           â”œâ”€> ä½¿ç”¨æ–°é¡µé¢é‡è¯•
â”‚           â””â”€> âœ… ä»»åŠ¡ç»§ç»­
â”‚
â”œâ”€ æ¸…ç†æµç¨‹
â”‚
â”œâ”€> å…³é—­è´¦æˆ·/å…³é—­Worker
â”‚   â””â”€> cleanup(accountId)
â”‚       â””â”€> accountPages.delete(accountId)
â”‚       â””â”€> é¡µé¢è‡ªåŠ¨å›æ”¶ âœ…
â”‚
â””â”€ ç»“æŸ

```

---

## ğŸ“Š é¡µé¢çŠ¶æ€å›¾

```
                    åˆ›å»º
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                     â”‚
          â”‚    [æœ‰æ•ˆé¡µé¢]       â”‚ â—„â”€â”€â”€â”€ æ­£å¸¸ä½¿ç”¨
          â”‚                     â”‚
          â”‚  isPageAlive()      â”‚
          â”‚  = true             â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                 â”‚
    é¡µé¢å…³é—­é”™è¯¯         è¶…æ—¶/å¼‚å¸¸
            â”‚                 â”‚
            â–¼                 â–¼
          [å·²å…³é—­]     [ä¸å¯ç”¨]
            â”‚           â”‚
            â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
        [è‡ªåŠ¨æ¢å¤]
              â”‚
         æ¸…ç†æ—§é¡µé¢
         åˆ›å»ºæ–°é¡µé¢
         ä¿å­˜åˆ°æ± ä¸­
              â”‚
              â–¼
        [æœ‰æ•ˆé¡µé¢]
              â”‚
         ç»§ç»­ä½¿ç”¨ âœ…


```

---

## ğŸ”€ è°ƒç”¨æµå…³ç³»

```
ç™»å½•è·¯å¾„:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
DouyinPlatform.startLogin()
  â”‚
  â””â”€> this.getAccountPage(accountId)
      â”‚
      â””â”€> PlatformBase.getAccountPage()
          â”‚
          â””â”€> browserManager.getAccountPage()
              â”‚
              â””â”€> accountPages.set(accountId, page)

ç»“æœ: é¡µé¢è‡ªåŠ¨ä¿å­˜åˆ°æ± ä¸­ âœ…


çˆ¬è™«è·¯å¾„:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MonitorTask.run()
  â”‚
  â””â”€> DouyinPlatform.crawlComments()
      â”‚
      â””â”€> this.getOrCreatePage(accountId)
          â”‚
          â””â”€> super.getAccountPage(accountId)
              â”‚
              â””â”€> PlatformBase.getAccountPage()
                  â”‚
                  â””â”€> browserManager.getAccountPage()
                      â”‚
                      â”œâ”€> accountPages.has(accountId)?
                      â”‚   â”œâ”€ YES â†’ è¿”å›å·²æœ‰é¡µé¢ âœ…
                      â”‚   â””â”€ NO  â†’ åˆ›å»ºæ–°é¡µé¢

ç»“æœ: å¤ç”¨ç™»å½•æ—¶çš„é¡µé¢ï¼ŒåŒ…å«æ‰€æœ‰æƒé™ âœ…

```

---

## ğŸ’¾ å†…å­˜æ¨¡å‹

```
ç™»å½•å‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BrowserManager    â”‚
â”‚                     â”‚
â”‚ accountPages = {}   â”‚ (ç©º)
â”‚ stats = {}          â”‚ (ç©º)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç™»å½•æˆåŠŸå:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          BrowserManager                      â”‚
â”‚                                              â”‚
â”‚ accountPages = {                             â”‚
â”‚   "acc-123": Page {                          â”‚
â”‚     context: Context,                        â”‚
â”‚     _closed: false,                          â”‚
â”‚     url: "https://creator.douyin.com/"       â”‚
â”‚   }                                          â”‚
â”‚ }                                            â”‚
â”‚                                              â”‚
â”‚ pageUsageStats = {                           â”‚
â”‚   "acc-123": {                               â”‚
â”‚     usageCount: 1,                           â”‚
â”‚     createdAt: 1634567890000,               â”‚
â”‚     lastUsedAt: 1634567890000               â”‚
â”‚   }                                          â”‚
â”‚ }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†‘
  â””â”€ å ç”¨: ~200MB (ä¸€ä¸ªé¡µé¢)

çˆ¬è™«å¤ç”¨ 5 æ¬¡å:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          BrowserManager                      â”‚
â”‚                                              â”‚
â”‚ accountPages = {                             â”‚
â”‚   "acc-123": Page { åŒä¸€ä¸ªé¡µé¢ }             â”‚
â”‚ }                                            â”‚
â”‚                                              â”‚
â”‚ pageUsageStats = {                           â”‚
â”‚   "acc-123": {                               â”‚
â”‚     usageCount: 6,           â—„â”€â”€â”€ å¢åŠ       â”‚
â”‚     createdAt: 1634567890000,               â”‚
â”‚     lastUsedAt: 1634567899999 â—„â”€â”€â”€ æ›´æ–°    â”‚
â”‚   }                                          â”‚
â”‚ }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†‘
  â””â”€ å ç”¨: ~200MB (ä»ç„¶æ˜¯åŒä¸€ä¸ªé¡µé¢!)

æ—§æ–¹æ¡ˆå¯¹æ¯”:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          åˆ†æ•£çš„é¡µé¢ç®¡ç†                      â”‚
â”‚                                              â”‚
â”‚ PlatformBase.currentPage = Page { ... }     â”‚
â”‚                                              â”‚
â”‚ DouyinPlatform.currentPage = Page { ... }   â”‚
â”‚                                              â”‚
â”‚ å…¶ä»–å¹³å°çš„ currentPage = Page { ... }        â”‚
â”‚ ...                                          â”‚
â”‚                                              â”‚
â”‚ = å¤šä¸ªç‹¬ç«‹çš„é¡µé¢å¯¹è±¡                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†‘
  â””â”€ å ç”¨: ~600MB (3ä¸ªæˆ–æ›´å¤šé¡µé¢)

å†…å­˜èŠ‚çœ: 600MB â†’ 200MB = -66% â¬‡ï¸

```

---

## ğŸ”„ å…³é”®æ•°æ®æµ

```
[ç™»å½•]
user
  â†“
admin-web
  â†“
master:login:start (Socket)
  â†“
worker (master:login:start)
  â†“
DouyinPlatform.startLogin()
  â†“
getAccountPage(accountId) â—„â”€â”€â”€ å…³é”®: ä¿å­˜é¡µé¢åˆ°æ± ä¸­
  â”‚
  â”œâ”€ BrowserManager.getAccountPage()
  â”‚  â”œâ”€ åˆ›å»º page
  â”‚  â”œâ”€ accountPages[accountId] = page  âœ… ä¿å­˜
  â”‚  â””â”€ recordPageUsage()
  â”‚
  â”œâ”€ å¯¼èˆªåˆ°ç™»å½•é¡µ
  â”œâ”€ æ‰«ç æˆåŠŸ
  â””â”€ è¿”å›æˆåŠŸ
    â†“
worker:login:success (Socket)
  â†“
master
  â†“
admin-web


[çˆ¬è™«]
MonitorTask
  â†“
DouyinPlatform.crawlComments()
  â†“
getOrCreatePage(accountId)
  â”‚
  â””â”€ BrowserManager.getAccountPage()
     â”œâ”€ accountPages[accountId] å­˜åœ¨? âœ… YES
     â”œâ”€ isPageAlive(page)? âœ… YES
     â”œâ”€ recordPageUsage()
     â””â”€ è¿”å›ç›¸åŒçš„é¡µé¢  â—„â”€â”€â”€ å…³é”®: å¤ç”¨ç™»å½•æ—¶çš„é¡µé¢
       â†“
       â”œâ”€ é¡µé¢åŒ…å«ç™»å½•æ—¶çš„:
       â”‚  â”œâ”€ Cookies âœ…
       â”‚  â”œâ”€ æƒé™ âœ…
       â”‚  â””â”€ ç”¨æˆ·çŠ¶æ€ âœ…
       â”‚
       â”œâ”€ å¯¼èˆªåˆ°è¯„è®ºé¡µé¢
       â”œâ”€ çˆ¬è™«æ•°æ®
       â””â”€ è¿”å›ç»“æœ
         â†“
worker:comments_data (Socket)
  â†“
master
  â†“
admin-web

```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

```
åœºæ™¯: 1ä¸ªè´¦æˆ· â†’ ç™»å½• + çˆ¬è™«(è¯„è®º) + çˆ¬è™«(ç§ä¿¡) + çˆ¬è™«(è¯„è®º) + çˆ¬è™«(ç§ä¿¡)

æ—§æ¶æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œ            â”‚ é¡µé¢  â”‚ æ€»å ç”¨    â”‚ è€—æ—¶ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç™»å½•            â”‚ åˆ›å»º1 â”‚ 200MB     â”‚ 5s   â”‚
â”‚ çˆ¬è™«(è¯„è®º)      â”‚ åˆ›å»º1 â”‚ 400MB     â”‚ 5s   â”‚
â”‚ çˆ¬è™«(ç§ä¿¡)      â”‚ åˆ›å»º1 â”‚ 600MB     â”‚ 5s   â”‚
â”‚ çˆ¬è™«(è¯„è®º)      â”‚ åˆ›å»º1 â”‚ 800MB     â”‚ 5s   â”‚
â”‚ çˆ¬è™«(ç§ä¿¡)      â”‚ åˆ›å»º1 â”‚ 1000MB    â”‚ 5s   â”‚
â”‚ æ€»è®¡            â”‚ 5ä¸ª   â”‚ 1000MB    â”‚ 25s  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–°æ¶æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œ            â”‚ é¡µé¢  â”‚ æ€»å ç”¨    â”‚ è€—æ—¶ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç™»å½•            â”‚ åˆ›å»º1 â”‚ 200MB     â”‚ 5s   â”‚
â”‚ çˆ¬è™«(è¯„è®º)      â”‚ å¤ç”¨  â”‚ 200MB     â”‚ <1s  â”‚â—„â”€ å¿«50å€!
â”‚ çˆ¬è™«(ç§ä¿¡)      â”‚ å¤ç”¨  â”‚ 200MB     â”‚ <1s  â”‚â—„â”€ å¿«50å€!
â”‚ çˆ¬è™«(è¯„è®º)      â”‚ å¤ç”¨  â”‚ 200MB     â”‚ <1s  â”‚â—„â”€ å¿«50å€!
â”‚ çˆ¬è™«(ç§ä¿¡)      â”‚ å¤ç”¨  â”‚ 200MB     â”‚ <1s  â”‚â—„â”€ å¿«50å€!
â”‚ æ€»è®¡            â”‚ 1ä¸ª   â”‚ 200MB     â”‚ ~10s â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ”¹è¿›:
â€¢ é¡µé¢æ•°: 5 â†’ 1 (-80%)
â€¢ å†…å­˜: 1000MB â†’ 200MB (-80%)
â€¢ æ—¶é—´: 25s â†’ 10s (-60%)
â€¢ çˆ¬è™«é€Ÿåº¦: 50å€æå‡ â¬†ï¸

```

---

**ç‰ˆæœ¬**: 2025-10-20
**çŠ¶æ€**: Phase 11 å®Œæˆ âœ…

