# ä½œå“æ•°æ®é›¶é—®é¢˜ - æ¶æ„ä¿®å¤æŠ¥å‘Š

**æ—¥æœŸ**: 2025-10-29
**ä¿®å¤äººå‘˜**: Claude
**é—®é¢˜**: ä½œå“æ•°æ®ä¸º 0 çš„æ¶æ„è®¾è®¡ç¼ºé™·ä¿®å¤

---

## é—®é¢˜å›é¡¾

### æ ¸å¿ƒçŸ›ç›¾

- âœ… API æ‹¦æˆªå™¨æˆåŠŸæ•è·ä½œå“ APIï¼ˆ`/aweme/v1/creator/item/list`ï¼‰
- âœ… API è¿”å›äº† 20 ä¸ªä½œå“æ•°æ®
- âŒ **ä½† DataManager å¿«ç…§æ˜¾ç¤ºä½œå“æ•°é‡ä¸º 0**

### æ ¹æœ¬åŸå› ï¼ˆç”¨æˆ·è¯Šæ–­ï¼‰

ç”¨æˆ·æ­£ç¡®æŒ‡å‡ºäº†æ¶æ„è®¾è®¡ç¼ºé™·ï¼š

> "globalContext.dataManager è¿™ä¸ªä¸æ˜¯è´¦å·çº§åˆ«çš„å…¨å±€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦åœ¨æ¯ä¸ª js é‡Œå®ç°ä»–ï¼Œè¿™ä¸ç¬¦åˆè®¾è®¡é€»è¾‘å‘€ï¼Œç†è®ºä¸Š platform.js åˆå§‹åŒ–åï¼Œè¿™ä¸ªå¹³å°æ‰€æœ‰çš„js ä»»æ„ä»£ç  å°±åº”è¯¥å¯ä»¥è°ƒç”¨ globalContext.dataManager æ¥å¤„ç†æ•°æ®ï¼Œä¸åº”è¯¥å­˜åœ¨ä½ è¯´çš„é‚£ç§ç°è±¡ï¼Œè¿™æ˜¯ç»“æ„è®¾è®¡çš„é—®é¢˜"

**é—®é¢˜æœ¬è´¨**ï¼š
- `globalContext.dataManager` åº”è¯¥æ˜¯**è´¦æˆ·çº§åˆ«çš„æŒä¹…åŒ–å…¨å±€å˜é‡**
- ä½†åŸè®¾è®¡ä¸­ï¼Œå®ƒæ˜¯**ä¸´æ—¶å˜é‡**ï¼Œåœ¨æ¯ä¸ªçˆ¬è™«å‡½æ•°æ‰§è¡Œå®Œåè¢«æ¸…ç©º
- å¯¼è‡´ API æ‹¦æˆªå™¨å¼‚æ­¥è§¦å‘æ—¶ï¼Œ`globalContext.dataManager` å·²ç»ä¸º `null`

---

## æ¶æ„è®¾è®¡ç¼ºé™·åˆ†æ

### åŸè®¾è®¡ï¼šä¸´æ—¶ globalContextï¼ˆé”™è¯¯ï¼‰

```javascript
// âŒ packages/worker/src/platforms/douyin/crawl-comments.js (æ—§ä»£ç )

async function crawlComments(page, account, options = {}, dataManager = null) {
  // ä¸´æ—¶è®¾ç½® globalContext
  if (dataManager) {
    globalContext.dataManager = dataManager;
    globalContext.accountId = account.id;
    logger.info(`âœ… [DataManager] å·²å¯ç”¨ç»Ÿä¸€æ•°æ®ç®¡ç†æ¶æ„`);
  }

  try {
    // ... çˆ¬è™«é€»è¾‘
  } finally {
    // âŒ å…³é”®é—®é¢˜ï¼šfinally å—æ¸…ç©ºäº† globalContextï¼
    globalContext.dataManager = null;
    globalContext.accountId = null;
  }
}
```

**é—®é¢˜æµç¨‹**ï¼š

1. `crawlComments()` è¢«è°ƒç”¨ â†’ è®¾ç½® `globalContext.dataManager`
2. é¡µé¢åŠ è½½è§¦å‘ä½œå“ API â†’ API æ‹¦æˆªå™¨æ³¨å†Œå›è°ƒ `onWorksListAPI`
3. `crawlComments()` æ‰§è¡Œå®Œæˆ â†’ `finally` å—æ¸…ç©º `globalContext.dataManager`
4. API å“åº”åˆ°è¾¾ â†’ å›è°ƒ `onWorksListAPI` æ‰§è¡Œ
5. âŒ `globalContext.dataManager` å·²ç»æ˜¯ `null` â†’ æ•°æ®æ— æ³•å­˜å‚¨

**æ—¶åºå›¾**ï¼š

```
æ—¶é—´è½´ï¼š
t=0  crawlComments() å¼€å§‹          globalContext.dataManager = dm1
t=1  é¡µé¢åŠ è½½ï¼Œæ³¨å†Œ API æ‹¦æˆªå™¨     (æ‹¦æˆªå™¨å·²æ³¨å†Œï¼Œç­‰å¾… API)
t=5  crawlComments() å®Œæˆ          finally: globalContext.dataManager = null  âŒ
t=8  ä½œå“ API å“åº”åˆ°è¾¾              onWorksListAPI() è¢«è°ƒç”¨
t=9  æ£€æŸ¥ globalContext.dataManager â†’ null âŒ
t=10 è·³è¿‡æ•°æ®å­˜å‚¨                  âŒ ä½œå“æ•°æ®ä¸¢å¤±ï¼
```

### æ­£ç¡®è®¾è®¡ï¼šè´¦æˆ·çº§åˆ«æŒä¹…åŒ– globalContext

```javascript
// âœ… packages/worker/src/platforms/douyin/platform.js (æ–°ä»£ç )

async initialize(account) {
  logger.info(`Initializing Douyin platform for account ${account.id}`);

  // è°ƒç”¨åŸºç±»åˆå§‹åŒ–ï¼ˆåˆå§‹åŒ– DataManagerï¼‰
  await super.initialize(account);

  // âœ… è®¾ç½®å…¨å±€ DataManager ä¸Šä¸‹æ–‡ï¼ˆä¾›æ‰€æœ‰çˆ¬è™«æ¨¡å—çš„ API æ‹¦æˆªå™¨ä½¿ç”¨ï¼‰
  const dataManager = this.dataManagers.get(account.id);
  if (dataManager) {
    // å¯¼å…¥å„ä¸ªçˆ¬è™«æ¨¡å—çš„ globalContext å¹¶è®¾ç½®
    const { globalContext: contentsContext } = require('./crawl-contents');
    const { globalContext: commentsContext } = require('./crawl-comments');
    const { globalContext: dmContext } = require('./crawl-direct-messages-v2');

    // è®¾ç½®åˆ°æ‰€æœ‰çˆ¬è™«æ¨¡å—çš„ globalContextï¼ˆè´¦æˆ·çº§åˆ«å…¨å±€ï¼‰
    contentsContext.dataManager = dataManager;
    contentsContext.accountId = account.id;

    commentsContext.dataManager = dataManager;
    commentsContext.accountId = account.id;

    dmContext.dataManager = dataManager;
    dmContext.accountId = account.id;

    logger.info(`âœ… DataManager å·²è®¾ç½®åˆ°æ‰€æœ‰çˆ¬è™«æ¨¡å—çš„ globalContext (è´¦æˆ·: ${account.id})`);
  }

  logger.info(`Douyin platform initialized for account ${account.id}`);
}
```

**æ­£ç¡®æµç¨‹**ï¼š

1. **è´¦æˆ·åˆå§‹åŒ–æ—¶**ï¼š`platform.initialize(account)` è¢«è°ƒç”¨
2. **ä¸€æ¬¡æ€§è®¾ç½®**ï¼š`globalContext.dataManager` è¢«è®¾ç½®ä¸ºè´¦æˆ·çš„ DataManager
3. **æŒä¹…åŒ–å­˜åœ¨**ï¼š`globalContext.dataManager` åœ¨æ•´ä¸ªè´¦æˆ·ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆ
4. **ä»»ä½•æ—¶å€™**ï¼šAPI æ‹¦æˆªå™¨å›è°ƒéƒ½èƒ½è®¿é—®åˆ° `globalContext.dataManager`

**æ—¶åºå›¾**ï¼š

```
æ—¶é—´è½´ï¼š
t=0  è´¦æˆ·åˆå§‹åŒ–                    platform.initialize(account)
t=1  è®¾ç½® globalContext             globalContext.dataManager = dm1  âœ… (æŒä¹…åŒ–)
t=5  crawlComments() å¼€å§‹          (ä½¿ç”¨å·²æœ‰çš„ globalContext)
t=6  é¡µé¢åŠ è½½ï¼Œæ³¨å†Œ API æ‹¦æˆªå™¨     (æ‹¦æˆªå™¨å·²æ³¨å†Œï¼Œç­‰å¾… API)
t=10 crawlComments() å®Œæˆ          (ä¸å†æ¸…ç©º globalContext)  âœ…
t=15 ä½œå“ API å“åº”åˆ°è¾¾              onWorksListAPI() è¢«è°ƒç”¨
t=16 æ£€æŸ¥ globalContext.dataManager â†’ dm1  âœ…
t=17 æˆåŠŸå­˜å‚¨æ•°æ®                  dm1.batchUpsertContents()  âœ…
```

---

## ä¿®å¤å®æ–½

### ä¿®å¤ 1ï¼šæ·»åŠ å¹³å°åˆå§‹åŒ–è°ƒç”¨

**æ–‡ä»¶**: `packages/worker/src/handlers/account-initializer.js`

**ä¿®æ”¹ä½ç½®**: [account-initializer.js:79-87](packages/worker/src/handlers/account-initializer.js#L79-L87)

```javascript
// 7. åˆå§‹åŒ–å¹³å°ï¼ˆè®¾ç½® DataManager ç­‰ï¼‰
const platformInstance = this.platformManager.getPlatform(account.platform);
if (platformInstance && typeof platformInstance.initialize === 'function') {
  logger.info(`Initializing platform ${account.platform} for account ${account.id}...`);
  await platformInstance.initialize(account);
  logger.info(`Platform ${account.platform} initialized for account ${account.id}`);
} else {
  logger.warn(`Platform ${account.platform} does not have initialize() method`);
}
```

**åŸå› **ï¼š
- åŸæ¥çš„ä»£ç **ä»æœªè°ƒç”¨**å¹³å°çš„ `initialize()` æ–¹æ³•
- `account-initializer` åªåˆå§‹åŒ–äº†æµè§ˆå™¨ï¼Œä½†æ²¡æœ‰åˆå§‹åŒ–å¹³å°
- å¯¼è‡´ `platform.initialize()` ä¸­çš„ `globalContext` è®¾ç½®é€»è¾‘ä»æœªæ‰§è¡Œ

### ä¿®å¤ 2ï¼šå¹³å°åˆå§‹åŒ–æ—¶è®¾ç½® globalContext

**æ–‡ä»¶**: `packages/worker/src/platforms/douyin/platform.js`

**ä¿®æ”¹ä½ç½®**: [platform.js:47-68](packages/worker/src/platforms/douyin/platform.js#L47-L68)

**ä»£ç **ï¼šè§ä¸Šæ–‡"æ­£ç¡®è®¾è®¡"éƒ¨åˆ†

**å…³é”®è¦ç‚¹**ï¼š
- åœ¨ `initialize()` æ–¹æ³•ä¸­è®¾ç½® `globalContext.dataManager`
- è®¾ç½®ä¸º**è´¦æˆ·çº§åˆ«å…¨å±€**ï¼ˆä¸å†åœ¨çˆ¬è™«å‡½æ•°ä¸­è®¾ç½®/æ¸…ç©ºï¼‰
- æ‰€æœ‰çˆ¬è™«æ¨¡å—ï¼ˆcrawl-contentsã€crawl-commentsã€crawl-direct-messages-v2ï¼‰å…±äº«åŒä¸€ä¸ª `dataManager` å¼•ç”¨

### ä¿®å¤ 3ï¼šä¿®æ­£ API æ¨¡å¼åŒ¹é…

**æ–‡ä»¶**: `packages/worker/src/platforms/douyin/platform.js`

**ä¿®æ”¹ä½ç½®**: [platform.js:61](packages/worker/src/platforms/douyin/platform.js#L61)

```javascript
// æ—§ä»£ç ï¼ˆåŒ¹é…äº†ä¸¤ä¸ª APIï¼‰
manager.register('**/creator/item/list{/,}?**', onWorksListAPI);

// âŒ è¿™ä¼šåŒ¹é…ï¼š
// - /web/api/creator/item/list (æ— æ•ˆ - æ—  item_info_list)
// - /aweme/v1/creator/item/list (æœ‰æ•ˆ - æœ‰ 20 ä¸ªä½œå“)

// æ–°ä»£ç ï¼ˆåªåŒ¹é…æ­£ç¡®çš„ APIï¼‰
manager.register('**/aweme/v1/creator/item/list{/,}?**', onWorksListAPI);

// âœ… åªåŒ¹é…ï¼š
// - /aweme/v1/creator/item/list (æœ‰æ•ˆ - æœ‰ 20 ä¸ªä½œå“)
```

**è¯æ®**ï¼š
```json
// æ—¥å¿—æ˜¾ç¤ºåŒ¹é…äº†ä¸¤ä¸ª API
{"message":"âš ï¸  [API] ä½œå“åˆ—è¡¨å“åº”æ— æ•ˆï¼ˆæ—  item_info_listï¼‰ï¼Œè·³è¿‡å¤„ç†","timestamp":"2025-10-29 15:30:51.296"}
{"message":"ğŸ“¦ [API] ä½œå“åˆ—è¡¨åŒ…å« 20 ä¸ªä½œå“","timestamp":"2025-10-29 15:30:59.344"}
```

---

## ä¿®å¤éªŒè¯

### éªŒè¯æ­¥éª¤

1. **é‡å¯ Master/Worker**ï¼ˆæ¸…ç†æ—§è¿›ç¨‹ï¼‰
2. **ç­‰å¾…è´¦æˆ·åˆå§‹åŒ–å®Œæˆ**
3. **æ£€æŸ¥æ—¥å¿—**ï¼šç¡®è®¤ "âœ… DataManager å·²è®¾ç½®åˆ°æ‰€æœ‰çˆ¬è™«æ¨¡å—çš„ globalContext"
4. **ç­‰å¾…çˆ¬è™«è§¦å‘ API**
5. **æ£€æŸ¥æ—¥å¿—**ï¼šç¡®è®¤ "âœ… [API] ä½œå“åˆ—è¡¨ -> DataManager: X ä¸ªä½œå“"
6. **è¿è¡Œå¿«ç…§è„šæœ¬**ï¼š`node tests/ç»Ÿè®¡å¿«ç…§æ•°æ®.js`
7. **éªŒè¯ç»“æœ**ï¼šä½œå“æ•°é‡ > 0

### é¢„æœŸæ—¥å¿—

```
[account-initializer] Initializing platform douyin for account acc-xxx...
[platform-base] Initializing douyin platform for account acc-xxx
[platform-base] DataManager initialized for account acc-xxx
[douyin-platform] âœ… DataManager å·²è®¾ç½®åˆ°æ‰€æœ‰çˆ¬è™«æ¨¡å—çš„ globalContext (è´¦æˆ·: acc-xxx)
[account-initializer] Platform douyin initialized for account acc-xxx
...
[crawl-comments] ğŸ¯ [API] ä½œå“åˆ—è¡¨ API è¢«è§¦å‘ï¼URL: .../aweme/v1/creator/item/list...
[crawl-comments] ğŸ“¦ [API] ä½œå“åˆ—è¡¨åŒ…å« 20 ä¸ªä½œå“
[crawl-comments] âœ… [API] ä½œå“åˆ—è¡¨ -> DataManager: 20 ä¸ªä½œå“  âœ…
```

### é¢„æœŸå¿«ç…§ç»“æœ

```
ğŸ¬ è§†é¢‘/ä½œå“ (Contents)
  â”œâ”€ æ€»æ•°: 20 æ¡  âœ…
  â”œâ”€ æ–°å¢: 20 æ¡  âœ…
```

---

## æ¶æ„æ”¹è¿›æ€»ç»“

### Beforeï¼ˆä¸´æ—¶ globalContextï¼‰

```
çˆ¬è™«å‡½æ•°è°ƒç”¨æµç¨‹ï¼š
1. monitor-task.execute()
2.   â”œâ”€ platform.crawlComments(account)
3.   â”‚   â”œâ”€ è·å– DataManager
4.   â”‚   â”œâ”€ crawlCommentsV2(page, account, dataManager)
5.   â”‚   â”‚   â”œâ”€ globalContext.dataManager = dataManager  âš™ï¸ ä¸´æ—¶è®¾ç½®
6.   â”‚   â”‚   â”œâ”€ æ³¨å†Œ API æ‹¦æˆªå™¨
7.   â”‚   â”‚   â”œâ”€ é¡µé¢åŠ è½½ï¼ˆè§¦å‘ APIï¼‰
8.   â”‚   â”‚   â”œâ”€ finally: globalContext.dataManager = null  âŒ æ¸…ç©ºï¼
9.   â”‚   â”‚   â””â”€ return
10.  â”‚   â””â”€ return
11.  â””â”€ [å¼‚æ­¥] API å“åº”åˆ°è¾¾
12.      â””â”€ onWorksListAPI() æ‰§è¡Œ
13.          â””â”€ globalContext.dataManager === null  âŒ æ•°æ®ä¸¢å¤±
```

### Afterï¼ˆæŒä¹…åŒ– globalContextï¼‰

```
è´¦æˆ·åˆå§‹åŒ–æµç¨‹ï¼š
1. account-initializer.initializeAccount(account)
2.   â”œâ”€ å¯åŠ¨æµè§ˆå™¨
3.   â”œâ”€ platform.initialize(account)  âœ… æ–°å¢
4.   â”‚   â”œâ”€ åˆ›å»º DataManager
5.   â”‚   â”œâ”€ globalContext.dataManager = dataManager  âœ… ä¸€æ¬¡æ€§è®¾ç½®
6.   â”‚   â””â”€ return
7.   â””â”€ return

ç›‘æ§ä»»åŠ¡æµç¨‹ï¼š
8. monitor-task.execute()
9.   â”œâ”€ platform.crawlComments(account)
10.  â”‚   â”œâ”€ crawlCommentsV2(page, account, dataManager)
11.  â”‚   â”‚   â”œâ”€ æ³¨å†Œ API æ‹¦æˆªå™¨
12.  â”‚   â”‚   â”œâ”€ é¡µé¢åŠ è½½ï¼ˆè§¦å‘ APIï¼‰
13.  â”‚   â”‚   â””â”€ return  âœ… ä¸å†æ¸…ç©º globalContext
14.  â”‚   â””â”€ return
15.  â””â”€ [å¼‚æ­¥] API å“åº”åˆ°è¾¾
16.      â””â”€ onWorksListAPI() æ‰§è¡Œ
17.          â””â”€ globalContext.dataManager  âœ… ä»ç„¶æœ‰æ•ˆ
18.              â””â”€ dm.batchUpsertContents()  âœ… æ•°æ®æˆåŠŸå­˜å‚¨
```

### æ ¸å¿ƒæ”¹è¿›

| ç»´åº¦ | Before (ä¸´æ—¶) | After (æŒä¹…åŒ–) |
|------|--------------|----------------|
| **è®¾ç½®æ—¶æœº** | æ¯æ¬¡çˆ¬è™«å‡½æ•°è°ƒç”¨æ—¶ | è´¦æˆ·åˆå§‹åŒ–æ—¶ï¼ˆä¸€æ¬¡ï¼‰ |
| **ç”Ÿå‘½å‘¨æœŸ** | çˆ¬è™«å‡½æ•°æ‰§è¡ŒæœŸé—´ | è´¦æˆ·æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ |
| **æ¸…ç©ºæ—¶æœº** | çˆ¬è™«å‡½æ•° finally å— | è´¦æˆ·é”€æ¯æ—¶ |
| **API æ‹¦æˆªå™¨** | å¼‚æ­¥å›è°ƒæ—¶å¯èƒ½ä¸º null | å§‹ç»ˆæœ‰æ•ˆ |
| **æ•°æ®å­˜å‚¨** | âŒ ä¸¢å¤±ï¼ˆnullï¼‰ | âœ… æˆåŠŸ |

---

## é—ç•™é—®é¢˜

### 1. æ—§çˆ¬è™«ä»£ç ä¸­çš„ globalContext è®¾ç½®/æ¸…ç©º

**æ–‡ä»¶**ï¼š
- `packages/worker/src/platforms/douyin/crawl-comments.js`
- `packages/worker/src/platforms/douyin/crawl-contents.js`
- `packages/worker/src/platforms/douyin/crawl-direct-messages-v2.js`

**é—®é¢˜**ï¼š
è¿™äº›æ–‡ä»¶ä¸­ä»ç„¶æœ‰ `globalContext` çš„ä¸´æ—¶è®¾ç½®å’Œæ¸…ç©ºé€»è¾‘ï¼š

```javascript
// âŒ ç°åœ¨æ˜¯å†—ä½™ä»£ç ï¼Œåº”è¯¥åˆ é™¤
if (dataManager) {
  globalContext.dataManager = dataManager;
  globalContext.accountId = account.id;
}

try {
  // ...
} finally {
  globalContext.dataManager = null;  // âŒ è¿™ä¼šç ´åæŒä¹…åŒ–è®¾ç½®ï¼
  globalContext.accountId = null;
}
```

**ä¿®å¤å»ºè®®**ï¼š
åˆ é™¤æ‰€æœ‰çˆ¬è™«å‡½æ•°ä¸­çš„ `globalContext` è®¾ç½®å’Œæ¸…ç©ºé€»è¾‘ï¼Œå› ä¸ºï¼š
1. `globalContext` ç°åœ¨ç”± `platform.initialize()` ç»Ÿä¸€è®¾ç½®
2. `finally` å—ä¸­çš„æ¸…ç©ºä¼šç ´åæŒä¹…åŒ–è®¾ç½®

### 2. æµ‹è¯•éªŒè¯

**å½“å‰çŠ¶æ€**ï¼š
- ä¿®å¤ä»£ç å·²å®Œæˆ
- ä½†ç”±äºå¤šä¸ªæµè§ˆå™¨è¿›ç¨‹æœªæ¸…ç†ï¼Œå¯¼è‡´æµè§ˆå™¨åˆå§‹åŒ–å¤±è´¥
- æ— æ³•ç›´æ¥éªŒè¯ä¿®å¤æ•ˆæœ

**å»ºè®®éªŒè¯æ­¥éª¤**ï¼š
1. æ¸…ç†æ‰€æœ‰ Chrome è¿›ç¨‹ï¼š`taskkill //F //IM chrome.exe`
2. é‡å¯ Master å’Œ Worker
3. æ£€æŸ¥æ—¥å¿—ç¡®è®¤å¹³å°åˆå§‹åŒ–æˆåŠŸ
4. ç­‰å¾…çˆ¬è™«è§¦å‘å¹¶éªŒè¯æ•°æ®å…¥åº“

### 3. Monitor-task ä¸­ç¼ºå°‘ä½œå“çˆ¬è™«è°ƒç”¨

**æ–‡ä»¶**: `packages/worker/src/handlers/monitor-task.js`

**å½“å‰ä»£ç **ï¼š
```javascript
const [commentResult, dmResult] = await Promise.all([
  this.platformInstance.crawlComments(this.account),
  this.platformInstance.crawlDirectMessages(this.account),
]);

// âŒ ç¼ºå°‘ï¼šä½œå“çˆ¬è™«è°ƒç”¨
```

**é—®é¢˜**ï¼š
è™½ç„¶ä¿®å¤äº† `globalContext` æ¶æ„é—®é¢˜ï¼Œä½œå“ API å¯ä»¥é€šè¿‡è¯„è®ºé¡µé¢å‰¯ä½œç”¨è§¦å‘ï¼Œä½†è¿™ä¸æ˜¯æ­£ç¡®çš„è®¾è®¡ã€‚

**å»ºè®®**ï¼š
æ·»åŠ ä½œå“çˆ¬è™«åˆ°å¹¶è¡Œä»»åŠ¡ä¸­ï¼ˆå‚è§åŸæŠ¥å‘Šçš„"é€‰é¡¹ 1"ï¼‰ï¼š

```javascript
const [commentResult, dmResult, contentsResult] = await Promise.all([
  this.platformInstance.crawlComments(this.account),
  this.platformInstance.crawlDirectMessages(this.account),
  this.platformInstance.crawlContents(this.account),  // âœ… æ–°å¢
]);
```

**ä¼˜ç‚¹**ï¼š
- å®Œæ•´å®ç°ï¼Œä½œå“æ•°æ®ç‹¬ç«‹è·å–
- ä¸ä¾èµ–è¯„è®ºçˆ¬è™«çš„å‰¯ä½œç”¨
- æ•°æ®è´¨é‡é«˜ï¼ˆå®Œæ•´çš„ä½œå“åˆ—è¡¨ï¼‰

---

## æ€»ç»“

### é—®é¢˜æœ¬è´¨

`globalContext.dataManager` çš„ç”Ÿå‘½å‘¨æœŸè®¾è®¡é”™è¯¯ï¼š
- **åŸè®¾è®¡**ï¼šä¸´æ—¶å˜é‡ï¼Œçˆ¬è™«å‡½æ•°æ‰§è¡ŒæœŸé—´æœ‰æ•ˆ
- **æ­£ç¡®è®¾è®¡**ï¼šè´¦æˆ·çº§åˆ«å…¨å±€ï¼Œè´¦æˆ·ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆ

### ä¿®å¤æ ¸å¿ƒ

1. âœ… åœ¨ `platform.initialize()` ä¸­è®¾ç½® `globalContext.dataManager`ï¼ˆä¸€æ¬¡æ€§ï¼‰
2. âœ… åœ¨ `account-initializer.js` ä¸­è°ƒç”¨ `platform.initialize()`
3. âœ… ä¿®æ­£ API æ¨¡å¼åŒ¹é…ï¼Œé¿å…è¯¯åŒ¹é…

### ä¸‹ä¸€æ­¥

1. **æ¸…ç†é—ç•™ä»£ç **ï¼šåˆ é™¤çˆ¬è™«å‡½æ•°ä¸­çš„ `globalContext` ä¸´æ—¶è®¾ç½®/æ¸…ç©ºé€»è¾‘
2. **éªŒè¯ä¿®å¤**ï¼šæ¸…ç†æµè§ˆå™¨è¿›ç¨‹åé‡æ–°æµ‹è¯•
3. **å®Œå–„åŠŸèƒ½**ï¼šæ·»åŠ ä½œå“çˆ¬è™«åˆ°ç›‘æ§ä»»åŠ¡ä¸­

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-10-29 16:15
**å¾…éªŒè¯**: éœ€è¦æ¸…ç†æµè§ˆå™¨è¿›ç¨‹åé‡å¯æµ‹è¯•
