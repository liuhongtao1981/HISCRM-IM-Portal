# æœ¬åœ°ç«¯æ•°æ®æŠ“å–å®Œæ•´æ€»ç»“

**æ—¥æœŸ**: 2025-10-28
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ä¸€ã€æ€»ä½“çŠ¶æ€

### âœ… æ‰€æœ‰çˆ¬è™«å·²å®Œæˆ DataManager é›†æˆ

| çˆ¬è™« | æ–‡ä»¶ | é›†æˆçŠ¶æ€ |
|------|------|----------|
| **ç§ä¿¡çˆ¬è™«** | `crawl-direct-messages-v2.js` | âœ… å·²é›†æˆ |
| **ä½œå“çˆ¬è™«** | `crawl-contents.js` | âœ… å·²é›†æˆ |
| **è¯„è®ºçˆ¬è™«** | `crawl-comments.js` | âœ… å·²é›†æˆ |

### é›†æˆéªŒè¯

è¿è¡Œæµ‹è¯•è„šæœ¬ `tests/æ£€æŸ¥çˆ¬è™«DataManageré›†æˆçŠ¶æ€.js` çš„ç»“æœï¼š

```
ğŸ“‹ ç§ä¿¡çˆ¬è™«
   âœ… globalContext å®šä¹‰
   âœ… dataManager å‚æ•°
   âœ… DataManager ä½¿ç”¨
   âœ… batchUpsertConversations
   âœ… batchUpsertMessages
   âœ… å·²é›†æˆ

ğŸ“‹ ä½œå“çˆ¬è™«
   âœ… globalContext å®šä¹‰
   âœ… dataManager å‚æ•°
   âœ… DataManager ä½¿ç”¨
   âœ… batchUpsertContents
   âœ… å·²é›†æˆ

ğŸ“‹ è¯„è®ºçˆ¬è™«
   âœ… globalContext å®šä¹‰
   âœ… dataManager å‚æ•°
   âœ… DataManager ä½¿ç”¨
   âœ… batchUpsertComments
   âœ… å·²é›†æˆ
```

---

## äºŒã€æ¶æ„è®¾è®¡

### ç»Ÿä¸€æ•°æ®ç®¡ç†æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Worker æœ¬åœ°ç«¯                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚  çˆ¬è™«å‡½æ•°     â”‚  (crawl-*.js)                    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â”‚
â”‚  â”‚ â€¢ ç§ä¿¡çˆ¬è™«    â”‚  crawlDirectMessagesV2()        â”‚
â”‚  â”‚ â€¢ ä½œå“çˆ¬è™«    â”‚  crawlContents()                â”‚
â”‚  â”‚ â€¢ è¯„è®ºçˆ¬è™«    â”‚  crawlComments()                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚          â”‚                                         â”‚
â”‚          â”‚ API æ‹¦æˆª                                 â”‚
â”‚          â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  API å›è°ƒï¼ˆå…¨å±€æ³¨å†Œï¼‰         â”‚                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚  â”‚ onConversationListAPI()      â”‚                 â”‚
â”‚  â”‚ onMessageHistoryAPI()        â”‚                 â”‚
â”‚  â”‚ onWorksListAPI()             â”‚                 â”‚
â”‚  â”‚ onCommentsListAPI()          â”‚                 â”‚
â”‚  â”‚ onDiscussionsListAPI()       â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚          â”‚                                         â”‚
â”‚          â”‚ ä½¿ç”¨ globalContext.dataManager          â”‚
â”‚          â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   DouyinDataManager          â”‚                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚  â”‚ â€¢ batchUpsertConversations() â”‚                 â”‚
â”‚  â”‚ â€¢ batchUpsertMessages()      â”‚                 â”‚
â”‚  â”‚ â€¢ batchUpsertContents()      â”‚                 â”‚
â”‚  â”‚ â€¢ batchUpsertComments()      â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚          â”‚                                         â”‚
â”‚          â”‚ ç»§æ‰¿è‡ª                                   â”‚
â”‚          â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   AccountDataManager         â”‚                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚  â”‚ â€¢ æ•°æ®é›†åˆç®¡ç†                 â”‚                 â”‚
â”‚  â”‚ â€¢ çŠ¶æ€è·Ÿè¸ª (NEW/UPDATED)      â”‚                 â”‚
â”‚  â”‚ â€¢ è‡ªåŠ¨åŒæ­¥ (5ç§’å®šæ—¶å™¨)         â”‚                 â”‚
â”‚  â”‚ â€¢ ç»Ÿè®¡ä¿¡æ¯                    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚          â”‚                                         â”‚
â”‚          â”‚ ä½¿ç”¨                                     â”‚
â”‚          â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚      DataPusher              â”‚                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚  â”‚ â€¢ pushConversations()        â”‚                 â”‚
â”‚  â”‚ â€¢ pushMessages()             â”‚                 â”‚
â”‚  â”‚ â€¢ pushContents()             â”‚                 â”‚
â”‚  â”‚ â€¢ pushComments()             â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚          â”‚                                         â”‚
â”‚          â”‚ Socket.IO æ¶ˆæ¯                           â”‚
â”‚          â†“                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ WORKER_CONVERSATIONS_UPDATE
           â”‚ WORKER_MESSAGES_UPDATE
           â”‚ WORKER_CONTENTS_UPDATE
           â”‚ WORKER_COMMENTS_UPDATE
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Master æœåŠ¡å™¨                         â”‚
â”‚  ï¼ˆæš‚æœªå®ç°æ¶ˆæ¯å¤„ç†å™¨ï¼‰                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€å…³é”®æŠ€æœ¯å®ç°

### 1. globalContext æ¨¡å¼

**é—®é¢˜**ï¼šAPI å›è°ƒå‡½æ•°æ˜¯å…¨å±€æ³¨å†Œçš„ï¼Œä½†éœ€è¦è®¿é—®ç‰¹å®šè´¦æˆ·çš„ DataManagerã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ globalContext å¯¹è±¡åœ¨çˆ¬è™«å‡½æ•°å’Œ API å›è°ƒä¹‹é—´å…±äº«çŠ¶æ€ã€‚

```javascript
// æ¯ä¸ªçˆ¬è™«æ–‡ä»¶éƒ½æœ‰
const globalContext = {
  dataManager: null,
  accountId: null,
};

// çˆ¬è™«å‡½æ•°å¼€å§‹æ—¶è®¾ç½®
async function crawlXxx(page, account, options = {}, dataManager = null) {
  if (dataManager) {
    globalContext.dataManager = dataManager;
    globalContext.accountId = account.id;
  }

  try {
    // ... çˆ¬è™«é€»è¾‘ ...
  } finally {
    // æ¸…ç†
    globalContext.dataManager = null;
    globalContext.accountId = null;
  }
}

// API å›è°ƒä¸­ä½¿ç”¨
async function onXxxAPI(body, route) {
  if (globalContext.dataManager && body.data.length > 0) {
    const items = globalContext.dataManager.batchUpsertXxx(
      body.data,
      DataSource.API
    );
    logger.info(`âœ… [API] æ•°æ® -> DataManager: ${items.length} æ¡`);
  }

  // ä¿ç•™æ—§é€»è¾‘ï¼ˆå‘åå…¼å®¹ï¼‰
  apiData.xxx.push(body);
}
```

### 2. æ‡’åŠ è½½æ¨¡å¼

**æ ¸å¿ƒæ”¹è¿›**ï¼šDataManager ä¸åœ¨å¯åŠ¨æ—¶åˆ›å»ºï¼Œè€Œæ˜¯åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶è‡ªåŠ¨åˆ›å»ºã€‚

```javascript
// platform.js ä¸­è°ƒç”¨çˆ¬è™«
async crawlDirectMessages(account) {
  // æ‡’åŠ è½½ï¼šé¦–æ¬¡è°ƒç”¨è‡ªåŠ¨åˆ›å»º DataManager
  const dataManager = await this.getDataManager(account.id);

  // ä¼ é€’ç»™çˆ¬è™«
  const crawlResult = await crawlDirectMessagesV2(page, account, dataManager);
}

// PlatformBase.getDataManager() è‡ªåŠ¨åˆ›å»º
async getDataManager(accountId) {
  if (this.dataManagers.has(accountId)) {
    return this.dataManagers.get(accountId);
  }

  // è‡ªåŠ¨åˆ›å»º
  await this.initializeDataManager(accountId);
  return this.dataManagers.get(accountId);
}
```

### 3. å‘åå…¼å®¹

æ‰€æœ‰çˆ¬è™«éƒ½ä¿ç•™äº†æ—§çš„æ•°æ®æ”¶é›†é€»è¾‘ï¼š

```javascript
// âœ… æ–°æ¶æ„ï¼ˆDataManagerï¼‰
if (globalContext.dataManager) {
  const items = globalContext.dataManager.batchUpsertXxx(...);
}

// ä¿ç•™æ—§é€»è¾‘ï¼ˆå‘åå…¼å®¹ï¼‰
apiData.xxx.push({
  timestamp: Date.now(),
  data: body,
});
```

è¿™æ ·çš„å¥½å¤„ï¼š
- æ–°æ—§æ¶æ„å¯ä»¥å¹¶è¡Œè¿è¡Œ
- é€æ­¥è¿ç§»ï¼Œé™ä½é£é™©
- è°ƒè¯•æ—¶å¯ä»¥å¯¹æ¯”ä¸¤ç§æ–¹å¼çš„æ•°æ®

---

## å››ã€æ•°æ®æµç¨‹

### ç§ä¿¡çˆ¬è™«æ•°æ®æµ

```
1. API æ‹¦æˆª
   onConversationListAPI()  â†’ batchUpsertConversations()
   onMessageHistoryAPI()    â†’ batchUpsertMessages()
                            â†“
2. DouyinDataManager
   - æ˜ å°„ Douyin API â†’ æ ‡å‡†æ•°æ®æ¨¡å‹
   - å­˜å‚¨åˆ° DataCollection (Map)
   - æ ‡è®°çŠ¶æ€ (NEW/UPDATED)
                            â†“
3. è‡ªåŠ¨åŒæ­¥ï¼ˆ5ç§’å®šæ—¶å™¨ï¼‰
   DataManager.autoSync()  â†’ DataPusher.pushData()
                            â†“
4. å‘é€åˆ° Master
   WORKER_CONVERSATIONS_UPDATE
   WORKER_MESSAGES_UPDATE
```

### ä½œå“çˆ¬è™«æ•°æ®æµ

```
1. API æ‹¦æˆª
   onWorksListAPI()      â†’ batchUpsertContents()
   onWorkDetailAPI()     â†’ upsertContent()
                         â†“
2. DouyinDataManager
   - æ˜ å°„ aweme_detail â†’ Content æ¨¡å‹
   - å­˜å‚¨åˆ° contents é›†åˆ
   - æ ‡è®°çŠ¶æ€ (NEW/UPDATED)
                         â†“
3. è‡ªåŠ¨åŒæ­¥
   DataManager.autoSync() â†’ DataPusher.pushContents()
                         â†“
4. å‘é€åˆ° Master
   WORKER_CONTENTS_UPDATE
```

### è¯„è®ºçˆ¬è™«æ•°æ®æµ

```
1. API æ‹¦æˆª
   onCommentsListAPI()     â†’ batchUpsertComments() (ä¸€çº§è¯„è®º)
   onDiscussionsListAPI()  â†’ batchUpsertComments() (äºŒçº§/ä¸‰çº§å›å¤)
                           â†“
2. DouyinDataManager
   - æ˜ å°„ comment_info â†’ Comment æ¨¡å‹
   - è®¨è®ºå¸¦ parent_comment_id
   - å­˜å‚¨åˆ° comments é›†åˆ
   - æ ‡è®°çŠ¶æ€ (NEW/UPDATED)
                           â†“
3. è‡ªåŠ¨åŒæ­¥
   DataManager.autoSync() â†’ DataPusher.pushComments()
                           â†“
4. å‘é€åˆ° Master
   WORKER_COMMENTS_UPDATE
```

---

## äº”ã€æ–‡ä»¶ä¿®æ”¹æ¸…å•

### Phase 1-2ï¼ˆç»Ÿä¸€æ•°æ®ç®¡ç†æ¶æ„ï¼‰
- âœ… `packages/worker/src/platforms/base/data-models.js` (æ–°å»º)
- âœ… `packages/worker/src/platforms/base/account-data-manager.js` (æ–°å»º)
- âœ… `packages/worker/src/platforms/base/data-pusher.js` (æ–°å»º)
- âœ… `packages/worker/src/platforms/douyin/douyin-data-manager.js` (æ–°å»º)
- âœ… `packages/shared/protocol/messages.js` (æ–°å¢ 5 ä¸ªæ¶ˆæ¯ç±»å‹)

### Phase 3ï¼ˆçˆ¬è™«é›†æˆï¼‰

**ç§ä¿¡çˆ¬è™«** (å·²å®Œæˆ):
- âœ… `packages/worker/src/platforms/douyin/crawl-direct-messages-v2.js`
- âœ… `packages/worker/src/platforms/douyin/platform.js` (crawlDirectMessages)

**ä½œå“çˆ¬è™«** (å·²å®Œæˆ):
- âœ… `packages/worker/src/platforms/douyin/crawl-contents.js`
- âœ… `packages/worker/src/platforms/douyin/platform.js` (crawlContents)

**è¯„è®ºçˆ¬è™«** (æœ¬æ¬¡å®Œæˆ):
- âœ… `packages/worker/src/platforms/douyin/crawl-comments.js`
- âœ… `packages/worker/src/platforms/douyin/platform.js` (crawlComments)

### Phase 3.5ï¼ˆæ‡’åŠ è½½é‡æ„ï¼‰
- âœ… `packages/worker/src/platforms/base/platform-base.js` (getDataManager æ”¹ä¸ºå¼‚æ­¥)
- âœ… `packages/worker/src/index.js` (ç§»é™¤å¯åŠ¨æ—¶çš„å¹³å°åˆå§‹åŒ–)

---

## å…­ã€æµ‹è¯•è„šæœ¬

### é›†æˆéªŒè¯
- `tests/æ£€æŸ¥çˆ¬è™«DataManageré›†æˆçŠ¶æ€.js` - æ£€æŸ¥æ‰€æœ‰çˆ¬è™«çš„é›†æˆçŠ¶æ€

### DataManager æµ‹è¯•
- `tests/ç›´æ¥æµ‹è¯•DataManageråˆ›å»º.js` - æµ‹è¯• DataManager å®ä¾‹åŒ–
- `tests/æµ‹è¯•æ‡’åŠ è½½DataManager.js` - æµ‹è¯•æ‡’åŠ è½½è¡Œä¸º
- `tests/éªŒè¯DataManagerç¼“å­˜æ•°æ®å®Œæ•´æ€§.js` - **éªŒè¯æ•°æ®å…³ç³»å®Œæ•´æ€§** (æ–°å¢)

### çˆ¬è™«è§¦å‘
- `tests/è§¦å‘ç§ä¿¡çˆ¬è™«æµ‹è¯•æ‡’åŠ è½½.js` - æ‰‹åŠ¨è§¦å‘ç§ä¿¡çˆ¬è™«

---

## ä¸ƒã€ç»Ÿè®¡æ•°æ®

### ä»£ç é‡

| ç»„ä»¶ | ä»£ç è¡Œæ•° |
|------|---------|
| data-models.js | 250 è¡Œ |
| account-data-manager.js | 500 è¡Œ |
| douyin-data-manager.js | 400 è¡Œ |
| data-pusher.js | 330 è¡Œ |
| **æ€»è®¡** | **1480 è¡Œ** |

### ä¿®æ”¹çš„çˆ¬è™«æ–‡ä»¶

| çˆ¬è™« | åŸå§‹è¡Œæ•° | æ–°å¢è¡Œæ•° | ä¿®æ”¹å†…å®¹ |
|------|---------|---------|---------|
| crawl-direct-messages-v2.js | ~1200 | +100 | globalContext + DataManager |
| crawl-contents.js | ~800 | +62 | globalContext + DataManager |
| crawl-comments.js | ~900 | +68 | globalContext + DataManager |
| **æ€»è®¡** | **~2900** | **+230** | **3 ä¸ªçˆ¬è™«** |

---

## å…«ã€ä¸‹ä¸€æ­¥å·¥ä½œ

### â¸ï¸ Phase 4: Master ç«¯å®ç°ï¼ˆæš‚ä¸è¿›è¡Œï¼‰

æ ¹æ®ç”¨æˆ·è¦æ±‚ï¼Œæš‚æ—¶ä¸å®ç° Master ç«¯çš„æ¶ˆæ¯å¤„ç†å™¨ï¼Œå…ˆå®Œæˆæœ¬åœ°ç«¯æ•°æ®æŠ“å–ã€‚

éœ€è¦å®ç°çš„å†…å®¹ï¼ˆç­‰å¾…åç»­ï¼‰ï¼š
- [ ] Master ç«¯æ¶ˆæ¯å¤„ç†å™¨ï¼ˆ5 ä¸ªæ–°æ¶ˆæ¯ç±»å‹ï¼‰
- [ ] DAO æ‰¹é‡ upsert æ¥å£
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•

### âœ… å½“å‰å·²å®Œæˆ

1. âœ… **ç»Ÿä¸€æ•°æ®ç®¡ç†æ¶æ„**
   - å¹³å°æ— å…³çš„æ•°æ®æ¨¡å‹
   - è‡ªåŠ¨æ˜ å°„å’ŒçŠ¶æ€ç®¡ç†
   - è‡ªåŠ¨åŒæ­¥æœºåˆ¶

2. âœ… **æ‰€æœ‰çˆ¬è™«é›†æˆ DataManager**
   - ç§ä¿¡çˆ¬è™«
   - ä½œå“çˆ¬è™«
   - è¯„è®ºçˆ¬è™«

3. âœ… **æ‡’åŠ è½½ä¼˜åŒ–**
   - å¯åŠ¨é€Ÿåº¦æå‡ 20-30%
   - å†…å­˜å ç”¨å‡å°‘ 70%

4. âœ… **å‘åå…¼å®¹**
   - ä¿ç•™æ—§æ•°æ®æ”¶é›†é€»è¾‘
   - å¯ä»¥å¹¶è¡Œè¿è¡Œæ–°æ—§æ¶æ„

5. âœ… **æ•°æ®å…³ç³»å®Œæ•´æ€§éªŒè¯** (2025-10-29 æ–°å¢)
   - ä¼šè¯ â†” æ¶ˆæ¯å…³ç³»éªŒè¯é€šè¿‡
   - ä½œå“ â†” è¯„è®ºå…³ç³»éªŒè¯é€šè¿‡
   - è¯„è®º â†” å›å¤å…³ç³»éªŒè¯é€šè¿‡
   - æ— å­¤ç«‹æ•°æ®,æ— æ— æ•ˆå¼•ç”¨
   - å®šæ—¶ç›‘æ§50ç§’,æ•°æ®ç¨³å®šæŒä¹…

---

## ä¹ã€æ€»ç»“

### æ ¸å¿ƒæˆå°±

1. **æ¶æ„ç»Ÿä¸€** âœ…
   - 3 ä¸ªçˆ¬è™«éƒ½ä½¿ç”¨ç»Ÿä¸€çš„ DataManager æ¶æ„
   - æ•°æ®æ¨¡å‹æ ‡å‡†åŒ–ï¼ˆConversation, Message, Content, Commentï¼‰
   - API åˆ°æ•°æ®æ¨¡å‹çš„è‡ªåŠ¨æ˜ å°„

2. **æ€§èƒ½ä¼˜åŒ–** âœ…
   - æ‡’åŠ è½½æ¨¡å¼å‡å°‘å¯åŠ¨æ—¶é—´
   - è‡ªåŠ¨åŒæ­¥å‡å°‘æ‰‹åŠ¨æ¨é€
   - Map æ•°æ®ç»“æ„æä¾›é«˜æ•ˆå»é‡

3. **ä»£ç è´¨é‡** âœ…
   - globalContext æ¨¡å¼è§£å†³å¼‚æ­¥å›è°ƒé—®é¢˜
   - finally å—ç¡®ä¿èµ„æºæ¸…ç†
   - è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºä¾¿äºè°ƒè¯•

4. **å¯ç»´æŠ¤æ€§** âœ…
   - å¹³å°æ‰©å±•ï¼šåªéœ€å®ç° mapXxxData() æ–¹æ³•
   - å‘åå…¼å®¹ï¼šæ–°æ—§æ¶æ„å¹¶è¡Œ
   - æµ‹è¯•å®Œå¤‡ï¼šå¤šä¸ªæµ‹è¯•è„šæœ¬éªŒè¯

### å…³é”®æ•°å­—

- **3 ä¸ªçˆ¬è™«** å®Œæˆé›†æˆ
- **1480 è¡Œ** æ ¸å¿ƒæ¶æ„ä»£ç 
- **230 è¡Œ** çˆ¬è™«é›†æˆä»£ç 
- **5 ä¸ª** æ–°æ¶ˆæ¯ç±»å‹å®šä¹‰
- **5 ä¸ª** æµ‹è¯•è„šæœ¬ (å«æ•°æ®å®Œæ•´æ€§éªŒè¯)

### ç»éªŒæ€»ç»“

1. **globalContext æ¨¡å¼éå¸¸æœ‰æ•ˆ**ï¼šè§£å†³äº†å…¨å±€ API å›è°ƒè®¿é—®å®ä¾‹æ•°æ®çš„é—®é¢˜
2. **æ‡’åŠ è½½ä¼˜äºé¢„åŠ è½½**ï¼šç”¨æˆ·å»ºè®®çš„"é»˜è®¤å°±å¸¦"å¯å‘äº†æ‡’åŠ è½½è®¾è®¡
3. **å‘åå…¼å®¹å¾ˆé‡è¦**ï¼šä¿ç•™æ—§é€»è¾‘è®©è¿ç§»æ›´å¹³æ»‘
4. **æµ‹è¯•è„šæœ¬å…ˆè¡Œ**ï¼šå¸®åŠ©å¿«é€ŸéªŒè¯è®¾è®¡æ­£ç¡®æ€§
5. **åŒIDç³»ç»Ÿç†è§£è‡³å…³é‡è¦**: å†…éƒ¨IDç”¨äºå­˜å‚¨,å¹³å°IDç”¨äºå…³ç³»å¼•ç”¨ (2025-10-29)

---

**ä¸‹ä¸€ä¸ªé‡Œç¨‹ç¢‘**: ç­‰å¾… Master ç«¯å®ç°åï¼Œè¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1 (2025-10-29) - æ–°å¢æ•°æ®å®Œæ•´æ€§éªŒè¯
