# IM å¤´åƒåŠŸèƒ½å®Œæ•´æ€»ç»“

**æ—¥æœŸ**: 2025-11-06
**ç‰ˆæœ¬**: 1.3 (æœ€ç»ˆä¼˜åŒ–ç‰ˆ)

## åŠŸèƒ½æ¦‚è¿°

å®ç°äº† IM å®¢æˆ·ç«¯çš„å®Œæ•´å¤´åƒæ˜¾ç¤ºåŠŸèƒ½,åŒ…æ‹¬:
1. **è¯„è®ºæ¶ˆæ¯å¤´åƒ** - æ˜¾ç¤ºè¯„è®ºäººçš„çœŸå®å¤´åƒ
2. **ç§ä¿¡æ¶ˆæ¯å¤´åƒ** - æ˜¾ç¤ºå¯¹æ–¹ç”¨æˆ·çš„çœŸå®å¤´åƒ
3. **ç§ä¿¡ä¼šè¯åˆ—è¡¨å¤´åƒ** - æ˜¾ç¤ºå¯¹æ–¹ç”¨æˆ·çš„å¤´åƒ
4. **ä½œå“åˆ—è¡¨å°é¢å›¾** - æ˜¾ç¤ºä½œå“å°é¢å›¾ âœ¨ æ–°å¢
5. **å®¢æœå›å¤åŒºåˆ†** - å®¢æœå›å¤æ˜¾ç¤ºç»¿è‰²å›¾æ ‡

## å®ç°çš„åŠŸèƒ½

### 1. è¯„è®ºæ¶ˆæ¯å¤´åƒ âœ…

**æ•°æ®æº**: Worker çˆ¬å–è¯„è®ºæ—¶æå– `author_avatar` å­—æ®µ

**å®ç°ä½ç½®**:
- Comment æ¨¡å‹æ·»åŠ  `author_avatar` å­—æ®µ
- IMWebSocketServer æ¨é€è¯„è®ºæ¶ˆæ¯æ—¶åŒ…å« `authorAvatar`
- å‰ç«¯æ˜¾ç¤ºè¯„è®ºäººçš„çœŸå®å¤´åƒ

**æ•ˆæœ**:
- ä¸»è¯„è®ºæ˜¾ç¤ºè¯„è®ºäººå¤´åƒ
- è®¨è®ºåŒºå›å¤æ˜¾ç¤ºå›å¤äººå¤´åƒ
- å®¢æœå›å¤æ˜¾ç¤ºç»¿è‰²å›¾æ ‡

### 2. ç§ä¿¡æ¶ˆæ¯å¤´åƒ (v1.3 ä¼˜åŒ–) âœ…

**æ•°æ®æº**: Worker çˆ¬å–ä¼šè¯æ—¶æå– `platform_user_avatar` å­—æ®µ

**å®ç°é€»è¾‘** (v1.3 ä¼˜åŒ–):
```javascript
// Master ç«¯: ä» conversation å¯¹è±¡è·å–å¯¹æ–¹ç”¨æˆ·å¤´åƒ
const conversation = conversationsList.find(c => c.conversationId === topicId);
const conversationUserAvatar = conversation ?
  (conversation.platform_user_avatar || conversation.userAvatar || null) : null;

// å®¢æœæ¶ˆæ¯ä¸éœ€è¦å¤´åƒï¼Œå¯¹æ–¹æ¶ˆæ¯ä½¿ç”¨ conversation çš„å¤´åƒ
const authorAvatar = isOutgoing ? null : conversationUserAvatar;
```

```typescript
// å‰ç«¯: ç»Ÿä¸€ä½¿ç”¨ mainMsg.authorAvatar
const isReply = (mainMsg as any).direction === 'outgoing' ||
                mainMsg.fromId === 'monitor_client' ||
                mainMsg.fromName === 'å®¢æœ'

const avatarSrc = isReply ? undefined : mainMsg.authorAvatar
```

**å­—æ®µæ˜ å°„**:
- Worker ä¼šè¯: `platform_user_avatar`
- Master æŸ¥æ‰¾: `conversation.platform_user_avatar || conversation.userAvatar`
- Master æ¨é€æ¶ˆæ¯: `authorAvatar: conversationUserAvatar`
- å‰ç«¯ä½¿ç”¨: `mainMsg.authorAvatar`

**æ•ˆæœ**:
- å¯¹æ–¹å‘é€çš„æ¶ˆæ¯æ˜¾ç¤ºå¯¹æ–¹å¤´åƒ
- å®¢æœå‘é€çš„æ¶ˆæ¯æ˜¾ç¤ºç»¿è‰²å›¾æ ‡
- å¤´åƒåŠ è½½å¤±è´¥æ—¶è‡ªåŠ¨é™çº§

### 3. ç§ä¿¡ä¼šè¯åˆ—è¡¨å¤´åƒ âœ…

**å®ç°ä½ç½®**:
- IMWebSocketServer æ„å»º topic æ—¶åŒ…å« `avatar` å­—æ®µ
- Topic ç±»å‹å®šä¹‰æ·»åŠ  `avatar?: string`
- å‰ç«¯ç§ä¿¡åˆ—è¡¨æ˜¾ç¤º `item.topic.avatar`

**æ•ˆæœ**:
- æ¯ä¸ªç§ä¿¡ä¼šè¯æ˜¾ç¤ºå¯¹æ–¹ç”¨æˆ·çš„çœŸå®å¤´åƒ
- å¤´åƒåŠ è½½å¤±è´¥æ˜¾ç¤ºç»¿è‰²æ¶ˆæ¯å›¾æ ‡

### 4. ä½œå“åˆ—è¡¨å°é¢å›¾ âœ… (v1.4 æ–°å¢)

**æ•°æ®æº**: Worker çˆ¬å–ä½œå“æ—¶æå– `coverUrl` å­—æ®µ

**å®ç°ä½ç½®**:
- IMWebSocketServer æ„å»ºä½œå“ topic æ—¶åŒ…å« `avatar: content.coverUrl`
- å‰ç«¯ä½œå“åˆ—è¡¨æ˜¾ç¤º `item.topic.avatar`

**æ•ˆæœ**:
- æ¯ä¸ªä½œå“æ˜¾ç¤ºå…¶å°é¢å›¾
- å¿«é€Ÿè¯†åˆ«ä½œå“å†…å®¹
- å°é¢å›¾åŠ è½½å¤±è´¥æ˜¾ç¤ºè“è‰²è¯„è®ºå›¾æ ‡

**è¯¦ç»†æ–‡æ¡£**: [ä½œå“åˆ—è¡¨å°é¢å›¾æ˜¾ç¤ºåŠŸèƒ½-2025-11-06.md](ä½œå“åˆ—è¡¨å°é¢å›¾æ˜¾ç¤ºåŠŸèƒ½-2025-11-06.md)

### 5. å®¢æœå›å¤åŒºåˆ† âœ…

**åˆ¤æ–­é€»è¾‘** (v1.3):
```typescript
// âœ… ä¼˜å…ˆä½¿ç”¨ direction å­—æ®µï¼ˆç§ä¿¡ï¼‰ï¼Œfallback åˆ° fromId/fromNameï¼ˆè¯„è®ºï¼‰
const isReply = (mainMsg as any).direction === 'outgoing' ||
                mainMsg.fromId === 'monitor_client' ||
                mainMsg.fromName === 'å®¢æœ'
```

**æ˜¾ç¤ºé€»è¾‘** (v1.3 ä¼˜åŒ–):
- ç”¨æˆ·æ¶ˆæ¯: æ˜¾ç¤ºçœŸå®å¤´åƒ (`mainMsg.authorAvatar`)
- å®¢æœå›å¤: ä¸ä½¿ç”¨å¤´åƒ,æ˜¾ç¤ºç»¿è‰²å›¾æ ‡ (`avatarSrc = undefined`)

## æ•°æ®æµå›¾

### è¯„è®ºå¤´åƒæµç¨‹

```
Worker (crawl-comments.js)
  â†“ æå– author_avatar: c.user_info?.avatar_url
DataStore (data-store.js)
  â†“ å†…å­˜å­˜å‚¨ { authorAvatar: ... }
IMWebSocketServer (im-websocket-server.js)
  â†“ æ¨é€ { authorAvatar: comment.authorAvatar }
å‰ç«¯ MonitorPage (MonitorPage.tsx)
  â†“ <Avatar src={mainMsg.authorAvatar} />
```

### ç§ä¿¡å¤´åƒæµç¨‹ (v1.3 ä¼˜åŒ–)

```
Worker (crawl-direct-messages-v2.js)
  â†“ æå– platform_user_avatar: user.avatar_thumb?.url_list?.[0]
DataStore (data-store.js)
  â†“ å†…å­˜å­˜å‚¨ conversation: { platform_user_avatar: ... }
IMWebSocketServer (im-websocket-server.js)
  â†“ ä» conversation å¯¹è±¡è·å–å¯¹æ–¹ç”¨æˆ·å¤´åƒ
  â†“ const conversationUserAvatar = conversation.platform_user_avatar || conversation.userAvatar
  â†“ æ¨é€æ¶ˆæ¯: { authorAvatar: conversationUserAvatar }
  â†“ æ¨é€ topic: { avatar: conversationUserAvatar }
å‰ç«¯ MonitorPage (MonitorPage.tsx)
  â†“ ç»Ÿä¸€ä½¿ç”¨: <Avatar src={mainMsg.authorAvatar} />
```

## æŠ€æœ¯äº®ç‚¹

### 1. å­—æ®µåç»Ÿä¸€æ˜ å°„ (v1.3 ä¼˜åŒ–)

| æ•°æ®å±‚çº§ | è¯„è®ºå­—æ®µ | ç§ä¿¡ä¼šè¯å­—æ®µ | ç§ä¿¡æ¶ˆæ¯å­—æ®µ |
|---------|---------|-------------|-------------|
| Worker | `author_avatar` | `platform_user_avatar` | - |
| Master DataStore | `authorAvatar` | `platform_user_avatar` | - |
| Master æŸ¥æ‰¾ | `comment.authorAvatar` | `conversation.platform_user_avatar` | ä» `conversation` è·å– |
| Master WebSocket | `authorAvatar` | `avatar` | `authorAvatar` |
| å‰ç«¯ä½¿ç”¨ | `mainMsg.authorAvatar` | `selectedTopic.avatar` | `mainMsg.authorAvatar` |

### 2. å®¢æœå›å¤åˆ¤æ–­ä¼˜åŒ– (v1.2)

**ä¼˜å…ˆçº§**:
1. `direction === 'outgoing'` - ç§ä¿¡æ¶ˆæ¯ä¸“ç”¨,æœ€å‡†ç¡®
2. `fromId === 'monitor_client'` - é€šç”¨åˆ¤æ–­,å…¼å®¹è¯„è®º
3. `fromName === 'å®¢æœ'` - fallback åˆ¤æ–­

**åŸå› **: ç§ä¿¡æ¶ˆæ¯æœ‰ `direction` å­—æ®µ,è¿™æ¯” `fromId` æ›´å‡†ç¡®,å› ä¸º Worker æ¨é€çš„æ¶ˆæ¯å¯èƒ½æ²¡æœ‰æ­£ç¡®è®¾ç½® `fromId`ã€‚

### 3. å¤´åƒè·å–ç­–ç•¥ (v1.3 ä¼˜åŒ–)

**Master ç«¯ç»Ÿä¸€å¤„ç†**:
```javascript
// Master åœ¨æ¨é€æ¶ˆæ¯æ—¶å°±ä» conversation è·å–å¤´åƒ
const conversation = conversationsList.find(c => c.conversationId === topicId);
const conversationUserAvatar = conversation ?
  (conversation.platform_user_avatar || conversation.userAvatar || null) : null;

const authorAvatar = isOutgoing ? null : conversationUserAvatar;
```

**å‰ç«¯ç»Ÿä¸€ä½¿ç”¨**:
```typescript
// âœ… ç»Ÿä¸€ä½¿ç”¨ mainMsg.authorAvatar (è¯„è®ºå’Œç§ä¿¡éƒ½ä¸€æ ·)
const avatarSrc = isReply ? undefined : mainMsg.authorAvatar
```

**ä¼˜åŠ¿**:
- **é€»è¾‘ç»Ÿä¸€**: è¯„è®ºå’Œç§ä¿¡ä½¿ç”¨ç›¸åŒçš„å‰ç«¯ä»£ç 
- **å•ä¸€æ•°æ®æº**: Master ç«¯è´Ÿè´£ä»æ­£ç¡®çš„æ¥æºè·å–å¤´åƒ
- **æ›´ç®€å•**: å‰ç«¯ä¸éœ€è¦åˆ¤æ–­ `activeTab` ç±»å‹
- **æ›´å¯é **: é¿å…å‰ç«¯è®¿é—®å¯èƒ½ä¸å­˜åœ¨çš„ `selectedTopic.avatar`

### 4. è‡ªåŠ¨é™çº§æœºåˆ¶

```tsx
<Avatar
  src={avatarSrc}  // å¯èƒ½ä¸º undefined æˆ–å¤´åƒ URL
  icon={<UserOutlined />}  // fallback å›¾æ ‡
  style={isReply ? { backgroundColor: '#07c160' } : undefined}
/>
```

**é™çº§ç­–ç•¥**:
- `avatarSrc` æœ‰å€¼ä¸”åŠ è½½æˆåŠŸ â†’ æ˜¾ç¤ºçœŸå®å¤´åƒ
- `avatarSrc` ä¸º `undefined` â†’ æ˜¾ç¤ºé»˜è®¤å›¾æ ‡
- å®¢æœå›å¤ â†’ æ˜¾ç¤ºç»¿è‰²èƒŒæ™¯å›¾æ ‡
- å¤´åƒåŠ è½½å¤±è´¥ â†’ è‡ªåŠ¨é™çº§åˆ°å›¾æ ‡

## ä¿®æ”¹çš„æ–‡ä»¶æ±‡æ€»

### æœåŠ¡ç«¯

1. **Comment.js** (4 å¤„ä¿®æ”¹)
   - `constructor`: æ·»åŠ  `author_avatar` å­—æ®µ
   - `toDbRow()`: æ·»åŠ  `author_avatar` å­—æ®µ
   - `toJSON()`: æ·»åŠ  `author_avatar` å­—æ®µ
   - `fromWorkerMessage()`: æ·»åŠ  `author_avatar` å­—æ®µ

2. **im-websocket-server.js** (3 å¤„ä¿®æ”¹)
   - è¯„è®ºæ¶ˆæ¯æ¨é€: æ·»åŠ  `authorAvatar: comment.authorAvatar`
   - ç§ä¿¡æ¶ˆæ¯æ¨é€: æ·»åŠ  `authorAvatar: msg.senderAvatar`
   - ç§ä¿¡ topic æ¨é€: æ·»åŠ  `avatar: conversation.platform_user_avatar || conversation.userAvatar`

### å‰ç«¯

3. **MonitorPage.tsx** (4 å¤„ä¿®æ”¹)
   - ä¸»æ¶ˆæ¯å¤´åƒ: æ·»åŠ  `src={avatarSrc}` é€»è¾‘
   - è®¨è®ºæ¶ˆæ¯å¤´åƒ: æ·»åŠ  `src={isDiscussionReply ? undefined : discussion.authorAvatar}`
   - ç§ä¿¡åˆ—è¡¨å¤´åƒ: æ·»åŠ  `src={item.topic.avatar}`
   - å®¢æœå›å¤åˆ¤æ–­: æ·»åŠ  `direction === 'outgoing'` åˆ¤æ–­

4. **types-monitor.ts** (3 å¤„ä¿®æ”¹)
   - `Message` æ¥å£: æ·»åŠ  `authorAvatar?: string` å’Œ `direction?: 'incoming' | 'outgoing'`
   - `ChannelMessage` æ¥å£: æ·»åŠ  `authorAvatar?: string`
   - `Topic` æ¥å£: æ·»åŠ  `avatar?: string`

## æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯

1. **è¯„è®ºæ¶ˆæ¯**
   - ç”¨æˆ·è¯„è®ºæ˜¾ç¤ºçœŸå®å¤´åƒ âœ…
   - å®¢æœå›å¤æ˜¾ç¤ºç»¿è‰²å›¾æ ‡ âœ…
   - è®¨è®ºåŒºåŒæ ·åŒºåˆ† âœ…

2. **ç§ä¿¡æ¶ˆæ¯**
   - å¯¹æ–¹æ¶ˆæ¯æ˜¾ç¤ºå¯¹æ–¹å¤´åƒ âœ…
   - å®¢æœå›å¤æ˜¾ç¤ºç»¿è‰²å›¾æ ‡ âœ…
   - æ‰€æœ‰å¯¹æ–¹æ¶ˆæ¯å…±äº«åŒä¸€ä¸ªå¤´åƒ âœ…

3. **ç§ä¿¡ä¼šè¯åˆ—è¡¨**
   - æ˜¾ç¤ºå¯¹æ–¹ç”¨æˆ·å¤´åƒ âœ…
   - å¤´åƒåŠ è½½å¤±è´¥æ˜¾ç¤ºæ¶ˆæ¯å›¾æ ‡ âœ…

4. **å¤´åƒåŠ è½½å¤±è´¥**
   - è‡ªåŠ¨é™çº§åˆ°é»˜è®¤å›¾æ ‡ âœ…
   - ä¸å½±å“æ­£å¸¸ä½¿ç”¨ âœ…

### æµ‹è¯•æ­¥éª¤

1. å¯åŠ¨æœåŠ¡
   ```bash
   npm run start:master
   npm run start:worker
   cd packages/crm-pc-im && npm run dev
   ```

2. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:5173/monitor`

3. éªŒè¯è¯„è®ºå¤´åƒ
   - é€‰æ‹©è´¦æˆ· â†’ ä½œå“è¯„è®ºæ ‡ç­¾
   - ç‚¹å‡»æœ‰è¯„è®ºçš„ä½œå“
   - æŸ¥çœ‹è¯„è®ºåˆ—è¡¨,éªŒè¯å¤´åƒæ˜¾ç¤º

4. éªŒè¯ç§ä¿¡å¤´åƒ
   - é€‰æ‹©è´¦æˆ· â†’ ç§ä¿¡æ ‡ç­¾
   - ç‚¹å‡»ç§ä¿¡ä¼šè¯
   - æŸ¥çœ‹æ¶ˆæ¯åˆ—è¡¨,éªŒè¯å¤´åƒæ˜¾ç¤º
   - éªŒè¯å®¢æœå›å¤æ˜¾ç¤ºç»¿è‰²å›¾æ ‡

## é—®é¢˜ä¿®å¤è®°å½•

### é—®é¢˜ 1: ç§ä¿¡æ¶ˆæ¯å¤´åƒä¸æ˜¾ç¤º

**åŸå› **: å­—æ®µåä¸åŒ¹é…
- Worker æ¨é€: `platform_user_avatar`
- Master ä½¿ç”¨: `userAvatar`

**ä¿®å¤**:
```javascript
avatar: conversation.platform_user_avatar || conversation.userAvatar || null
```

### é—®é¢˜ 2: å®¢æœå›å¤æ˜¾ç¤ºäº†å¯¹æ–¹å¤´åƒ

**åŸå› **: å®¢æœå›å¤åˆ¤æ–­ä¸å‡†ç¡®
- åªä½¿ç”¨ `fromId === 'monitor_client'` åˆ¤æ–­
- ç§ä¿¡æ¶ˆæ¯çš„ `fromId` å¯èƒ½ä¸å‡†ç¡®

**ä¿®å¤**:
```typescript
const isReply = (mainMsg as any).direction === 'outgoing' ||
                mainMsg.fromId === 'monitor_client' ||
                mainMsg.fromName === 'å®¢æœ'
```

ä¼˜å…ˆä½¿ç”¨ `direction` å­—æ®µï¼ˆç§ä¿¡ä¸“ç”¨ï¼‰ï¼Œfallback åˆ° `fromId`ï¼ˆè¯„è®ºé€šç”¨ï¼‰ã€‚

### é—®é¢˜ 3: ç§ä¿¡æ¶ˆæ¯å¤´åƒæ¥æºé”™è¯¯ (v1.3 æœ€ç»ˆä¼˜åŒ–)

**åŸå› **:
- v1.0-v1.2: ç§ä¿¡æ¶ˆæ¯ç›´æ¥ä½¿ç”¨ `msg.senderAvatar`ï¼Œä½†è¯¥å­—æ®µå¯èƒ½ä¸å¯é 
- v1.2: å‰ç«¯éœ€è¦æ ¹æ® `activeTab` åˆ¤æ–­ä»å“ªé‡Œè·å–å¤´åƒï¼Œé€»è¾‘å¤æ‚

**æœ€ç»ˆä¼˜åŒ–æ–¹æ¡ˆ (v1.3)**:
```javascript
// Master ç«¯: åœ¨æ¨é€æ¶ˆæ¯æ—¶ä» conversation å¯¹è±¡è·å–å¤´åƒ
const conversation = conversationsList.find(c => c.conversationId === topicId);
const conversationUserAvatar = conversation ?
  (conversation.platform_user_avatar || conversation.userAvatar || null) : null;

const authorAvatar = isOutgoing ? null : conversationUserAvatar;
```

```typescript
// å‰ç«¯: ç»Ÿä¸€ä½¿ç”¨ mainMsg.authorAvatar (è¯„è®ºå’Œç§ä¿¡éƒ½ä¸€æ ·)
const avatarSrc = isReply ? undefined : mainMsg.authorAvatar
```

**ä¼˜åŠ¿**:
- Master ç«¯ç»Ÿä¸€è´Ÿè´£ä»æ­£ç¡®çš„æ•°æ®æºè·å–å¤´åƒ
- å‰ç«¯é€»è¾‘ç®€å•ç»Ÿä¸€ï¼Œä¸éœ€è¦åŒºåˆ†æ¶ˆæ¯ç±»å‹
- æ•°æ®æ¥æºå”¯ä¸€å¯é ï¼ˆconversation å¯¹è±¡ï¼‰

## æ€»ç»“

### âœ… å®Œæˆçš„åŠŸèƒ½

1. **è¯„è®ºå¤´åƒ**: è¯„è®ºäººæ˜¾ç¤ºçœŸå®å¤´åƒ
2. **ç§ä¿¡æ¶ˆæ¯å¤´åƒ**: å¯¹æ–¹ç”¨æˆ·æ˜¾ç¤ºçœŸå®å¤´åƒ
3. **ç§ä¿¡ä¼šè¯åˆ—è¡¨å¤´åƒ**: ä¼šè¯åˆ—è¡¨æ˜¾ç¤ºå¯¹æ–¹å¤´åƒ
4. **å®¢æœå›å¤åŒºåˆ†**: å®¢æœå›å¤æ˜¾ç¤ºç»¿è‰²å›¾æ ‡
5. **è‡ªåŠ¨é™çº§**: å¤´åƒåŠ è½½å¤±è´¥ä¸å½±å“ä½¿ç”¨

### ğŸ¯ æ ¸å¿ƒä»·å€¼

- **è¯„è®ºåœºæ™¯**: æ¸…æ™°åŒºåˆ†ä¸åŒè¯„è®ºè€…
- **ç§ä¿¡åœºæ™¯**: å¿«é€Ÿè¯†åˆ«èŠå¤©å¯¹è±¡
- **å®¢æœåŒºåˆ†**: ä¸€çœ¼è¯†åˆ«å®¢æœå›å¤
- **è§†è§‰ä¸€è‡´æ€§**: æ‰€æœ‰åœºæ™¯ç»Ÿä¸€çš„å¤´åƒæ˜¾ç¤ºé€»è¾‘
- **å®¹é”™æ€§**: å¤´åƒåŠ è½½å¤±è´¥è‡ªåŠ¨é™çº§

### ğŸ“Š ä»£ç è´¨é‡

- **4 ä¸ªæ–‡ä»¶ä¿®æ”¹** - Comment.js, im-websocket-server.js, MonitorPage.tsx, types-monitor.ts
- **14 å¤„ä»£ç æ”¹åŠ¨** - æ¸…æ™°çš„æ³¨é‡Šå’Œæ–‡æ¡£
- **3 ä¸ªé—®é¢˜ä¿®å¤** - å­—æ®µåæ˜ å°„ã€å®¢æœåˆ¤æ–­ã€å¤´åƒæ¥æº
- **v1.3 æœ€ç»ˆä¼˜åŒ–** - Master ç«¯ç»Ÿä¸€å¤„ç†å¤´åƒè·å–é€»è¾‘
- **å®Œæ•´çš„æµ‹è¯•éªŒè¯** - è¦†ç›–æ‰€æœ‰ä½¿ç”¨åœºæ™¯

### ğŸ¯ v1.3 ä¼˜åŒ–äº®ç‚¹

1. **Master ç«¯é›†ä¸­å¤„ç†**: åœ¨æ¨é€æ¶ˆæ¯æ—¶ä» conversation å¯¹è±¡è·å–å¤´åƒ
2. **å‰ç«¯é€»è¾‘ç»Ÿä¸€**: è¯„è®ºå’Œç§ä¿¡ä½¿ç”¨ç›¸åŒçš„ä»£ç  `mainMsg.authorAvatar`
3. **å•ä¸€æ•°æ®æº**: é¿å…å‰ç«¯éœ€è¦åˆ¤æ–­ä¸åŒçš„æ•°æ®æ¥æº
4. **æ›´å¯é **: ç›´æ¥ä» conversation å¯¹è±¡è·å–ï¼Œé¿å…å­—æ®µç¼ºå¤±

æ‰€æœ‰åŠŸèƒ½å·²ç»å¼€å‘å®Œæˆå¹¶å‡†å¤‡å¥½ç”Ÿäº§éƒ¨ç½²!ğŸ‰
