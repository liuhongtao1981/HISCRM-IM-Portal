# æ‰‹åŠ¨ç™»å½•åŠŸèƒ½å®ç°æ–‡æ¡£

## 1. åŠŸèƒ½æ¦‚è¿°

æœ¬åŠŸèƒ½å®ç°äº†é€šè¿‡ CRM PC IM å®¢æˆ·ç«¯ï¼ˆElectronï¼‰åœ¨ç”¨æˆ·æœ¬åœ°æœºå™¨ä¸Šå¯åŠ¨æµè§ˆå™¨è¿›è¡Œæ‰‹åŠ¨ç™»å½•ï¼Œæ”¯æŒæ‰€æœ‰éªŒè¯æ–¹å¼ï¼ˆçŸ­ä¿¡éªŒè¯ã€æ»‘å—éªŒè¯ã€äººè„¸è¯†åˆ«ç­‰ï¼‰ï¼Œè§£å†³äº†é¢‘ç¹ç™»å½•è§¦å‘é¢å¤–éªŒè¯çš„é—®é¢˜ã€‚

### æ ¸å¿ƒé—®é¢˜
- å½“å‰ç™»å½•ç³»ç»Ÿä»…æ”¯æŒäºŒç»´ç ç™»å½•
- é¢‘ç¹ç™»å½•è§¦å‘çŸ­ä¿¡ã€æ»‘å—ã€äººè„¸è¯†åˆ«ç­‰éªŒè¯
- è¿™äº›éªŒè¯æ–¹å¼æ— æ³•è‡ªåŠ¨åŒ–ä¸”UIä¸å¯æ£€æµ‹

### è§£å†³æ–¹æ¡ˆ
- åœ¨ç”¨æˆ·æœ¬åœ°å¯åŠ¨å®Œå…¨éš”ç¦»çš„æµè§ˆå™¨å®ä¾‹
- ç”¨æˆ·æ‰‹åŠ¨å®Œæˆæ‰€æœ‰éªŒè¯æ­¥éª¤
- è‡ªåŠ¨æå–ç™»å½•çŠ¶æ€ï¼ˆcookies + localStorageï¼‰
- å‘é€åˆ° Masterï¼Œç”± Worker é‡å¯è´¦æˆ·åº”ç”¨æ–°ç™»å½•çŠ¶æ€

---

## 2. ç³»ç»Ÿæ¶æ„

### å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CRM PC IM      â”‚  1. ç‚¹å‡»æœªç™»å½•è´¦æˆ·
â”‚  (Electron)     â”‚  2. ç¡®è®¤å¯¹è¯æ¡†ï¼š"æ˜¯å¦ç°åœ¨ç™»å½•ï¼Ÿ"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 3. å¯åŠ¨æœ¬åœ°æµè§ˆå™¨ï¼ˆPlaywrightï¼‰
         â”‚    - ä½¿ç”¨ä¸´æ—¶ç›®å½•ï¼ˆå®Œå…¨éš”ç¦»ï¼‰
         â”‚    - ç”¨æˆ·æ‰‹åŠ¨ç™»å½•
         â”‚    - è‡ªåŠ¨æå– storageState
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Master Server  â”‚  4. æ¥æ”¶ç™»å½•æ•°æ®
â”‚  (Node.js)      â”‚  5. æ›´æ–°æ•°æ®åº“å­˜å‚¨çŠ¶æ€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  6. è½¬å‘ç»™ Worker
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Worker Process â”‚  7. åœæ­¢ç›‘æ§
â”‚  (Playwright)   â”‚  8. å…³é—­æ—§æµè§ˆå™¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  9. ä½¿ç”¨æ–°çŠ¶æ€åˆå§‹åŒ–
                    10. é‡å¯ç›‘æ§
                    11. é€šçŸ¥ Master å®Œæˆ
```

### æ¶ˆæ¯æµ

```
IM Client â†’ Master:  client:manual-login-success
Master â†’ Worker:     master:update-account-storage
Worker â†’ Master:     worker:account-restarted
Master â†’ IM Client:  master:account-status-updated
```

---

## 3. å®ç°ç»†èŠ‚

### 3.1 CRM PC IM å®¢æˆ·ç«¯ï¼ˆElectronï¼‰

#### æ–‡ä»¶ï¼š`packages/crm-pc-im/src/main/login-assistant.js`

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **å®Œå…¨éš”ç¦»çš„æµè§ˆå™¨**ï¼šä½¿ç”¨ `os.tmpdir()` åˆ›å»ºä¸´æ—¶ç›®å½•ï¼Œç¡®ä¿æ— æœ¬åœ°ç”¨æˆ·æ•°æ®
- **æµè§ˆå™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šç›‘å¬ `browser.on('disconnected')` æ£€æµ‹ç”¨æˆ·å…³é—­
- **è‡ªåŠ¨æå–å­˜å‚¨çŠ¶æ€**ï¼š`context.storageState()` è·å– cookies å’Œ localStorage
- **æ”¯æŒæ‰€æœ‰éªŒè¯æ–¹å¼**ï¼šé€šè¿‡ `page.waitForURL()` æ£€æµ‹ç™»å½•æˆåŠŸ

**å…³é”®ä»£ç **ï¼š
```javascript
this.activeBrowser = await chromium.launch({
  headless: false,
  args: [
    `--user-data-dir=${tempDir}`,  // ä¸´æ—¶ç›®å½•
    '--disable-blink-features=AutomationControlled'
  ]
});

// ç­‰å¾…ç™»å½•æˆåŠŸ
await page.waitForURL('**/creator.douyin.com/**', { timeout });
await page.waitForSelector('[class*="user-avatar"]', { timeout: 30000 });

// æå–å­˜å‚¨çŠ¶æ€
const storageState = await context.storageState();
```

#### æ–‡ä»¶ï¼š`packages/crm-pc-im/electron/main.ts`

**é›†æˆæ­¥éª¤**ï¼š
1. å¯¼å…¥ `socket.io-client` å’Œ `LoginAssistant`
2. åœ¨ `app.whenReady()` ååˆå§‹åŒ– Socket.IO å®¢æˆ·ç«¯
3. è¿æ¥åˆ° Master åå®ä¾‹åŒ– `LoginAssistant`
4. ç›‘å¬ `master:account-status-updated` äº‹ä»¶å¹¶è½¬å‘ç»™æ¸²æŸ“è¿›ç¨‹

#### æ–‡ä»¶ï¼š`packages/crm-pc-im/electron/preload.ts`

**IPC æ¥å£**ï¼š
```typescript
window.electron.send('start-manual-login', { accountId, platform })
window.electron.on('login-browser-opened', callback)
window.electron.on('login-success', callback)
window.electron.on('login-failed', callback)
window.electron.on('account-status-updated', callback)
```

#### æ–‡ä»¶ï¼š`packages/crm-pc-im/src/pages/MonitorPage.tsx`

**UI æ”¹é€ **ï¼š
- **ä¸‰å±‚è´¦æˆ·æ’åº**ï¼š
  1. ç™»å½• vs æœªç™»å½•
  2. ç™»å½•è´¦æˆ·æŒ‰æœ€åæ¶ˆæ¯æ—¶é—´å€’åº
  3. æœªç™»å½•è´¦æˆ·æŒ‰åç§°æ’åº
- **è§†è§‰åŒºåˆ†**ï¼š
  - ç™»å½•ï¼šå½©è‰²å¤´åƒ + ç»¿è‰²çŠ¶æ€ç‚¹
  - æœªç™»å½•ï¼šç°è‰²å¤´åƒ + ç°è‰²çŠ¶æ€ç‚¹
- **äº¤äº’é€»è¾‘**ï¼šç‚¹å‡»æœªç™»å½•è´¦æˆ· â†’ Modal ç¡®è®¤ â†’ å‘é€ IPC æ¶ˆæ¯

---

### 3.2 Master æœåŠ¡å™¨

#### æ–‡ä»¶ï¼š`packages/shared/protocol/messages.js`

**æ–°å¢æ¶ˆæ¯ç±»å‹**ï¼š
```javascript
CLIENT_MANUAL_LOGIN_SUCCESS = 'client:manual-login-success'
CLIENT_MANUAL_LOGIN_SUCCESS_ACK = 'client:manual-login-success:ack'
MASTER_UPDATE_ACCOUNT_STORAGE = 'master:update-account-storage'
MASTER_UPDATE_ACCOUNT_STORAGE_ACK = 'master:update-account-storage:ack'
WORKER_ACCOUNT_RESTARTED = 'worker:account-restarted'
MASTER_ACCOUNT_STATUS_UPDATED = 'master:account-status-updated'
```

#### æ–‡ä»¶ï¼š`packages/master/src/communication/socket-server.js`

**å®¢æˆ·ç«¯å‘½åç©ºé—´**ï¼ˆç›‘å¬ IM å®¢æˆ·ç«¯ï¼‰ï¼š
```javascript
socket.on('client:manual-login-success', async (data) => {
  // è°ƒç”¨ handlers.onManualLoginSuccess
  // ä¼ é€’ data, socket, workerNamespace
});
```

**Worker å‘½åç©ºé—´**ï¼ˆç›‘å¬ Workerï¼‰ï¼š
```javascript
socket.on('worker:account-restarted', async (data) => {
  // è°ƒç”¨ handlers.onAccountRestarted
  // é€šçŸ¥ IM å®¢æˆ·ç«¯
});
```

#### æ–‡ä»¶ï¼š`packages/master/src/index.js`

**å¤„ç†å™¨å®ç°**ï¼š

**onManualLoginSuccess**ï¼ˆ632-685è¡Œï¼‰ï¼š
1. éªŒè¯è´¦æˆ·å­˜åœ¨
2. æ›´æ–°æ•°æ®åº“ï¼š`storage_state`ã€`status`ã€`last_login_time`
3. å‘é€ `master:update-account-storage` ç»™ Worker
4. è¿”å›ç¡®è®¤ç»™ IM å®¢æˆ·ç«¯

**onAccountRestarted**ï¼ˆ537-552è¡Œï¼‰ï¼š
1. æ¥æ”¶ Worker é‡å¯ç»“æœ
2. å‘é€ `master:account-status-updated` ç»™ IM å®¢æˆ·ç«¯

---

### 3.3 Worker è¿›ç¨‹

#### æ–‡ä»¶ï¼š`packages/worker/src/communication/socket-client.js`

**ç›‘å¬ Master äº‹ä»¶**ï¼š
```javascript
this.socket.on(MASTER_UPDATE_ACCOUNT_STORAGE, (data) => {
  // è§¦å‘å¤„ç†å™¨
  const handler = this.messageHandlers.get(MASTER_UPDATE_ACCOUNT_STORAGE);
  if (handler) handler(data);
});
```

#### æ–‡ä»¶ï¼š`packages/worker/src/index.js`

**è´¦æˆ·é‡å¯é€»è¾‘**ï¼ˆ203-267è¡Œï¼‰ï¼š

1. **åœæ­¢ç›‘æ§**ï¼š
   ```javascript
   await platformInstance.stopMonitoring(accountId);
   ```

2. **å…³é—­æ—§æµè§ˆå™¨**ï¼š
   ```javascript
   await browserManager.closeBrowser(accountId);
   ```

3. **é‡æ–°åŠ è½½é…ç½®**ï¼š
   ```javascript
   const accountConfig = await reloadAccountConfig(accountId);
   accountConfig.storage_state = storageState;  // æ³¨å…¥æ–°çŠ¶æ€
   ```

4. **åˆå§‹åŒ–æ–°æµè§ˆå™¨**ï¼š
   ```javascript
   await accountInitializer.initializeAccount(accountConfig);
   ```

5. **é‡å¯ç›‘æ§**ï¼š
   ```javascript
   await platformInstance.startMonitoring(accountId);
   ```

6. **é€šçŸ¥ Master**ï¼š
   ```javascript
   socketClient.sendMessage(createMessage(WORKER_ACCOUNT_RESTARTED, {
     accountId,
     platform,
     success: true,
     timestamp: Date.now()
   }));
   ```

---

## 4. æ•°æ®åº“å˜æ›´

### accounts è¡¨

**æ›´æ–°å­—æ®µ**ï¼š
- `storage_state`ï¼šJSON å­—ç¬¦ä¸²ï¼ŒåŒ…å« cookies å’Œ localStorage
- `status`ï¼šæ›´æ–°ä¸º `'active'`
- `last_login_time`ï¼šæ›´æ–°ä¸ºå½“å‰æ—¶é—´æˆ³

**SQL ç¤ºä¾‹**ï¼š
```sql
UPDATE accounts
SET
  storage_state = '{"cookies":[...],"origins":[...]}',
  status = 'active',
  last_login_time = 1735123456789
WHERE id = 'account-123';
```

---

## 5. ä¾èµ–åŒ…

### CRM PC IM æ–°å¢ä¾èµ–

```json
{
  "dependencies": {
    "playwright": "^1.40.0",
    "fs-extra": "^11.1.1"
  }
}
```

---

## 6. æµ‹è¯•æŒ‡å—

### 6.1 å‰ç½®æ¡ä»¶

1. **å¯åŠ¨ Master æœåŠ¡å™¨**ï¼š
   ```bash
   cd packages/master
   npm start
   ```

2. **å¯åŠ¨ Worker è¿›ç¨‹**ï¼š
   ```bash
   cd packages/worker
   npm start
   ```

3. **å¯åŠ¨ CRM PC IM**ï¼š
   ```bash
   cd packages/crm-pc-im
   npm run electron:dev
   ```

### 6.2 æ‰‹åŠ¨æµ‹è¯•æµç¨‹

1. åœ¨ Master æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªæµ‹è¯•è´¦æˆ·ï¼ˆstatus = 'not_logged_in'ï¼‰
2. æ‰“å¼€ CRM PC IM å®¢æˆ·ç«¯
3. åœ¨è´¦æˆ·åˆ—è¡¨ä¸­æ‰¾åˆ°æœªç™»å½•è´¦æˆ·ï¼ˆæ˜¾ç¤ºä¸ºç°è‰²ï¼‰
4. ç‚¹å‡»è´¦æˆ· â†’ ç¡®è®¤å¯¹è¯æ¡† â†’ ç‚¹å‡»"æ˜¯çš„ï¼Œç™»å½•"
5. æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€ï¼ˆå®Œå…¨å¹²å‡€çš„ç¯å¢ƒï¼‰
6. æ‰‹åŠ¨å®Œæˆç™»å½•ï¼ˆåŒ…æ‹¬ä»»ä½•éªŒè¯ï¼‰
7. ç™»å½•æˆåŠŸåæµè§ˆå™¨è‡ªåŠ¨å…³é—­
8. è§‚å¯Ÿ IM å®¢æˆ·ç«¯ï¼šè´¦æˆ·å˜ä¸ºå½©è‰²å¹¶ç§»åŠ¨åˆ°åˆ—è¡¨é¡¶éƒ¨

### 6.3 è‡ªåŠ¨åŒ–æµ‹è¯•

è¿è¡Œé›†æˆæµ‹è¯•è„šæœ¬ï¼š
```bash
cd tests
node æ‰‹åŠ¨ç™»å½•åŠŸèƒ½æµ‹è¯•.js
```

**æµ‹è¯•è¦†ç›–**ï¼š
- âœ… Socket.IO æ¶ˆæ¯ä¼ é€’ï¼ˆIM â†’ Master â†’ Worker â†’ Master â†’ IMï¼‰
- âœ… æ•°æ®åº“å­˜å‚¨çŠ¶æ€æ›´æ–°
- âœ… Worker è´¦æˆ·é‡å¯æµç¨‹
- âœ… çŠ¶æ€é€šçŸ¥åˆ°å®¢æˆ·ç«¯

---

## 7. æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šæµè§ˆå™¨å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**ï¼š`LoginAssistant` æŠ¥é”™ "Playwright browser not found"

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
cd packages/crm-pc-im
npx playwright install chromium
```

### é—®é¢˜ 2ï¼šSocket.IO è¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼šIM å®¢æˆ·ç«¯æ— æ³•è¿æ¥åˆ° Master

**æ£€æŸ¥**ï¼š
1. Master æ˜¯å¦è¿è¡Œåœ¨ç«¯å£ 3000
2. `config.json` ä¸­ WebSocket URL æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹ Electron main.ts ä¸­çš„ `initializeSocketClient()` æ—¥å¿—

### é—®é¢˜ 3ï¼šWorker æœªæ”¶åˆ°å­˜å‚¨çŠ¶æ€æ›´æ–°

**ç—‡çŠ¶**ï¼šMaster å‘é€äº† `master:update-account-storage`ï¼Œä½† Worker æ— å“åº”

**æ£€æŸ¥**ï¼š
1. Worker æ˜¯å¦æˆåŠŸè¿æ¥åˆ° Masterï¼ˆæ£€æŸ¥ Worker æ—¥å¿—ï¼‰
2. æ£€æŸ¥ `worker/src/index.js` ä¸­çš„å¤„ç†å™¨æ³¨å†Œï¼ˆ207è¡Œï¼‰
3. éªŒè¯æ¶ˆæ¯ç±»å‹å¸¸é‡å¯¼å…¥æ­£ç¡®

### é—®é¢˜ 4ï¼šè´¦æˆ·é‡å¯å¤±è´¥

**ç—‡çŠ¶**ï¼šWorker æŠ¥é”™æ— æ³•é‡å¯è´¦æˆ·

**å¸¸è§åŸå› **ï¼š
- `browserManager` æ— æ³•å…³é—­æ—§æµè§ˆå™¨ï¼ˆå¯èƒ½å·²å´©æºƒï¼‰
- `accountInitializer` åˆå§‹åŒ–å¤±è´¥ï¼ˆå­˜å‚¨çŠ¶æ€æ ¼å¼é”™è¯¯ï¼‰
- å¹³å°å®ä¾‹ä¸å­˜åœ¨ï¼ˆè´¦æˆ·ä»æœªåˆå§‹åŒ–è¿‡ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼šæŸ¥çœ‹ Worker è¯¦ç»†æ—¥å¿—ï¼Œæ ¹æ®é”™è¯¯ç±»å‹å¤„ç†

---

## 8. å®‰å…¨è€ƒè™‘

### æµè§ˆå™¨éš”ç¦»

- âœ… ä½¿ç”¨ `os.tmpdir()` åˆ›å»ºä¸´æ—¶ç›®å½•
- âœ… ç™»å½•å®Œæˆåè‡ªåŠ¨åˆ é™¤ä¸´æ—¶ç›®å½•
- âœ… æ— æœ¬åœ°ç”¨æˆ·æ•°æ®æ³„éœ²é£é™©

### å­˜å‚¨çŠ¶æ€ä¼ è¾“

- âš ï¸ å½“å‰é€šè¿‡ Socket.IO æ˜æ–‡ä¼ è¾“ï¼ˆå†…ç½‘ç¯å¢ƒå¯æ¥å—ï¼‰
- ğŸ”’ ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼šä½¿ç”¨ WSSï¼ˆWebSocket Secureï¼‰åŠ å¯†ä¼ è¾“

### IPC å®‰å…¨

- âœ… Preload ä½¿ç”¨ç™½åå•æœºåˆ¶
- âœ… åªå…è®¸ç‰¹å®šäº‹ä»¶é€šè¿‡ IPC é€šé“
- âœ… `contextIsolation: true` éš”ç¦»æ¸²æŸ“è¿›ç¨‹

---

## 9. æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å…¸å‹å€¼ | è¯´æ˜ |
|------|--------|------|
| æµè§ˆå™¨å¯åŠ¨æ—¶é—´ | 2-3ç§’ | Playwright chromium.launch() |
| ç™»å½•æ£€æµ‹å»¶è¿Ÿ | 500ms | page.waitForURL + waitForSelector |
| å­˜å‚¨çŠ¶æ€æå– | 100-200ms | context.storageState() |
| Socket.IO æ¶ˆæ¯ä¼ é€’ | <50ms | æœ¬åœ°ç½‘ç»œå»¶è¿Ÿ |
| Worker é‡å¯è´¦æˆ· | 5-10ç§’ | å…³é—­æ—§æµè§ˆå™¨ + åˆå§‹åŒ–æ–°æµè§ˆå™¨ |
| å®Œæ•´æµç¨‹ç«¯åˆ°ç«¯ | 10-15ç§’ | ä»ç‚¹å‡»åˆ°çŠ¶æ€æ›´æ–° |

---

## 10. åç»­ä¼˜åŒ–å»ºè®®

### 10.1 UI ä¼˜åŒ–

- [ ] æ·»åŠ ç™»å½•è¿›åº¦æ¡ï¼ˆ"æµè§ˆå™¨å¯åŠ¨ä¸­..." â†’ "ç­‰å¾…ç™»å½•..." â†’ "å¤„ç†ä¸­..."ï¼‰
- [ ] æ”¯æŒå–æ¶ˆç™»å½•æ“ä½œ
- [ ] ç™»å½•å¤±è´¥åæ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯

### 10.2 åŠŸèƒ½æ‰©å±•

- [ ] æ”¯æŒå¤šå¹³å°ï¼ˆå°çº¢ä¹¦ã€å¾®åšç­‰ï¼‰
- [ ] è®°å½•ç™»å½•å†å²ï¼ˆæ—¶é—´ã€IPã€è®¾å¤‡ï¼‰
- [ ] è‡ªåŠ¨æ£€æµ‹ cookies è¿‡æœŸå¹¶æé†’ç”¨æˆ·é‡æ–°ç™»å½•

### 10.3 ç¨³å®šæ€§æå‡

- [ ] æ·»åŠ é‡è¯•æœºåˆ¶ï¼ˆæµè§ˆå™¨å¯åŠ¨å¤±è´¥è‡ªåŠ¨é‡è¯•ï¼‰
- [ ] è¶…æ—¶ä¿æŠ¤ï¼ˆç™»å½•è¶…æ—¶åè‡ªåŠ¨æ¸…ç†èµ„æºï¼‰
- [ ] æ—¥å¿—å¢å¼ºï¼ˆè®°å½•è¯¦ç»†çš„ç™»å½•æµç¨‹æ­¥éª¤ï¼‰

---

## 11. ç›¸å…³æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `packages/crm-pc-im/src/main/login-assistant.js` | ç™»å½•åŠ©æ‰‹æ ¸å¿ƒé€»è¾‘ |
| `tests/æ‰‹åŠ¨ç™»å½•åŠŸèƒ½æµ‹è¯•.js` | é›†æˆæµ‹è¯•è„šæœ¬ |
| `docs/æ‰‹åŠ¨ç™»å½•åŠŸèƒ½å®ç°æ–‡æ¡£.md` | æœ¬æ–‡æ¡£ |

### ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä¸»è¦å˜æ›´ |
|---------|---------|
| `packages/shared/protocol/messages.js` | æ·»åŠ  6 ä¸ªæ–°æ¶ˆæ¯ç±»å‹ |
| `packages/crm-pc-im/electron/main.ts` | é›†æˆ Socket.IO å’Œ LoginAssistant |
| `packages/crm-pc-im/electron/preload.ts` | æ·»åŠ  IPC æ¥å£ |
| `packages/crm-pc-im/src/pages/MonitorPage.tsx` | UI æ”¹é€ ï¼ˆæ’åº+æ ·å¼+äº¤äº’ï¼‰ |
| `packages/crm-pc-im/package.json` | æ·»åŠ  playwright ä¾èµ– |
| `packages/master/src/communication/socket-server.js` | æ·»åŠ ä¸¤ä¸ªäº‹ä»¶ç›‘å¬å™¨ |
| `packages/master/src/index.js` | æ·»åŠ ä¸¤ä¸ªå¤„ç†å™¨ |
| `packages/worker/src/communication/socket-client.js` | æ·»åŠ å­˜å‚¨çŠ¶æ€æ›´æ–°ç›‘å¬ |
| `packages/worker/src/index.js` | æ·»åŠ è´¦æˆ·é‡å¯é€»è¾‘ï¼ˆ65è¡Œï¼‰ |

---

## 12. æ€»ç»“

æœ¬æ¬¡å®ç°å®Œæ•´åœ°è§£å†³äº†é¢‘ç¹ç™»å½•è§¦å‘é¢å¤–éªŒè¯çš„é—®é¢˜ï¼š

âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šåœ¨æœ¬åœ°æœºå™¨ä¸Šæ‰‹åŠ¨ç™»å½•ï¼Œæ”¯æŒæ‰€æœ‰éªŒè¯æ–¹å¼
âœ… **å®‰å…¨æ€§**ï¼šå®Œå…¨éš”ç¦»çš„æµè§ˆå™¨ç¯å¢ƒï¼Œæ— æ•°æ®æ³„éœ²é£é™©
âœ… **å¯é æ€§**ï¼šå®Œæ•´çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€åŒæ­¥æœºåˆ¶
âœ… **å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„æ¶ˆæ¯æµå’Œæ¨¡å—åŒ–è®¾è®¡

ç³»ç»Ÿæ¶æ„éµå¾ª Master-Worker æ¨¡å¼ï¼Œæ¶ˆæ¯ä¼ é€’ä½¿ç”¨ Socket.IOï¼Œå®ç°äº†ä» IM å®¢æˆ·ç«¯åˆ° Worker è¿›ç¨‹çš„å®Œæ•´é—­ç¯ï¼Œç¡®ä¿è´¦æˆ·ç™»å½•çŠ¶æ€å®æ—¶åŒæ­¥ã€‚
