# ç™»å½•åŠ©æ‰‹æœ€ç»ˆæ–¹æ¡ˆ - URL è·³è½¬å³æˆåŠŸ

## æ ¸å¿ƒåŸåˆ™

**URL ä»æ ¹è·¯å¾„è·³è½¬åˆ°å­è·¯å¾„ = ç™»å½•æˆåŠŸ**

æŠ–éŸ³åˆ›ä½œè€…ä¸­å¿ƒçš„ç™»å½•æµç¨‹ï¼š
1. æ‰“å¼€ `https://creator.douyin.com/`ï¼ˆæ ¹è·¯å¾„ï¼Œæ˜¾ç¤ºç™»å½•äºŒç»´ç ï¼‰
2. ç”¨æˆ·æ‰«ç å®Œæˆç™»å½•
3. URL è‡ªåŠ¨è·³è½¬åˆ° `https://creator.douyin.com/creator-micro/home`ï¼ˆç™»å½•åä¸»é¡µï¼‰

## ç™»å½•æ£€æµ‹é€»è¾‘

```javascript
async waitForLogin(page, platform, timeout = 10 * 60 * 1000) {
    if (platform === 'douyin') {
        // ç­‰å¾… URL è·³è½¬åˆ°ç™»å½•åé¡µé¢ï¼ˆä»æ ¹è·¯å¾„è·³è½¬åˆ°å­è·¯å¾„ï¼‰
        console.log('[ç™»å½•åŠ©æ‰‹] ç­‰å¾… URL è·³è½¬åˆ°åˆ›ä½œè€…ä¸­å¿ƒä¸»é¡µ...');
        console.log('[ç™»å½•åŠ©æ‰‹] å½“å‰ URL:', page.url());

        // ç™»å½•æˆåŠŸåä¼šè·³è½¬åˆ° /creator-micro/home
        await page.waitForURL('**/creator.douyin.com/creator-micro/**', { timeout });

        console.log('[ç™»å½•åŠ©æ‰‹] âœ… æ£€æµ‹åˆ°ç™»å½•æˆåŠŸï¼ˆURL å·²è·³è½¬åˆ°:', page.url(), 'ï¼‰');
        return true;
    }
}
```

### URL æ£€æŸ¥æ–¹æ³•

```javascript
checkIfLoggedInUrl(url, platform) {
    if (platform === 'douyin') {
        // ç™»å½•æˆåŠŸåä¼šè·³è½¬åˆ° /creator-micro/home ç­‰å­è·¯å¾„
        return url.includes('creator.douyin.com/creator-micro/');
    }
    return false;
}
```

## æŠ–éŸ³ç™»å½•æµç¨‹åˆ†æ

### 1. åˆå§‹çŠ¶æ€ï¼ˆæœªç™»å½•ï¼‰

- **URL**: `https://creator.douyin.com/`
- **é¡µé¢å†…å®¹**: ç™»å½•äºŒç»´ç ã€æˆ–æ‰‹æœºå·ç™»å½•è¡¨å•
- **ç‰¹å¾**: URL æ˜¯æ ¹è·¯å¾„ï¼ˆ`/`ï¼‰

### 2. ç™»å½•ä¸­

- ç”¨æˆ·æ‰«æäºŒç»´ç 
- æˆ–è¾“å…¥æ‰‹æœºå· + éªŒè¯ç 
- é¡µé¢å¯èƒ½æ˜¾ç¤ºåŠ è½½åŠ¨ç”»

### 3. ç™»å½•æˆåŠŸ

- **URL è·³è½¬**: `https://creator.douyin.com/` â†’ `https://creator.douyin.com/creator-micro/home`
- **é¡µé¢å†…å®¹**: åˆ›ä½œè€…ä¸­å¿ƒä¸»é¡µï¼Œæ˜¾ç¤ºç”¨æˆ·å¤´åƒã€æ˜µç§°ã€ç»Ÿè®¡æ•°æ®ç­‰
- **ç‰¹å¾**: URL åŒ…å« `/creator-micro/` å­è·¯å¾„

## ä¸ºä»€ä¹ˆä¹‹å‰çš„æ–¹æ¡ˆä¸å·¥ä½œï¼Ÿ

### é”™è¯¯æ–¹æ¡ˆ 1ï¼š`waitForURL('**/creator.douyin.com/**')`

**é—®é¢˜**ï¼š
- åˆå§‹ URL å°±æ˜¯ `https://creator.douyin.com/`
- åŒ¹é… `**/creator.douyin.com/**` æ¨¡å¼
- `waitForURL` ç«‹å³æˆåŠŸï¼Œä¸ç­‰å¾…ç™»å½•

### é”™è¯¯æ–¹æ¡ˆ 2ï¼šç­‰å¾…å¤´åƒå…ƒç´ 

**é—®é¢˜**ï¼š
- å¤´åƒé€‰æ‹©å™¨å¯èƒ½å˜åŒ–
- é¡µé¢åŠ è½½æ…¢æ—¶è¶…æ—¶
- ç”¨æˆ·æå‰å…³é—­æµè§ˆå™¨å¯¼è‡´å¤±è´¥

### æ­£ç¡®æ–¹æ¡ˆï¼š`waitForURL('**/creator.douyin.com/creator-micro/**')`

**ä¼˜åŠ¿**ï¼š
- âœ… åˆå§‹ URL ä¸åŒ¹é…ï¼ˆ`/` æ ¹è·¯å¾„ï¼‰
- âœ… ç™»å½•æˆåŠŸåæ‰è·³è½¬åˆ° `/creator-micro/`
- âœ… URL æ˜¯æœ€å¯é çš„ç™»å½•æˆåŠŸæ ‡å¿—
- âœ… ä¸ä¾èµ–é¡µé¢å…ƒç´ ï¼ˆä¸å—ç•Œé¢æ”¹ç‰ˆå½±å“ï¼‰

## å®Œæ•´å·¥ä½œæµç¨‹

```
æ‰“å¼€ https://creator.douyin.com/
    â†“
é¡µé¢æ˜¾ç¤ºç™»å½•äºŒç»´ç 
    â†“
ç”¨æˆ·æ‰«ç 
    â†“
URL è·³è½¬åˆ° https://creator.douyin.com/creator-micro/home
    â†“
æ£€æµ‹åˆ° URL å˜åŒ– âœ…
    â†“
æ˜¾ç¤ºç»¿è‰²æ¨ªå¹…ï¼š"ç™»å½•æˆåŠŸï¼2ç§’åè‡ªåŠ¨å…³é—­..."
    â†“
æå– storageState (cookies)
    â†“
å‘é€ç»™ Master æœåŠ¡å™¨
    â†“
2 ç§’åè‡ªåŠ¨å…³é—­æµè§ˆå™¨
```

## ä¸‰ç§åœºæ™¯å¤„ç†

### åœºæ™¯ 1ï¼šæ­£å¸¸ç™»å½•ï¼ˆè‡ªåŠ¨å…³é—­ï¼‰

```
åˆå§‹ URL: https://creator.douyin.com/
ç”¨æˆ·æ‰«ç 
URL è·³è½¬: https://creator.douyin.com/creator-micro/home âœ…
waitForURL æˆåŠŸ
æå–çŠ¶æ€ + å‘é€ç»™ Master
2 ç§’åè‡ªåŠ¨å…³é—­
```

### åœºæ™¯ 2ï¼šè¶…æ—¶æ£€æŸ¥

å¦‚æœ `waitForURL` è¶…æ—¶ï¼ˆ10 åˆ†é’Ÿï¼‰ï¼Œæ£€æŸ¥å½“å‰ URLï¼š

```javascript
const currentUrl = page.url();
const isLoggedInUrl = this.checkIfLoggedInUrl(currentUrl, platform);

if (isLoggedInUrl) {
    // URL å·²åŒ…å« /creator-micro/ï¼Œç™»å½•æˆåŠŸ
    // æå–çŠ¶æ€å¹¶å‘é€
} else {
    // URL ä»æ˜¯æ ¹è·¯å¾„ï¼ŒçœŸçš„è¶…æ—¶äº†
}
```

### åœºæ™¯ 3ï¼šç”¨æˆ·æ‰‹åŠ¨å…³é—­

å¦‚æœç”¨æˆ·åœ¨ URL è·³è½¬åç«‹å³å…³é—­æµè§ˆå™¨ï¼š

```javascript
async handleBrowserDisconnected() {
    const currentUrl = this.currentPage.url();
    const isLoggedInUrl = this.checkIfLoggedInUrl(currentUrl, platform);

    if (isLoggedInUrl) {
        // URL å·²è·³è½¬ï¼Œæå–çŠ¶æ€
    }
}
```

## URL æ¨¡å¼å¯¹æ¯”

| URL æ¨¡å¼ | åŒ¹é…åˆå§‹é¡µé¢ | åŒ¹é…ç™»å½•åé¡µé¢ | æ˜¯å¦æ­£ç¡® |
|---------|------------|--------------|---------|
| `**/creator.douyin.com/**` | âœ… æ˜¯ | âœ… æ˜¯ | âŒ é”™è¯¯ï¼ˆç«‹å³æˆåŠŸï¼‰|
| `**/creator.douyin.com/creator-micro/**` | âŒ å¦ | âœ… æ˜¯ | âœ… æ­£ç¡® |

## æ—¥å¿—ç¤ºä¾‹

### æˆåŠŸç™»å½•

```
[ç™»å½•åŠ©æ‰‹] å¯åŠ¨ç™»å½• - è´¦æˆ·: acc-xxx, å¹³å°: douyin
[ç™»å½•åŠ©æ‰‹] ä¸´æ—¶ç›®å½•: C:\Users\...\douyin-login-xxx
[ç™»å½•åŠ©æ‰‹] å¯¼èˆªåˆ°ç™»å½•é¡µ: https://creator.douyin.com/
[ç™»å½•åŠ©æ‰‹] æµè§ˆå™¨å·²æ‰“å¼€ï¼Œç­‰å¾…ç”¨æˆ·ç™»å½•...
[ç™»å½•åŠ©æ‰‹] ç­‰å¾…ç™»å½•å®Œæˆï¼ˆè¶…æ—¶: 600ç§’ï¼‰...
[ç™»å½•åŠ©æ‰‹] ğŸ’¡ ç™»å½•æˆåŠŸåä¼šè‡ªåŠ¨å…³é—­æµè§ˆå™¨å¹¶ä¿å­˜ç™»å½•çŠ¶æ€
[ç™»å½•åŠ©æ‰‹] ç­‰å¾… URL è·³è½¬åˆ°åˆ›ä½œè€…ä¸­å¿ƒä¸»é¡µ...
[ç™»å½•åŠ©æ‰‹] å½“å‰ URL: https://creator.douyin.com/

... ç”¨æˆ·æ‰«ç  ...

[ç™»å½•åŠ©æ‰‹] âœ… æ£€æµ‹åˆ°ç™»å½•æˆåŠŸï¼ˆURL å·²è·³è½¬åˆ°: https://creator.douyin.com/creator-micro/home ï¼‰
[ç™»å½•åŠ©æ‰‹] âœ… ç™»å½•æˆåŠŸ
   Cookies: 25 ä¸ª
   Origins: 1 ä¸ª
[ç™»å½•åŠ©æ‰‹] âœ… ç™»å½•æ•°æ®å·²å‘é€ç»™ Master
[ç™»å½•åŠ©æ‰‹] â±ï¸  2ç§’åè‡ªåŠ¨å…³é—­æµè§ˆå™¨...
[ç™»å½•åŠ©æ‰‹] æµè§ˆå™¨å·²å…³é—­
[ç™»å½•åŠ©æ‰‹] âœ… ä¸´æ—¶ç›®å½•å·²æ¸…ç†
```

## æŠ€æœ¯è¦ç‚¹

### `waitForURL` çš„å·¥ä½œåŸç†

```javascript
// ç­‰å¾… URL åŒ¹é…æŒ‡å®šæ¨¡å¼
await page.waitForURL('**/creator.douyin.com/creator-micro/**', { timeout });
```

- å¦‚æœå½“å‰ URL å·²ç»åŒ¹é…ï¼Œç«‹å³è¿”å›
- å¦‚æœä¸åŒ¹é…ï¼Œç­‰å¾…å¯¼èˆªäº‹ä»¶ç›´åˆ° URL åŒ¹é…
- è¶…æ—¶æŠ›å‡ºå¼‚å¸¸

### URL æ¨¡å¼è¯­æ³•

- `**` - åŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆåŒ…æ‹¬ `/`ï¼‰
- `*` - åŒ¹é…å•ä¸ªè·¯å¾„æ®µ
- ç¤ºä¾‹ï¼š
  - `**/creator.douyin.com/**` - åŒ¹é…æ‰€æœ‰æŠ–éŸ³åˆ›ä½œè€…ä¸­å¿ƒé¡µé¢
  - `**/creator.douyin.com/creator-micro/**` - åªåŒ¹é…ç™»å½•åçš„å­è·¯å¾„

### ä¸ºä»€ä¹ˆä¸ç”¨ `waitForNavigation`ï¼Ÿ

`waitForNavigation` ç­‰å¾…ä»»ä½•å¯¼èˆªäº‹ä»¶ï¼Œä½†ï¼š
- é¡µé¢å¯èƒ½æœ‰å¤šæ¬¡å¯¼èˆªï¼ˆé‡å®šå‘ï¼‰
- æ— æ³•åˆ¤æ–­æœ€ç»ˆ URL æ˜¯å¦æ˜¯ç™»å½•åé¡µé¢

`waitForURL` ç›´æ¥æŒ‡å®šç›®æ ‡ URL æ¨¡å¼ï¼Œæ›´ç²¾ç¡®ã€‚

## å¯¹æ¯”ï¼šä¸åŒæ£€æµ‹æ–¹æ³•

| æ£€æµ‹æ–¹æ³• | å¯é æ€§ | é€Ÿåº¦ | å—ç•Œé¢æ”¹ç‰ˆå½±å“ | æ¨è |
|---------|-------|------|--------------|------|
| URL åŒ…å« `/creator-micro/` | â­â­â­â­â­ | å¿« | å¦ | âœ… æ¨è |
| å¤´åƒå…ƒç´ å­˜åœ¨ | â­â­â­ | æ…¢ | æ˜¯ | âŒ ä¸æ¨è |
| Cookie å­˜åœ¨ | â­â­â­â­ | å¿« | å¦ | å¯é€‰ |
| ç”¨æˆ·ä¿¡æ¯ API | â­â­â­â­ | ä¸­ | æ˜¯ | å¯é€‰ |

## ç›¸å…³æ–‡ä»¶

- [login-assistant.js](../packages/crm-pc-im/src/main/login-assistant.js#L214-L221) - ç™»å½•æ£€æµ‹é€»è¾‘
- [login-assistant.js](../packages/crm-pc-im/src/main/login-assistant.js#L347-L355) - URL æ£€æŸ¥æ–¹æ³•

## ä¿®å¤æ—¥æœŸ

2025-11-25

## æ€»ç»“

**æ­£ç¡®çš„ç™»å½•æ£€æµ‹**ï¼šç­‰å¾… URL ä» `creator.douyin.com/` è·³è½¬åˆ° `creator.douyin.com/creator-micro/home`

è¿™æ˜¯æœ€ç®€å•ã€æœ€å¯é çš„æ–¹å¼ï¼
